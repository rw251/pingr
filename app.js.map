{"version":3,"sources":["app/base.js","app/chart.js","app/data.js","app/layout.js","app/log.js","app/lookup.js","app/main.js","app/notify.js","app/panels/allPatients.js","app/panels/confirm.js","app/panels/indicatorBenchmark.js","app/panels/indicatorBreakdown.js","app/panels/indicatorHeadlines.js","app/panels/indicatorList.js","app/panels/indicatorTrend.js","app/panels/individualActionPlan.js","app/panels/lifeline.js","app/panels/medication.js","app/panels/otherCodes.js","app/panels/patientCharacteristics.js","app/panels/patientList.js","app/panels/patientSearch.js","app/panels/patients.js","app/panels/qualityStandard.js","app/panels/qualityStandards.js","app/panels/teamActionPlan.js","app/panels/trend.js","app/panels/welcome.js","app/panels/wrapper.js","app/script.js","app/template.js","app/templates/action-plan-list.jade","app/templates/action-plan-task-list.jade","app/templates/indicator-headline.jade","app/templates/individual-action-plan.jade","app/templates/individual.jade","app/templates/mixins/action-plan-item.jade","app/templates/mixins/action-plan-task-list-item.jade","app/templates/mixins/action-plan-task-list.jade","app/templates/mixins/checkbox.jade","app/templates/mixins/delete-plan-modal.jade","app/templates/mixins/edit-plan-modal.jade","app/templates/mixins/patient-list-header-item.jade","app/templates/mixins/personal-action-plan.jade","app/templates/mixins/thumbs.jade","app/templates/modal-suggestion.jade","app/templates/modal-why.jade","app/templates/overview-table.jade","app/templates/patient-list-wrapper.jade","app/templates/patient-list.jade","app/templates/patient-search.jade","app/templates/patient-title.jade","app/templates/quality-standard.jade","app/templates/suggested-plan.jade","app/templates/team-action-plan.jade","app/views/actions.js","app/views/indicator.js","app/views/overview.js","app/views/patient.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvqBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlhBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/IA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/VA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7NA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7NA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9GA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5aA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAttBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjCA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/NA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7EA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzYA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxWA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjDA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7dA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnDA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnHA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7FA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvEA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzBA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhDA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArKA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxDA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9CA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjCA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9IA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5GA;AAAA","file":"dist/app.js","sourcesContent":["var data = require('./data'),\r\n  lookup = require('./lookup'),\r\n  chart = require('./chart'),\r\n  log = require('./log'),\r\n  ZeroClipboard = require('zeroclipboard');\r\n\r\nvar base = {\r\n\r\n  //object for keeping track what is in each panel to prevent unnecessary redraws\r\n  panels: {},\r\n\r\n  selectTab: function(id) {\r\n    var href = $('#mainTab li.active a').data(\"href\");\r\n    $('#mainTab li.active').removeClass('active').find('a').attr(\"href\", href);\r\n    $('#mainTab li[data-id=\"' + id + '\"]').addClass('active').find('a').removeAttr(\"href\");\r\n  },\r\n\r\n  createPanel: function(templateFn, data, templates) {\r\n    //var tempMust = templateSelector.html();\r\n    //Mustache.parse(tempMust); // optional, speeds up future uses\r\n    if (templates) {\r\n      /**for (var o in templates) {\r\n        if (templates.hasOwnProperty(o)) {\r\n          Mustache.parse(templates[o]);\r\n        }\r\n      }*/\r\n    }\r\n    var rendered = templateFn(data); //Mustache.render(tempMust, data, templates);\r\n    return rendered;\r\n  },\r\n\r\n  createPanelShow: function(templateSelector, panelSelector, data, templates) {\r\n    var rendered = base.createPanel(templateSelector, data, templates);\r\n    panelSelector.html(rendered).show();\r\n  },\r\n\r\n  showPathwayStageOverviewPanel: function(location, enableHover, pathwayId, pathwayStage) {\r\n    var standards = [];\r\n    for (var standard in data[pathwayId][pathwayStage].standards) {\r\n      var denom = data.getDenominatorForStandard(pathwayId, pathwayStage);\r\n      var num = denom - data.getNumeratorForStandard(pathwayId, pathwayStage, standard);\r\n      standards.push({\r\n        \"standard\": data[pathwayId][pathwayStage].standards[standard].tab.title,\r\n        \"standardKey\": standard,\r\n        \"tooltip\": data[pathwayId][pathwayStage].standards[standard][\"standard-met-tooltip\"],\r\n        \"numerator\": num,\r\n        \"denominator\": denom,\r\n        \"percentage\": (num * 100 / denom).toFixed(0)\r\n      });\r\n    }\r\n\r\n    base.createPanelShow($('#pathway-stage-overview-panel'), location, {\r\n      pathway: data.pathwayNames[pathwayId],\r\n      pathwayStage: pathwayStage,\r\n      pathwayStageName: lookup.categories[pathwayStage].display,\r\n      pathwayNameShort: pathwayId,\r\n      title: data[pathwayId][pathwayStage].text.panel.text,\r\n      standards: standards\r\n    }, {\r\n      \"row\": $('#overview-panel-table-row').html()\r\n    });\r\n\r\n    $('#' + pathwayStage + '-trend-toggle').on('click', function(e) {\r\n      if ($(this).text() === \"Trend\") {\r\n        $(this).text(\"Table\");\r\n        $('#' + pathwayStage + '-chart-table').hide();\r\n        $('#' + pathwayStage + '-chart-wrapper').show();\r\n      } else {\r\n        $(this).text(\"Trend\");\r\n        $('#' + pathwayStage + '-chart-table').show();\r\n        $('#' + pathwayStage + '-chart-wrapper').hide();\r\n      }\r\n      e.stopPropagation();\r\n    });\r\n\r\n    chart.drawOverviewChart(pathwayId, pathwayStage, enableHover);\r\n\r\n  },\r\n\r\n  hideFooter: function() {\r\n    $('footer').hide();\r\n  },\r\n\r\n  showFooter: function() {\r\n    $('footer').show();\r\n  },\r\n\r\n  hideTooltips: function() {\r\n    $('[data-toggle=\"tooltip\"]').tooltip('hide');\r\n  },\r\n\r\n  wireUpTooltips: function() {\r\n    $('[data-toggle=\"tooltip\"]').tooltip('hide');\r\n    $('.tooltip').remove();\r\n\r\n    $('[data-toggle=\"tooltip\"]').tooltip({\r\n      container: 'body',\r\n      delay: {\r\n        \"show\": 500,\r\n        \"hide\": 100\r\n      },\r\n      html: true\r\n    });\r\n    $('[data-toggle=\"lone-tooltip\"]').tooltip({\r\n      container: 'body',\r\n      delay: {\r\n        \"show\": 300,\r\n        \"hide\": 100\r\n      }\r\n    });\r\n    $('[data-toggle=\"lone-tooltip\"]').on('shown.bs.tooltip', function(e) {\r\n      $('[data-toggle=\"tooltip\"]').not(this).tooltip('hide');\r\n    });\r\n    $('.patient-row-tooltip').on('show.bs.tooltip', function(e) {\r\n      if ($(this).hasClass('highlighted')) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      }\r\n    });\r\n  },\r\n\r\n  setupClipboard: function(selector, destroy) {\r\n    if (destroy) ZeroClipboard.destroy(); //tidy up\r\n\r\n    var client = new ZeroClipboard(selector);\r\n\r\n    client.on('ready', function() {\r\n      client.on('aftercopy', function(event) {\r\n        console.log('Copied text to clipboard: ' + event.data['text/plain']);\r\n        $(event.target).tooltip('hide');\r\n        $(event.target).popover({\r\n          trigger: 'manual',\r\n          template: '<div class=\"popover\" role=\"tooltip\"><div class=\"arrow\"></div><div class=\"popover-content\"></div></div>',\r\n          delay: {\r\n            show: 500,\r\n            hide: 500\r\n          }\r\n        });\r\n        clearTimeout(lookup.tmp);\r\n        $(event.target).popover('show');\r\n        lookup.tmp = setTimeout(function() {\r\n          $(event.target).popover('hide');\r\n        }, 600);\r\n      });\r\n    });\r\n  },\r\n\r\n  clearBox: function() {\r\n    //Clear the patient search box\r\n    $('.typeahead').typeahead('val', '');\r\n  },\r\n\r\n  /********************************\r\n   * Modals\r\n   ********************************/\r\n\r\n  launchModal: function(data, label, value, reasonText, callbackOnSave, callbackOnCancel, callbackOnUndo) {\r\n    var tmpl = require(\"templates/modal-why\");\r\n\r\n    if (data.reasons && data.reasons.length > 0) data.hasReasons = true;\r\n\r\n    $('#modal').html(tmpl(data));\r\n\r\n    if (reasonText) {\r\n      $('#modal textarea').val(reasonText);\r\n    }\r\n    lookup.modalSaved = false;\r\n    lookup.modalUndo = false;\r\n\r\n    $('#modal .modal').off('click', '.undo-plan').on('click', '.undo-plan', function(e) {\r\n      lookup.modalUndo = true;\r\n    }).off('submit', 'form').on('submit', 'form', {\r\n      \"label\": label\r\n    }, function(e) {\r\n      if (!e.data.label) e.data.label = \"team\";\r\n      var reason = $('input:radio[name=reason]:checked').val();\r\n      var reasonText = $('#modal textarea').val();\r\n\r\n      log.recordFeedback(data.pathwayId, e.data.label, value, reason, reasonText);\r\n\r\n      lookup.modalSaved = true;\r\n\r\n      e.preventDefault();\r\n      $('#modal .modal').modal('hide');\r\n    }).modal();\r\n\r\n    $('#modal').off('hidden.bs.modal').on('hidden.bs.modal', {\r\n      \"label\": label\r\n    }, function(e) {\r\n      if (lookup.modalSaved) {\r\n        lookup.modalSaved = false;\r\n        if (callbackOnSave) callbackOnSave();\r\n      } else if (lookup.modalUndo) {\r\n        lookup.modalUndo = false;\r\n        if (callbackOnUndo) callbackOnUndo();\r\n      } else {\r\n        //uncheck as cancelled. - but not if value is empty as this unchecks everything - or if already checked\r\n        if (callbackOnCancel) callbackOnCancel();\r\n      }\r\n    });\r\n  },\r\n\r\n  launchSuggestionModal: function() {\r\n    var tmpl = require(\"templates/modal-suggestion\");\r\n\r\n    $('#modal').html(tmpl({text: lookup.suggestionModalText}));\r\n\r\n\r\n    $('#modal .modal').off('submit', 'form').on('submit', 'form', function(e) {\r\n\r\n      var suggestion = $('#modal textarea').val();\r\n\r\n      var dataToSend = {\r\n        event: {\r\n          what: \"suggestion\",\r\n          when: new Date().getTime(),\r\n          who: (JSON.parse(localStorage.bb).email || \"?\"),\r\n          detail: [\r\n            { key: \"text\", value: suggestion }\r\n          ]\r\n        }\r\n      };\r\n\r\n      console.log(dataToSend);\r\n\r\n      $.ajax({\r\n        type: \"POST\",\r\n        url: \"http://130.88.250.206:9100/pingr\",\r\n        data: JSON.stringify(dataToSend),\r\n        success: function(d) { console.log(d); },\r\n        dataType: \"json\",\r\n        contentType: \"application/json\"\r\n      });\r\n\r\n      e.preventDefault();\r\n      $('#modal .modal').modal('hide');\r\n    }).modal();\r\n  },\r\n\r\n  sortSuggestions: function(suggestions) {\r\n    suggestions.sort(function(a, b) {\r\n      if (a.agree && !a.done) {\r\n        if (b.agree && !b.done) return 0;\r\n        return -1;\r\n      } else if (!a.agree && !a.disagree) {\r\n        if (!b.agree && !b.disagree) return 0;\r\n        if (b.agree && !b.done) return 1;\r\n        return -1;\r\n      } else if (a.agree && a.done) {\r\n        if (b.agree && b.done) return 0;\r\n        if (b.disagree) return -1;\r\n        return 1;\r\n      } else {\r\n        if (b.disagree) return 0;\r\n        return 1;\r\n      }\r\n    });\r\n\r\n    return suggestions;\r\n  },\r\n\r\n  addDisagreePersonalTeam: function(plans) {\r\n    for (var i = 0; i < plans.length; i++) {\r\n      if (plans[i].agree) {\r\n        plans[i].disagree = false;\r\n      } else if (plans[i].agree === false) {\r\n        plans[i].disagree = true;\r\n      }\r\n    }\r\n    return plans;\r\n  },\r\n\r\n  suggestionList: function(ids) {\r\n    return ids.map(function(val) {\r\n      return {\r\n        \"id\": val.id || val,\r\n        \"text\": log.text[val.id || val].text,\r\n        \"subsection\": val.subsection\r\n      };\r\n    }).filter(function(v, i) { //RW to always limit to 3\r\n      return i < 3;\r\n    });\r\n  },\r\n\r\n  mergeIndividualStuff: function(suggestions, patientId) {\r\n    var localActions = log.listActions();\r\n    if (!localActions[patientId]) return suggestions;\r\n\r\n    for (var i = 0; i < suggestions.length; i++) {\r\n      if (localActions[patientId][suggestions[i].id]) {\r\n        if (localActions[patientId][suggestions[i].id].agree) {\r\n          suggestions[i].agree = true;\r\n        } else if (localActions[patientId][suggestions[i].id].agree === false) {\r\n          suggestions[i].disagree = true;\r\n        }\r\n        if (localActions[patientId][suggestions[i].id].done) suggestions[i].done = localActions[patientId][suggestions[i].id].done;\r\n      }\r\n    }\r\n    return suggestions;\r\n  },\r\n\r\n  switchTo110Layout: function() {\r\n    if (base.layout === \"110\") return;\r\n    base.layout = \"110\";\r\n    farLeftPanel.removeClass('col-lg-3 col-lg-8').addClass('col-lg-6').show();\r\n    topPanel.hide();\r\n    topLeftPanel.hide();\r\n    bottomLeftPanel.hide();\r\n    topRightPanel.hide();\r\n    bottomRightPanel.hide();\r\n    midPanel.hide();\r\n    farRightPanel.removeClass('col-xl-4').addClass('col-xl-8').show();\r\n  },\r\n\r\n  switchTo101Layout: function() {\r\n    if (base.layout === \"101\") return;\r\n    base.layout = \"101\";\r\n    farLeftPanel.removeClass('col-lg-3 col-lg-6 col-xl-4').addClass('col-lg-8').show();\r\n    topPanel.hide();\r\n    topLeftPanel.hide();\r\n    bottomLeftPanel.hide();\r\n    topRightPanel.hide();\r\n    bottomRightPanel.hide();\r\n    midPanel.hide();\r\n    farRightPanel.removeClass('col-xl-8').addClass('col-xl-4').show();\r\n  },\r\n\r\n\r\n\r\n  switchTo221Layout: function() {\r\n    if (base.layout === \"221\") return;\r\n    base.layout = \"221\";\r\n    farLeftPanel.hide();\r\n    topPanel.hide();\r\n    topLeftPanel.addClass('col-xl-6').show();\r\n    bottomLeftPanel.addClass('col-xl-6').show();\r\n    topRightPanel.removeClass('col-xl-12').addClass('col-xl-6').show();\r\n    bottomRightPanel.removeClass('col-xl-12').addClass('col-xl-6').show();\r\n    midPanel.removeClass('col-xl-4').addClass('col-xl-8').show();\r\n    farRightPanel.removeClass('col-xl-8').addClass('col-xl-4').show();\r\n  },\r\n\r\n  switchTo21Layout: function() {\r\n    if (base.layout === \"21\") return;\r\n    base.layout = \"21\";\r\n    farLeftPanel.hide();\r\n    topPanel.hide();\r\n    topLeftPanel.hide();\r\n    bottomLeftPanel.hide();\r\n    topRightPanel.removeClass('col-xl-6').addClass('col-xl-12').show();\r\n    bottomRightPanel.removeClass('col-xl-6').addClass('col-xl-12').show();\r\n    midPanel.removeClass('col-xl-4').addClass('col-xl-8').show();\r\n    farRightPanel.removeClass('col-xl-8').addClass('col-xl-4').show();\r\n  },\r\n\r\n  wireUpStandardDropDown: function(pathwayId, pathwayStage, standard, callback) {\r\n    var breaches = data.options.filter(function(val) {\r\n      return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard;\r\n    });\r\n\r\n    if (breaches.length > 0) $('select').val(breaches[0].value);\r\n\r\n    $('select').select2({\r\n      templateResult: base.formatStandard,\r\n      minimumResultsForSearch: Infinity\r\n    });\r\n    $('span.select2-selection__rendered').attr(\"title\", \"\");\r\n    $('select').on('change', function() {\r\n      var localData = $(this).find(':selected').data();\r\n      callback(localData.pathwayId, localData.pathwayStage, localData.standard, data.patientId);\r\n    }).on(\"select2:open\", function(e) {\r\n      base.wireUpTooltips();\r\n    });\r\n  },\r\n\r\n  formatStandard: function(standard) {\r\n    if (!standard.id) {\r\n      return standard.text;\r\n    }\r\n    var localData = $(standard.element).data();\r\n    // Not relevant\r\n    var standardHtml = '';\r\n    //if diagnosis opportunity then not relevant for other stages\r\n    //if no mention anywhere then not relevant for that disease\r\n    switch (data.getPatientStatus(data.patientId, localData.pathwayId, localData.pathwayStage, localData.standard)) {\r\n      case \"ok\":\r\n        standardHtml = '<span class=\"standard-achieved\" data-toggle=\"tooltip\" data-placement=\"left\" title=\"' + data[localData.pathwayId][localData.pathwayStage].standards[localData.standard][\"dropdown-tooltip\"] + ' - QUALITY INDICATOR ACHIEVED\">' + standard.text + ' <i class=\"fa fa-smile-o\" style=\"color:green\"></i></span>';\r\n        break;\r\n      case \"missed\":\r\n        standardHtml = '<span class=\"standard-missed\" data-toggle=\"tooltip\" data-placement=\"left\" title=\"' + data[localData.pathwayId][localData.pathwayStage].standards[localData.standard][\"dropdown-tooltip\"] + ' - IMPROVEMENT OPPORTUNITY EXISTS FOR THIS PATIENT\">' + standard.text + ' <i class=\"fa fa-flag\" style=\"color:red\"></i></span>';\r\n        break;\r\n      case \"not\":\r\n        standardHtml = '<span class=\"standard-not-relevant\" data-toggle=\"tooltip\" data-placement=\"left\" title=\"' + data[localData.pathwayId][localData.pathwayStage].standards[localData.standard][\"dropdown-tooltip\"] + ' - STANDARD NOT RELEVANT TO THIS PATIENT\">' + standard.text + ' <i class=\"fa fa-meh-o\" style=\"color:gray\"></i></span>';\r\n        break;\r\n    }\r\n    var $standard = $(standardHtml);\r\n    return $standard;\r\n  },\r\n\r\n  updateTitle: function(title) {\r\n    $('#title-left').html(title);\r\n    $('#title-right').html(\"\");\r\n  },\r\n  /*updateTitle: function(title, tooltip) {\r\n    var titles = title;\r\n    if (typeof title === \"string\") {\r\n      titles = [{\r\n        title: title,\r\n        tooltip: tooltip\r\n      }];\r\n    }\r\n    var content = titles.map(function(t, idx) {\r\n      return idx === titles.length - 1 ? '<span title=\"' + t.tooltip + '\">' + t.title + '</span>' : '<a href=\"' + t.url + '\" title=\"' + t.tooltip + '\">' + t.title + '</a>';\r\n    }).join(\" > \");\r\n\r\n    $('.pagetitle').html(content);\r\n  },*/\r\n\r\n  hideAllPanels: function() {\r\n    topLeftPanel.hide();\r\n    bottomLeftPanel.hide();\r\n    topRightPanel.hide();\r\n    bottomRightPanel.hide();\r\n    farLeftPanel.hide();\r\n    farRightPanel.hide();\r\n    topPanel.hide();\r\n  },\r\n\r\n  hidePanels: function(panel) {\r\n    panel.children().hide();\r\n  },\r\n\r\n  updateTab: function(tab, value, url) {\r\n    var tabElement = $('#mainTab a[data-href=\"#' + tab + '\"]');\r\n    tabElement.html(tabElement.text().split(\":\")[0] + \":<br><span><strong>\" + value + \"</strong></span>\");\r\n    tabElement.data(\"href\", \"#\" + tab + \"/\" + url);\r\n  },\r\n\r\n  addFullPage: function(panel) {\r\n    panel.fullpage({ verticalCentered: false, paddingBottom: '80px', scrollBar: true });\r\n\r\n    $('.fp-down').off('click').on('click', function() {\r\n      $.fn.fullpage.moveSectionDown();\r\n    });\r\n\r\n    $('.fp-up').off('click').on('click', function() {\r\n      $.fn.fullpage.moveSectionUp();\r\n    });\r\n  },\r\n\r\n  removeFullPage: function(panel) {\r\n    if (panel.children('.section').length === 0) return;\r\n    if ($.fn.fullpage && $.fn.fullpage.destroy) $.fn.fullpage.destroy('all'); //tidy up before doing it again\r\n  },\r\n\r\n  showLoading: function() {\r\n    $('.loading-container').show();\r\n    $('#title-row').hide();\r\n  },\r\n\r\n  hideLoading: function() {\r\n    $('.loading-container').fadeOut(1000);\r\n    $('#title-row').fadeIn(1000);\r\n  },\r\n\r\n};\r\n\r\nmodule.exports = base;\r\n","var Highcharts = require('highcharts/highstock'),\r\n  data = require('./data'),\r\n  lookup = require('./lookup'),\r\n  log = require('./log'),\r\n  Mustache = require('mustache');\r\n\r\nconsole.log(\"chart.js: data.lastloader= \" + data.lastloader);\r\ndata.lastloader = \"chart.js\";\r\n\r\nvar cht = {\r\n\r\n  destroyCharts: function(charts) {\r\n    for (var i = 0; i < charts.length; i++) {\r\n      if (lookup.charts[charts[i]]) {\r\n        lookup.charts[charts[i]].destroy();\r\n        delete lookup.charts[charts[i]];\r\n      }\r\n    }\r\n  },\r\n\r\n  drawTrendChart: function(patientId, pathwayId, pathwayStage, standard) {\r\n    var i, j;\r\n    cht.destroyCharts(['chart-demo-trend']);\r\n    if (!data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]]) {\r\n      $('#chart-demo-trend').html('No data for this patients');\r\n      $('#chart-demo-trend').parent().find('.table-chart-toggle').hide();\r\n      return;\r\n    }\r\n\r\n    var chartData = data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]];\r\n    var tableData = [];\r\n    for (i = 1; i < data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][0].length; i++) {\r\n      tableData.push({\r\n        \"item\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][1][0],\r\n        \"value\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][1][i],\r\n        \"date\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][0][i]\r\n      });\r\n    }\r\n    for (i = 1; i < data[pathwayId][pathwayStage].standards[standard].chart.length; i++) {\r\n      chartData.push(data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[i]][1]); //RW TODO assumption here that all dates are the same\r\n      for (j = 1; j < data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][0].length; j++) {\r\n        tableData.push({\r\n          \"item\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[i]][1][0],\r\n          \"value\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[i]][1][j],\r\n          \"date\": data.patients[patientId][data[pathwayId][pathwayStage].standards[standard].chart[0]][0][j]\r\n        });\r\n      }\r\n    }\r\n    var chartOptions = {\r\n      bindto: '#chart-demo-trend',\r\n      data: {\r\n        xs: {},\r\n        classes: {},\r\n        columns: chartData.slice()\r\n      },\r\n      zoom: {\r\n        enabled: true\r\n      },\r\n      line: {\r\n        connectNull: false\r\n      },\r\n      axis: {\r\n        x: {\r\n          type: 'timeseries',\r\n          tick: {\r\n            fit: false,\r\n            format: '%d-%m-%Y',\r\n            count: 5\r\n          },\r\n          max: new Date()\r\n        },\r\n        y: {\r\n          label: {\r\n            text: data[pathwayId][pathwayStage].standards[standard].chartUnits,\r\n            position: 'outer-middle'\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    var maxValue = 0;\r\n    var standardItems = [];\r\n\r\n    for (i = 1; i < chartOptions.data.columns.length; i++) {\r\n      chartOptions.data.xs[chartOptions.data.columns[i][0]] = \"x\";\r\n      standardItems.push(chartOptions.data.columns[i][0]);\r\n\r\n      for (j = 1; j < chartOptions.data.columns[i].length; j++) {\r\n        if (parseFloat(chartOptions.data.columns[i][j]) > maxValue) maxValue = parseFloat(chartOptions.data.columns[i][j]);\r\n      }\r\n    }\r\n\r\n    chartOptions.tooltip = {\r\n      format: {\r\n        value: function(value, ratio, id) {\r\n          var text = standardItems.indexOf(id) > -1 ? value : \"\";\r\n          return text;\r\n        }\r\n      }\r\n    };\r\n\r\n    var lines = null;\r\n    var axisnum = 1;\r\n    if (data.patients[patientId].contacts) {\r\n      for (i = 0; i < data.patients[patientId].contacts.length; i++) {\r\n        chartOptions.data.classes[data.patients[patientId].contacts[i].text] = 'larger';\r\n        if (!chartOptions.data.xs[data.patients[patientId].contacts[i].text]) {\r\n          chartOptions.data.xs[data.patients[patientId].contacts[i].text] = \"x\" + axisnum;\r\n          chartOptions.data.columns.push([\"x\" + axisnum, data.patients[patientId].contacts[i].value]);\r\n          chartOptions.data.columns.push([data.patients[patientId].contacts[i].text, (maxValue * 1.1).toString()]);\r\n          axisnum++;\r\n        } else {\r\n          var axis = chartOptions.data.xs[data.patients[patientId].contacts[i].text];\r\n          for (j = 1; j < chartOptions.data.columns.length; j++) {\r\n            if (chartOptions.data.columns[j][0] === axis) {\r\n              chartOptions.data.columns[j].push(data.patients[patientId].contacts[i].value);\r\n            } else if (chartOptions.data.columns[j][0] === data.patients[patientId].contacts[i].text) {\r\n              chartOptions.data.columns[j].push((maxValue * 1.1).toString());\r\n            }\r\n          }\r\n        }\r\n        tableData.push({\r\n          \"item\": \"Event\",\r\n          \"value\": data.patients[patientId].contacts[i].text,\r\n          \"date\": data.patients[patientId].contacts[i].value\r\n        });\r\n      }\r\n    }\r\n\r\n    var patientEvents = log.getEvents().filter(function(val) {\r\n      return val.id === patientId;\r\n    });\r\n    if (patientEvents.length > 0) {\r\n\r\n      for (i = 0; i < patientEvents.length; i++) {\r\n        chartOptions.data.classes[patientEvents[i].name] = 'larger';\r\n        if (!chartOptions.data.xs[patientEvents[i].name]) {\r\n          chartOptions.data.xs[patientEvents[i].name] = \"x\" + axisnum;\r\n          chartOptions.data.columns.push([\"x\" + axisnum, patientEvents[i].date.substr(0, 10)]);\r\n          chartOptions.data.columns.push([patientEvents[i].name, (maxValue * 1.1).toString()]);\r\n          axisnum++;\r\n        } else {\r\n          var axis2 = chartOptions.data.xs[patientEvents[i].name];\r\n          for (j = 1; j < chartOptions.data.columns.length; j++) {\r\n            if (chartOptions.data.columns[j][0] === axis2) {\r\n              chartOptions.data.columns[j].push(patientEvents[i].date.substr(0, 10));\r\n            } else if (chartOptions.data.columns[j][0] === patientEvents[i].name) {\r\n              chartOptions.data.columns[j].push((maxValue * 1.1).toString());\r\n            }\r\n          }\r\n        }\r\n        tableData.push({\r\n          \"item\": \"Event\",\r\n          \"value\": patientEvents[i].name,\r\n          \"date\": patientEvents[i].date.substr(0, 10)\r\n        });\r\n      }\r\n    }\r\n\r\n    tableData.sort(function(a, b) {\r\n      if (a.date === b.date) return 0;\r\n      else return a.date < b.date ? 1 : -1;\r\n    });\r\n    //draw Table\r\n    $('#table-demo-trend').html(Mustache.render($('#value-trend-panel-table').html(), {\r\n      \"items\": tableData\r\n    }, {\r\n      \"item-row\": $('#value-trend-panel-table-row').html()\r\n    }));\r\n\r\n    //draw charts in separate thread and with delay to stop sluggish appearance\r\n    setTimeout(function() {\r\n      lookup.charts['chart-demo-trend'] = c3.generate(chartOptions);\r\n    }, 1);\r\n  },\r\n\r\n  selectPieSlice: function(chart, d) {\r\n    lookup.chartClicked = true;\r\n    $('#' + chart + ' path.c3-bar').attr('class', function(index, classNames) {\r\n      return classNames + ' _unselected_';\r\n    });\r\n    lookup.charts[chart].select([d.id], [d.index], true);\r\n\r\n    farRightPanel.fadeOut(200, function() {\r\n      var template = $('#patient-panel-placeholder').html();\r\n      farRightPanel.html(Mustache.render(template)).show();\r\n    });\r\n  },\r\n\r\n  drawOverviewChart: function(pathwayId, pathwayStage, enableHover) {\r\n    cht.destroyCharts([pathwayStage + '-chart']);\r\n    setTimeout(function() {\r\n      lookup.charts[pathwayStage + '-chart'] = c3.generate({\r\n        bindto: '#' + pathwayStage + '-chart',\r\n        data: {\r\n          x: 'x',\r\n          columns: data[pathwayId][pathwayStage].trend\r\n        },\r\n        zoom: {\r\n          enabled: true\r\n        },\r\n        tooltip: {\r\n          format: {\r\n            title: function(x) {\r\n              return x.toDateString() + (enableHover ? '<br>Click for more detail' : '');\r\n            },\r\n            value: function(value) {\r\n              return enableHover ? value + '%' : undefined;\r\n            }\r\n          }\r\n        },\r\n        axis: {\r\n          x: {\r\n            type: 'timeseries',\r\n            tick: {\r\n              format: '%d-%m-%Y',\r\n              count: 7,\r\n              culling: {\r\n                max: 4\r\n              }\r\n            },\r\n            label: {\r\n              text: 'Date',\r\n              position: 'outer-center'\r\n            }\r\n          },\r\n          y: {\r\n            min: 0,\r\n            label: {\r\n              text: 'Proportion (%)',\r\n              position: 'outer-middle'\r\n            }\r\n          }\r\n        },\r\n        point: {\r\n          show: false\r\n        },\r\n        size: {\r\n          height: null\r\n        }\r\n      });\r\n    }, 1);\r\n  },\r\n\r\n  drawBenchmarkChart: function(element, data) {\r\n    cht.destroyCharts([element + '-chart']);\r\n    setTimeout(function() {\r\n      lookup.charts[element + '-chart'] = c3.generate({\r\n        bindto: '#' + element,\r\n        size: {\r\n          height: 200\r\n        },\r\n        data: data,\r\n        axis: {\r\n          x: {\r\n            type: 'category',\r\n            tick: {\r\n              rotate: 60,\r\n              multiline: false\r\n            }\r\n          },\r\n          y: {\r\n            label: {\r\n              text: '% of patients meeting the target',\r\n              position: 'outer-middle'\r\n            }\r\n          }\r\n        },\r\n        grid: {\r\n          y: {\r\n            show: true\r\n          }\r\n        }\r\n      });\r\n    }, 1);\r\n  },\r\n\r\n  drawPerformanceTrendChart: function(element, data) {\r\n    cht.destroyCharts([element + '-chart']);\r\n    setTimeout(function() {\r\n      lookup.charts[element + '-chart'] = c3.generate({\r\n        bindto: '#' + element,\r\n        size: {\r\n          height: 200\r\n        },\r\n        data: data,\r\n        axis: {\r\n          x: {\r\n            type: 'timeseries',\r\n            tick: {\r\n              format: '%Y-%m-%d',\r\n              rotate: 60,\r\n              multiline: false\r\n            },\r\n            height: 60\r\n          },\r\n          y: {\r\n            label: {\r\n              text: \"Performance\",\r\n              position: 'outer-middle'\r\n            }\r\n          }\r\n        },\r\n        grid: {\r\n          x: {\r\n            show: true\r\n          },\r\n          y: {\r\n            show: true\r\n          }\r\n        }\r\n      });\r\n    }, 1);\r\n  },\r\n\r\n  drawBenchmarkChartHC: function(element, data) {\r\n\r\n    data = [\r\n      { x: 49.9, p: 'P1', local: true },\r\n      { x: 71.5, p: 'P2', local: true },\r\n      { x: 16.4, p: 'P3', local: true },\r\n      { x: 29.2, p: 'P4', local: true },\r\n      { x: 44.0, p: 'P5', local: true },\r\n      { x: 76.0, p: 'P6', local: true },\r\n      { x: 35.6, p: 'YOU', local: true },\r\n      { x: 48.5, p: 'P7', local: true },\r\n      { x: 26.4, p: 'P8', local: true },\r\n      { x: 94.1, p: 'P9', local: true },\r\n      { x: 95.6, p: 'P10' },\r\n      { x: 54.0, p: 'P11' },\r\n      { x: 39.9, p: 'P12' },\r\n      { x: 61.5, p: 'P13' },\r\n      { x: 6.4, p: 'P14' },\r\n      { x: 19.2, p: 'P15' },\r\n      { x: 34.0, p: 'P16' },\r\n      { x: 66.0, p: 'P17' },\r\n      { x: 25.6, p: 'P18' },\r\n      { x: 38.5, p: 'P19' },\r\n      { x: 36.4, p: 'P20' },\r\n      { x: 84.1, p: 'P21' },\r\n      { x: 85.6, p: 'P22' },\r\n      { x: 64.0, p: 'P23' }\r\n    ];\r\n    data.sort(function(a, b) {\r\n      return a.x - b.x;\r\n    });\r\n\r\n    var local = true;\r\n    var bChart = $('#' + element).highcharts({\r\n        chart: {\r\n          type: 'column',\r\n          events: {\r\n            load: function() {\r\n              var thisChart = this;\r\n              thisChart.renderer.button('Toggle neighbourhood / CCG', thisChart.plotWidth - 100, 0, function() {\r\n                local = !local;\r\n                thisChart.xAxis[0].categories = data.filter(function(v) {\r\n                  if (local) return v.local;\r\n                  else return true;\r\n                }).map(function(v) {\r\n                  return v.p;\r\n                });\r\n                thisChart.series[0].setData(data.filter(function(v) {\r\n                  if (local) return v.local;\r\n                  else return true;\r\n                }).map(function(v) {\r\n                  if (v.p === \"YOU\") return { y: v.x, color: \"red\" };\r\n                  else return v.x;\r\n                }));\r\n              }).add();\r\n            }\r\n          }\r\n        },\r\n        title: { text: 'Benchmark' },\r\n        xAxis: {\r\n          categories: data.filter(function(v) {\r\n            return v.local === local;\r\n          }).map(function(v) {\r\n            return v.p;\r\n          }),\r\n          crosshair: true\r\n        },\r\n        yAxis: {\r\n          min: 0,\r\n          max: 100,\r\n          title: { text: '% patients meeting target' }\r\n        },\r\n        tooltip: {\r\n          headerFormat: '<span style=\"font-size:10px\">Practice: <b>{point.key}</b></span><table>',\r\n          pointFormat: '<tr><td style=\"color:{series.color};padding:0\">{series.name}: </td>' +\r\n            '<td style=\"padding:0\"><b>{point.y:.1f}%</b></td></tr>',\r\n          footerFormat: '</table>',\r\n          shared: true,\r\n          useHTML: true\r\n        },\r\n        plotOptions: {\r\n          column: {\r\n            pointPadding: 0.2,\r\n            borderWidth: 0\r\n          }\r\n        },\r\n        legend: {\r\n          enabled: false\r\n        },\r\n        series: [{\r\n          name: 'Performance',\r\n          data: data.filter(function(v) {\r\n            return v.local === local;\r\n          }).map(function(v) {\r\n            if (v.p === \"YOU\") return { y: v.x, color: \"red\" };\r\n            else return v.x;\r\n          })\r\n      }]\r\n      },\r\n      function(chart) { // on complete\r\n        var textX = chart.plotLeft + (chart.plotWidth * 0.5);\r\n        var textY = chart.plotTop + (chart.plotHeight * 0.5);\r\n\r\n        var span = '<span id=\"pieChartInfoText\" style=\"position:absolute; text-align:center;-ms-transform: rotate(335deg);-webkit-transform: rotate(335deg);transform: rotate(335deg);\">';\r\n        span += '<span style=\"font-size: 64px\">Coming Soon!</span>';\r\n        span += '</span>';\r\n\r\n        $(\"#benchmark-chart\").append(span);\r\n        span = $('#pieChartInfoText');\r\n        span.css('left', textX + (span.width() * -0.5));\r\n        span.css('top', textY + (span.height() * -0.5));\r\n      });\r\n\r\n  },\r\n\r\n  drawPerformanceTrendChartHC: function(element, data) {\r\n\r\n    /// data is\r\n    // {\r\n    //  \"values\":\r\n    //    [\"x\", \"2015-08-24\", \"2015-08-23\",...\r\n    //    [\"numerator\", 35, 37, 33, 32, 31,...\r\n    //    [\"denominator\", 135, 133, 133, 13,...\r\n    //    [\"target\", 0.3, 0.3, 0...\r\n    // }\r\n\r\n    var target = 75,\r\n      maxValue = target,\r\n      maxXvalue = 0;\r\n\r\n    var series = [\r\n      { type: 'line', name: 'Trend', data: [] },\r\n      { type: 'line', name: 'Prediction', data: [], dashStyle: 'dot' }\r\n    ];\r\n\r\n    var today = new Date();\r\n    var lastApril = new Date();\r\n    var aprilBeforeThat = new Date();\r\n    var nextApril = new Date();\r\n    if (today.getMonth() < 3) {\r\n      //after april\r\n      lastApril.setYear(today.getFullYear() - 1);\r\n      aprilBeforeThat.setYear(today.getFullYear() - 1);\r\n    } else {\r\n      nextApril.setYear(today.getFullYear() + 1);\r\n    }\r\n    aprilBeforeThat.setYear(aprilBeforeThat.getFullYear() - 1);\r\n    lastApril.setMonth(3);\r\n    aprilBeforeThat.setMonth(3);\r\n    nextApril.setMonth(3);\r\n    lastApril.setDate(1);\r\n    aprilBeforeThat.setDate(1);\r\n    nextApril.setDate(1);\r\n\r\n    var n = 0,\r\n      sumX = 0,\r\n      sumY = 0,\r\n      sumXY = 0,\r\n      sumXX = 0,\r\n      sumYY = 0,\r\n      intercept, gradient, compDate;\r\n\r\n    if (data.values[0].filter(function(v) {\r\n        return new Date(v).getTime() > lastApril.getTime();\r\n      }).length > 2) compDate = new Date(lastApril.getTime());\r\n    else compDate = new Date(aprilBeforeThat.getTime());\r\n\r\n    data.values[0].forEach(function(v, i) {\r\n      if (i === 0) return;\r\n      var time = new Date(v).getTime();\r\n      var y = +data.values[1][i] * 100 / +data.values[2][i];\r\n      if (time >= compDate.getTime()) {\r\n        n++;\r\n        sumX += time;\r\n        sumY += y;\r\n        sumXY += time * y;\r\n        sumXX += time * time;\r\n        sumYY += y * y;\r\n      }\r\n      series[0].data.push([time, y]);\r\n      maxValue = Math.max(maxValue, y);\r\n      maxXvalue = Math.max(maxXvalue, time);\r\n    });\r\n\r\n    intercept = (sumY * sumXX - sumX * sumXY) / (n * sumXX - sumX * sumX);\r\n    gradient = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);\r\n\r\n    var newCompDate = new Date(lastApril.getTime());\r\n    series[1].data.push([maxXvalue, maxXvalue * gradient + intercept]);\r\n    var newCompDate = new Date(lastApril.getTime());\r\n    for (var i = 0; i < 13; i++) {\r\n      var x = newCompDate.getTime();\r\n      if (x < maxXvalue) {\r\n        newCompDate.setMonth(newCompDate.getMonth() + 1);\r\n        continue;\r\n      }\r\n      series[1].data.push([x, x * gradient + intercept]);\r\n      var m = newCompDate.getMonth();\r\n      newCompDate.setMonth(newCompDate.getMonth() + 1);\r\n    }\r\n\r\n    //Add line of best fit for latest data since april to next april\r\n\r\n\r\n    //Default to last april - april\r\n\r\n\r\n    var c = $('#' + element).highcharts({\r\n      title: { text: '' },\r\n      xAxis: {\r\n        max: nextApril.getTime(),\r\n        type: 'datetime'\r\n      },\r\n      yAxis: {\r\n        title: { text: 'Quality standard performance' },\r\n        max: maxValue + 5,\r\n        min: 0,\r\n        plotLines: [{\r\n          value: target,\r\n          color: 'green',\r\n          dashStyle: 'shortdash',\r\n          width: 2,\r\n          label: {\r\n            text: 'Target - ' + (target) + '%'\r\n          },\r\n        }]\r\n      },\r\n      legend: { enabled: true },\r\n      tooltip: {\r\n        pointFormat: '<span style=\"color:{point.color}\">\\u25CF</span> {series.name}: <b>{point.y:.2f}%</b><br/>'\r\n      },\r\n\r\n      navigator: {\r\n        enabled: true\r\n      },\r\n\r\n      series: series\r\n    });\r\n\r\n    c.highcharts().axes[0].setExtremes(aprilBeforeThat.getTime(), lastApril.getTime(), undefined, false);\r\n\r\n  },\r\n\r\n  drawAnalytics: function(element, data, selectSeriesFn) {\r\n\r\n    cht.cloneToolTip = null;\r\n    cht.cloneToolTip2 = null;\r\n\r\n    $('#' + element).highcharts({\r\n      chart: {\r\n        type: \"column\",\r\n        backgroundColor: \"#F3F9F9\",\r\n        height: 200,\r\n        events: {\r\n          click: function(event) {\r\n            selectSeriesFn();\r\n\r\n            /*if (cht.cloneToolTip) {\r\n              this.container.firstChild.removeChild(cht.cloneToolTip);\r\n              cht.cloneToolTip = null;\r\n            }\r\n            if (cht.cloneToolTip2) {\r\n              cht.cloneToolTip2.remove();\r\n              cht.cloneToolTip2 = null;\r\n            }*/\r\n\r\n            return false;\r\n          }\r\n        }\r\n      },\r\n      title: {\r\n        text: 'Patients with improvement opportunities'\r\n      },\r\n      subtitle: {\r\n        text: document.ontouchstart === undefined ?\r\n          'Click a column to filter the patient list' : 'Tap a column to filter the patient list'\r\n      },\r\n      xAxis: {\r\n        categories: data.map(function(v, i) {\r\n          return v[0];\r\n        })\r\n      },\r\n      yAxis: {\r\n        title: {\r\n          text: 'Number of patients'\r\n        },\r\n        stackLabels: {\r\n          enabled: true,\r\n          style: {\r\n            fontWeight: 'bold',\r\n            color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'\r\n          }\r\n        }\r\n      },\r\n      legend: {\r\n        enabled: false\r\n      },\r\n\r\n      tooltip: {\r\n        animation: false,\r\n\r\n        formatter: function() {\r\n          return this.point.desc.replace(/<a[^h]+href=[\\\"'].*?[\\\"'][^h]*>(.*?)<\\/a>/,\"$1\").match(/.{1,40}[^ ]* ?/g).join(\"<br>\");\r\n        },\r\n\r\n        style: {\r\n          \"whiteSpace\": \"normal\"\r\n        },\r\n\r\n        useHTML: true\r\n      },\r\n\r\n      plotOptions: {\r\n\r\n        column: {\r\n          dataLabels: {\r\n            enabled: true,\r\n            color: 'black'\r\n          }\r\n        },\r\n\r\n        series: {\r\n          cursor: 'pointer',\r\n          point: {\r\n            events: {\r\n              click: function(event) {\r\n                var numPoints = this.series.points.length;\r\n\r\n                selectSeriesFn(this.category);\r\n\r\n                /*if (cht.cloneToolTip) {\r\n                  this.series.chart.container.firstChild.removeChild(cht.cloneToolTip);\r\n                }\r\n                if (cht.cloneToolTip2) {\r\n                  cht.cloneToolTip2.remove();\r\n                }\r\n                cht.cloneToolTip = this.series.chart.tooltip.label.element.cloneNode(true);\r\n                this.series.chart.container.firstChild.appendChild(cht.cloneToolTip);\r\n\r\n                cht.cloneToolTip2 = $('.highcharts-tooltip').clone();\r\n                $(this.series.chart.container).append(cht.cloneToolTip2);*/\r\n\r\n                return false;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      series: [{\r\n        data: data.map(function(v, i) {\r\n          return {\r\n            y: v[2],\r\n            desc: v[1],\r\n            color: Highcharts.getOptions().colors[i]\r\n          };\r\n        })\r\n      }]\r\n    });\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = cht;\r\n","var log = require('./log'),\r\n  lookup = require('./lookup');\r\n\r\n\r\nvar _getAllIndicatorData = function(callback) {\r\n  var r = Math.random();\r\n  $.getJSON(\"data/indicators.json?v=\" + r, function(file) {\r\n    dt.indicators = file;\r\n\r\n    dt.indicators.forEach(function(indicator) {\r\n      var percentage = Math.round(100 * indicator.values[1][1] * 100 / indicator.values[2][1]) / 100;\r\n      indicator.performance = indicator.values[1][1] + \" / \" + indicator.values[2][1] + \" (\" + percentage + \"%)\";\r\n      indicator.target = indicator.values[3][1] * 100 + \"%\";\r\n      indicator.up = percentage > Math.round(100 * indicator.values[1][2] * 100 / indicator.values[2][2]) / 100;\r\n      var trend = indicator.values[1].map(function(val, idx) {\r\n        return Math.round(100 * val * 100 / indicator.values[2][idx]) / 100;\r\n      }).slice(1, 10);\r\n      trend.reverse();\r\n      indicator.trend = trend.join(\",\");\r\n      var dates = indicator.values[0].slice(1, 10);\r\n      dates.reverse();\r\n      indicator.dates = dates;\r\n    });\r\n\r\n\r\n    callback(dt.indicators);\r\n  });\r\n};\r\n\r\nvar _getAllIndicatorDataSync = function(callback) {\r\n  var r = Math.random();\r\n  $.ajax({\r\n    url: \"data/indicators.json?v=\" + r,\r\n    async: false,\r\n    success: function(file) {\r\n      dt.indicators = file;\r\n\r\n      dt.indicators.forEach(function(indicator) {\r\n        var percentage = Math.round(100 * indicator.values[1][1] * 100 / indicator.values[2][1]) / 100;\r\n        indicator.performance = indicator.values[1][1] + \" / \" + indicator.values[2][1] + \" (\" + percentage + \"%)\";\r\n        indicator.target = indicator.values[3][1] * 100 + \"%\";\r\n        indicator.up = percentage > Math.round(100 * indicator.values[1][2] * 100 / indicator.values[2][2]) / 100;\r\n        var trend = indicator.values[1].map(function(val, idx) {\r\n          return Math.round(100 * val * 100 / indicator.values[2][idx]) / 100;\r\n        }).slice(1, 10);\r\n        trend.reverse();\r\n        indicator.trend = trend.join(\",\");\r\n        var dates = indicator.values[0].slice(1, 10);\r\n        dates.reverse();\r\n        indicator.dates = dates;\r\n      });\r\n\r\n    }\r\n  });\r\n\r\n  return dt.indicators;\r\n};\r\n\r\nvar _getIndicatorData = function(indicator, callback) {\r\n  var r = Math.random();\r\n  $.getJSON(\"data/idata.\" + indicator + \".json?v=\" + r, function(file) {\r\n    dt.indicators[indicator] = file;\r\n\r\n    //apply which categories people belong to\r\n    Object.keys(dt.indicators[indicator].patients).forEach(function(patient) {\r\n      dt.indicators[indicator].patients[patient].opportunities = [];\r\n      dt.indicators[indicator].opportunities.forEach(function(opp, idx) {\r\n        if (opp.patients.indexOf(+patient) > -1) {\r\n          dt.indicators[indicator].patients[patient].opportunities.push(idx);\r\n        }\r\n      });\r\n    });\r\n\r\n    callback(dt.indicators[indicator]);\r\n  });\r\n};\r\n\r\nvar _getIndicatorDataSync = function(indicator) {\r\n  var r = Math.random();\r\n  $.ajax({\r\n    url: \"data/idata.\" + indicator + \".json?v=\" + r,\r\n    async: false,\r\n    success: function(file) {\r\n      dt.indicators[indicator] = file;\r\n\r\n      //apply which categories people belong to\r\n      Object.keys(dt.indicators[indicator].patients).forEach(function(patient) {\r\n        dt.indicators[indicator].patients[patient].opportunities = [];\r\n        dt.indicators[indicator].opportunities.forEach(function(opp, idx) {\r\n          if (opp.patients.indexOf(+patient) > -1) {\r\n            dt.indicators[indicator].patients[patient].opportunities.push(idx);\r\n          }\r\n        });\r\n      });\r\n\r\n    }\r\n  });\r\n  return dt.indicators[indicator];\r\n};\r\n\r\nvar _getFakePatientData = function(patient, callback) {\r\n  var r = Math.random(),\r\n    isAsync = typeof(callback) === \"function\";\r\n  if (dt.patients && dt.patients.patient) {\r\n    if (isAsync) return callback(dt.patients.patient);\r\n    else return dt.patients.patient;\r\n  }\r\n  $.ajax({\r\n    url: \"data/patient.json?v=\" + r,\r\n    async: isAsync,\r\n    success: function(file) {\r\n      if (!dt.patients) dt.patients = {};\r\n      dt.patients.patient = file;\r\n      dt.patients[patient] = file;\r\n\r\n      if (isAsync) callback(dt.patients.patient);\r\n    }\r\n  });\r\n  if (!isAsync) return dt.patients.patient;\r\n};\r\n\r\nvar _getPatientData = function(patient, callback) {\r\n  //if callback provided do async - else do sync\r\n  var r = Math.random(),\r\n    isAsync = typeof(callback) === \"function\";\r\n\r\n  if (dt.patients && dt.patients[patient]) {\r\n    if (isAsync) return callback(dt.patients[patient]);\r\n    else return dt.patients[patient];\r\n  }\r\n\r\n  $.ajax({\r\n    url: \"data/\" + patient + \".json?v=\" + r,\r\n    async: isAsync,\r\n    success: function(file) {\r\n      if (!dt.patients) dt.patients = {};\r\n      dt.patients[patient] = file;\r\n\r\n      if (isAsync) callback(dt.patients[patient]);\r\n    },\r\n    error: function() {\r\n      if (dt.patients.patient && isAsync) {\r\n        dt.patients[patient] = dt.patients.patient;\r\n        return callback(dt.patients.patient);\r\n      } else if (!dt.patients.patient) {\r\n        _getFakePatientData(patient, callback);\r\n      }\r\n    }\r\n  });\r\n\r\n  if (!isAsync) return dt.patients.patient;\r\n};\r\n\r\nvar dt = {\r\n\r\n  pathwayNames: {},\r\n  diseases: [],\r\n  options: [],\r\n  patLookup: {},\r\n\r\n  getPatietListForStandard: function(pathwayId, pathwayStage, standard) {\r\n    var patients = dt.removeDuplicates(dt[pathwayId][pathwayStage].standards[standard].opportunities.reduce(function(a, b) {\r\n      return a.patients ? a.patients.concat(b.patients) : a.concat(b.patients);\r\n    }));\r\n    return patients;\r\n  },\r\n\r\n  getPatientStatus: function(patientId, pathwayId, pathwayStage, standard) {\r\n    if (dt.patients[patientId].breach) {\r\n      if (dt.patients[patientId].breach.filter(function(val) {\r\n          return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard;\r\n        }).length > 0) {\r\n        return \"missed\";\r\n      } else if (dt.patients[patientId].breach.filter(function(val) {\r\n          return val.pathwayId === pathwayId && val.pathwayStage === \"diagnosis\";\r\n        }).length > 0 && pathwayStage !== \"diagnosis\") {\r\n        return \"not\";\r\n      } else if (dt.patients[patientId].breach.filter(function(val) {\r\n          return val.pathwayId === pathwayId;\r\n        }).length > 0) {\r\n        return \"ok\";\r\n      } else {\r\n        return \"not\";\r\n      }\r\n    } else {\r\n      return \"not\";\r\n    }\r\n  },\r\n\r\n  getNumeratorForStandard: function(pathwayId, pathwayStage, standard) {\r\n    var patients = dt.getPatietListForStandard(pathwayId, pathwayStage, standard);\r\n    return patients.length;\r\n  },\r\n\r\n  getDenominatorForStandard: function(pathwayId, pathwayStage) {\r\n    var patients = dt[pathwayId][pathwayStage].patientsOk;\r\n    for (var standard in dt[pathwayId][pathwayStage].standards) {\r\n      var newPatients = dt.getPatietListForStandard(pathwayId, pathwayStage, standard);\r\n      patients = patients.concat(newPatients);\r\n    }\r\n    return dt.removeDuplicates(patients).length;\r\n  },\r\n\r\n  removeDuplicates: function(array) {\r\n    var arrResult = {};\r\n    var rtn = [];\r\n    for (var i = 0; i < array.length; i++) {\r\n      arrResult[array[i]] = array[i];\r\n    }\r\n    for (var item in arrResult) {\r\n      rtn.push(arrResult[item]);\r\n    }\r\n    return rtn;\r\n  },\r\n\r\n  numberOfStandardsMissed: function(patientId) {\r\n    if (!dt.patients[patientId].breach) return 0;\r\n    var a = dt.patients[patientId].breach.map(function(val) {\r\n      return val.pathwayId + val.pathwayStage + val.standard;\r\n    });\r\n    var obj = {};\r\n    for (var i = 0; i < a.length; i++) {\r\n      obj[a[i]] = \"\";\r\n    }\r\n    return Object.keys(obj).length;\r\n  },\r\n\r\n  getAllPatients: function() {\r\n    var pList = [],\r\n      i, k, prop;\r\n    for (k = 0; k < dt.diseases.length; k++) {\r\n      for (i in lookup.categories) {\r\n        for (prop in dt[dt.diseases[k].id][i].bdown) {\r\n          if (dt[dt.diseases[k].id][i].bdown.hasOwnProperty(prop)) {\r\n            pList = pList.concat(dt[dt.diseases[k].id][i].bdown[prop].patients);\r\n          }\r\n        }\r\n        pList = pList.concat(dt[dt.diseases[k].id][i].patientsOk);\r\n      }\r\n    }\r\n    pList = dt.removeDuplicates(pList);\r\n    var patients = pList.map(function(patientId) {\r\n      var ret = dt.patients[patientId];\r\n      ret.nhsNumber = dt.patLookup ? dt.patLookup[patientId] : patientId;\r\n      ret.patientId = patientId;\r\n      ret.items = []; //The fields in the patient list table\r\n      ret.items.push(dt.numberOfStandardsMissed(patientId));\r\n      return ret;\r\n    });\r\n\r\n    return patients;\r\n  },\r\n\r\n  get: function(callback, json) {\r\n    //get text\r\n    $.getJSON(\"data/text.json?v=\" + Math.random(), function(textfile) {\r\n      dt.text = textfile.pathways;\r\n\r\n      if (json) {\r\n        dt.newload(json);\r\n        if (typeof callback === 'function') callback();\r\n      } else {\r\n        $.getJSON(\"data/data.json?v=\" + Math.random(), function(file) {\r\n          dt.newload(file);\r\n          if (typeof callback === 'function') callback();\r\n        }).fail(function(err) {\r\n          alert(\"data/data.json failed to load!! - if you've changed it recently check it's valid json at jsonlint.com\");\r\n        });\r\n      }\r\n\r\n    }).fail(function(err) {\r\n      alert(\"data/text.json failed to load!! - if you've changed it recently check it's valid json at jsonlint.com\");\r\n    });\r\n  },\r\n\r\n  newload: function(file) {\r\n    dt.indicators = file.indicators;\r\n    dt.pathwayNames = {};\r\n\r\n    if(file.text) dt.text = file.text;\r\n\r\n    dt.indicators.forEach(function(indicator) {\r\n      var last = indicator.values[0].length-1;\r\n      var pathwayId = indicator.id.split(\".\")[0];\r\n      var pathwayStage = indicator.id.split(\".\")[1];\r\n      var standard = indicator.id.split(\".\")[2];\r\n      if (!dt.pathwayNames[pathwayId]) dt.pathwayNames[pathwayId] = \"\";\r\n      var percentage = Math.round(100 * indicator.values[1][last] * 100 / indicator.values[2][last]) / 100;\r\n      indicator.performance = {\r\n        fraction: indicator.values[1][last] + \"/\" + indicator.values[2][last],\r\n        percentage: percentage\r\n      };\r\n      indicator.benchmark = \"90%\"; //TODO magic number\r\n      indicator.target = indicator.values[3][last] * 100 + \"%\";\r\n      indicator.up = percentage > Math.round(100 * indicator.values[1][last-1] * 100 / indicator.values[2][last-1]) / 100;\r\n      var trend = indicator.values[1].map(function(val, idx) {\r\n        return Math.round(100 * val * 100 / indicator.values[2][idx]) / 100;\r\n      }).slice(Math.max(1,last-10), Math.max(1,last-10)+11);\r\n      //trend.reverse();\r\n      indicator.trend = trend.join(\",\");\r\n      var dates = indicator.values[0].slice(Math.max(1,last-10), Math.max(1,last-10)+11);\r\n      //dates.reverse();\r\n      indicator.dates = dates;\r\n      if (dt.text.pathways[pathwayId] && dt.text.pathways[pathwayId][pathwayStage] && dt.text.pathways[pathwayId][pathwayStage].standards[standard]) {\r\n        indicator.description = dt.text.pathways[pathwayId][pathwayStage].standards[standard].description;\r\n        indicator.tagline = dt.text.pathways[pathwayId][pathwayStage].standards[standard].tagline;\r\n        indicator.positiveMessage = dt.text.pathways[pathwayId][pathwayStage].standards[standard].positiveMessage;\r\n      } else {\r\n        indicator.description = \"No description specified\";\r\n        indicator.tagline = \"\";\r\n      }\r\n      indicator.aboveTarget = indicator.performance.percentage > +indicator.values[3][last]*100;\r\n\r\n      dt.indicators[indicator.id] = { performance: indicator.performance, tagline: indicator.tagline, positiveMessage: indicator.positiveMessage, target: indicator.target, \"opportunities\": indicator.opportunities || [], \"patients\": {} };\r\n\r\n      //apply which categories people belong to\r\n      dt.patients = {};\r\n      dt.patientArray = [];\r\n\r\n      Object.keys(file.patients).forEach(function(patient) {\r\n        dt.patientArray.push(patient);\r\n        dt.patients[patient] = file.patients[patient];\r\n        dt.indicators[indicator.id].patients[patient] = {};\r\n        dt.indicators[indicator.id].patients[patient].opportunities = [];\r\n        dt.indicators[indicator.id].opportunities.forEach(function(opp, idx) {\r\n          if (opp.patients.indexOf(+patient) > -1) {\r\n            dt.indicators[indicator.id].patients[patient].opportunities.push(idx);\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n\r\n  },\r\n\r\n  load: function(file) {\r\n    var d = \"\",\r\n      j, k, key, data = file.diseases;\r\n\r\n    dt = jQuery.extend(dt, data); //copy\r\n\r\n    dt.patients = file.patients;\r\n    dt.codes = file.codes;\r\n    dt.patientArray = [];\r\n    for (var o in file.patients) {\r\n      if (file.patients.hasOwnProperty(o)) {\r\n        dt.patientArray.push(o);\r\n      }\r\n    }\r\n\r\n    for (d in data) {\r\n      dt.pathwayNames[d] = data[d][\"display-name\"];\r\n      var diseaseObject = {\r\n        \"id\": d,\r\n        \"link\": data[d].link ? data[d].link : \"dt/\" + d,\r\n        \"faIcon\": data[d].icon,\r\n        \"name\": data[d][\"display-name\"],\r\n        \"text\": {\r\n          \"dt\": {\r\n            \"tooltip\": data[d][\"side-panel-tooltip\"]\r\n          }\r\n        }\r\n      };\r\n      if (data[d].monitoring.text) {\r\n        diseaseObject.text.monitoring = data[d].monitoring.text.sidePanel;\r\n      }\r\n      if (data[d].treatment.text) {\r\n        diseaseObject.text.treatment = data[d].treatment.text.sidePanel;\r\n      }\r\n      if (data[d].diagnosis.text) {\r\n        diseaseObject.text.diagnosis = data[d].diagnosis.text.sidePanel;\r\n      }\r\n      if (data[d].exclusions.text) {\r\n        diseaseObject.text.exclusions = data[d].exclusions.text.sidePanel;\r\n      }\r\n      this.diseases.push(diseaseObject);\r\n      dt[d].suggestions = log.plan[d].team;\r\n      $.extend(dt[d].monitoring, {\r\n        \"breakdown\": [],\r\n        \"bdown\": {}\r\n      });\r\n      $.extend(dt[d].treatment, {\r\n        \"breakdown\": [],\r\n        \"bdown\": {}\r\n      });\r\n      $.extend(dt[d].diagnosis, {\r\n        \"breakdown\": [],\r\n        \"bdown\": {}\r\n      });\r\n      $.extend(dt[d].exclusions, {\r\n        \"breakdown\": [],\r\n        \"bdown\": {}\r\n      });\r\n\r\n      if (!dt[d].monitoring.header) continue;\r\n      for (key in dt[d].monitoring.standards) {\r\n        this.options.push({\r\n          \"value\": this.options.length,\r\n          \"pathwayId\": d,\r\n          \"pathwayStage\": \"monitoring\",\r\n          \"standard\": key,\r\n          \"text\": this.pathwayNames[d] + ' - ' + \"Monitoring\" + ' - ' + dt[d].monitoring.standards[key].tab.title\r\n        });\r\n        for (j = 0; j < dt[d].monitoring.standards[key].opportunities.length; j++) {\r\n          dt[d].monitoring.bdown[dt[d].monitoring.standards[key].opportunities[j].name] = dt[d].monitoring.standards[key].opportunities[j];\r\n          dt[d].monitoring.bdown[dt[d].monitoring.standards[key].opportunities[j].name].suggestions = log.plan[d].monitoring.individual[dt[d].monitoring.standards[key].opportunities[j].name];\r\n          for (k = 0; k < dt[d].monitoring.standards[key].opportunities[j].patients.length; k++) {\r\n            if (!dt.patients[dt[d].monitoring.standards[key].opportunities[j].patients[k]].breach) dt.patients[dt[d].monitoring.standards[key].opportunities[j].patients[k]].breach = [];\r\n            dt.patients[dt[d].monitoring.standards[key].opportunities[j].patients[k]].breach.push({\r\n              \"pathwayId\": d,\r\n              \"pathwayStage\": \"monitoring\",\r\n              \"standard\": key,\r\n              \"subsection\": dt[d].monitoring.standards[key].opportunities[j].name\r\n            });\r\n          }\r\n        }\r\n      }\r\n      for (key in dt[d].diagnosis.standards) {\r\n        this.options.push({\r\n          \"value\": this.options.length,\r\n          \"pathwayId\": d,\r\n          \"pathwayStage\": \"diagnosis\",\r\n          \"standard\": key,\r\n          \"text\": this.pathwayNames[d] + ' - ' + \"Diagnosis\" + ' - ' + dt[d].diagnosis.standards[key].tab.title\r\n        });\r\n        for (j = 0; j < dt[d].diagnosis.standards[key].opportunities.length; j++) {\r\n          dt[d].diagnosis.bdown[dt[d].diagnosis.standards[key].opportunities[j].name] = dt[d].diagnosis.standards[key].opportunities[j];\r\n          dt[d].diagnosis.bdown[dt[d].diagnosis.standards[key].opportunities[j].name].suggestions = log.plan[d].diagnosis.individual[dt[d].diagnosis.standards[key].opportunities[j].name];\r\n          for (k = 0; k < dt[d].diagnosis.standards[key].opportunities[j].patients.length; k++) {\r\n            if (!dt.patients[dt[d].diagnosis.standards[key].opportunities[j].patients[k]].breach) dt.patients[dt[d].diagnosis.standards[key].opportunities[j].patients[k]].breach = [];\r\n            dt.patients[dt[d].diagnosis.standards[key].opportunities[j].patients[k]].breach.push({\r\n              \"pathwayId\": d,\r\n              \"pathwayStage\": \"diagnosis\",\r\n              \"standard\": key,\r\n              \"subsection\": dt[d].diagnosis.standards[key].opportunities[j].name\r\n            });\r\n          }\r\n        }\r\n      }\r\n      for (key in dt[d].treatment.standards) {\r\n        this.options.push({\r\n          \"value\": this.options.length,\r\n          \"pathwayId\": d,\r\n          \"pathwayStage\": \"treatment\",\r\n          \"standard\": key,\r\n          \"text\": this.pathwayNames[d] + ' - ' + \"Treatment\" + ' - ' + dt[d].treatment.standards[key].tab.title\r\n        });\r\n        for (j = 0; j < dt[d].treatment.standards[key].opportunities.length; j++) {\r\n          dt[d].treatment.bdown[dt[d].treatment.standards[key].opportunities[j].name] = dt[d].treatment.standards[key].opportunities[j];\r\n          dt[d].treatment.bdown[dt[d].treatment.standards[key].opportunities[j].name].suggestions = log.plan[d].treatment.individual[dt[d].treatment.standards[key].opportunities[j].name];\r\n          for (k = 0; k < dt[d].treatment.standards[key].opportunities[j].patients.length; k++) {\r\n            if (!dt.patients[dt[d].treatment.standards[key].opportunities[j].patients[k]].breach) dt.patients[dt[d].treatment.standards[key].opportunities[j].patients[k]].breach = [];\r\n            dt.patients[dt[d].treatment.standards[key].opportunities[j].patients[k]].breach.push({\r\n              \"pathwayId\": d,\r\n              \"pathwayStage\": \"treatment\",\r\n              \"standard\": key,\r\n              \"subsection\": dt[d].treatment.standards[key].opportunities[j].name\r\n            });\r\n          }\r\n        }\r\n      }\r\n      for (key in dt[d].exclusions.standards) {\r\n        this.options.push({\r\n          \"value\": this.options.length,\r\n          \"pathwayId\": d,\r\n          \"pathwayStage\": \"exclusions\",\r\n          \"standard\": key,\r\n          \"text\": this.pathwayNames[d] + ' - ' + \"Exclusions\" + ' - ' + dt[d].exclusions.standards[key].tab.title\r\n        });\r\n        for (j = 0; j < dt[d].exclusions.standards[key].opportunities.length; j++) {\r\n          dt[d].exclusions.bdown[dt[d].exclusions.standards[key].opportunities[j].name] = dt[d].exclusions.standards[key].opportunities[j];\r\n          dt[d].exclusions.bdown[dt[d].exclusions.standards[key].opportunities[j].name].suggestions = log.plan[d].exclusions.individual[dt[d].exclusions.standards[key].opportunities[j].name];\r\n          for (k = 0; k < dt[d].exclusions.standards[key].opportunities[j].patients.length; k++) {\r\n            if (!dt.patients[dt[d].exclusions.standards[key].opportunities[j].patients[k]].breach) dt.patients[dt[d].exclusions.standards[key].opportunities[j].patients[k]].breach = [];\r\n            dt.patients[dt[d].exclusions.standards[key].opportunities[j].patients[k]].breach.push({\r\n              \"pathwayId\": d,\r\n              \"pathwayStage\": \"exclusions\",\r\n              \"standard\": key,\r\n              \"subsection\": dt[d].exclusions.standards[key].opportunities[j].name\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  getAllIndicatorData: function(callback) {\r\n    if (dt.indicators) {\r\n      return callback(dt.indicators);\r\n    } else {\r\n      _getAllIndicatorData(callback);\r\n    }\r\n  },\r\n\r\n  getAllIndicatorDataSync: function() {\r\n    if (dt.indicators) {\r\n      return dt.indicators;\r\n    } else {\r\n      return _getAllIndicatorDataSync();\r\n    }\r\n  },\r\n\r\n  getIndicatorData: function(indicator, callback) {\r\n    if (!dt.indicators) {\r\n      _getAllIndicatorData(function(data) {\r\n        _getIndicatorData(indicator, callback);\r\n      });\r\n    } else if (dt.indicators && dt.indicators[indicator]) {\r\n      return callback(dt.indicators[indicator]);\r\n    } else {\r\n      _getIndicatorData(indicator, callback);\r\n    }\r\n  },\r\n\r\n  getIndicatorDataSync: function(indicator) {\r\n    dt.getAllIndicatorDataSync();\r\n    if (dt.indicators[indicator]) {\r\n      return dt.indicators[indicator];\r\n    } else {\r\n      return _getIndicatorDataSync(indicator);\r\n    }\r\n  },\r\n\r\n  getPatientData: function(patientId, callback) {\r\n    return _getPatientData(patientId, callback);\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = dt;\r\n","var data = require('./data'),\r\nMustache = require('mustache');\r\n\r\nvar layout = {\r\n\r\n  elements: {},\r\n\r\n  //Side panel, navigation, header bar and main page\r\n  showMainView: function() {\r\n    //Set up navigation panel\r\n    ////layout.showSidePanel();\r\n    ////layout.showNavigation(data.diseases, idx, $('#main-dashboard'));\r\n\r\n    $('#bottomnavbar').hide();\r\n    layout.showHeaderBarItems();\r\n\r\n    //Show main dashboard page\r\n    layout.showPage('main-dashboard');\r\n  },\r\n\r\n  clearNavigation: function() {\r\n    $(\"aside.left-panel nav.navigation > ul > li > ul\").slideUp(300);\r\n    $(\"aside.left-panel nav.navigation > ul > li\").removeClass('active');\r\n  },\r\n\r\n  showNavigation: function(list, idx, parent) {\r\n    if (layout.elements.navigation) {\r\n\r\n      if (idx === -1) {\r\n        layout.clearNavigation();\r\n        $('aside a[href=\"#welcome\"]:first').closest('li').addClass('active');\r\n      } else if (idx >= list.length) {\r\n        layout.clearNavigation();\r\n        $('aside a[href=\"#patients\"]').closest('li').addClass('active');\r\n      } else if (!$('aside a[href=\"#' + list[idx].link + '\"]:first').closest('li').hasClass('active')) {\r\n        layout.clearNavigation();\r\n        //set active\r\n        $('aside a[href=\"#' + list[idx].link + '\"]').next().slideToggle(300);\r\n        $('aside a[href=\"#' + list[idx].link + '\"]').closest('li').addClass('active');\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    var tempMust = $('#pathway-picker').html();\r\n    var itemTemplate = $('#pathway-picker-item').html();\r\n    Mustache.parse(tempMust);\r\n    Mustache.parse(itemTemplate);\r\n\r\n    list = list.slice();\r\n    list[0].isBreakAbovePractice = true;\r\n    for (var i = 0; i < list.length; i++) {\r\n      list[i].hasSubItems = true;\r\n    }\r\n    list.unshift({\r\n      \"link\": \"welcome\",\r\n      \"faIcon\": \"fa-home\",\r\n      \"name\": \"Agreed actions\",\r\n      \"isBreakAboveHome\": true,\r\n      \"text\": {\r\n        \"main\": {\r\n          \"tooltip\": \"Agreed tooltip - edit in script.js\"\r\n        }\r\n      }\r\n    });\r\n    list.push({\r\n      \"link\": \"patients\",\r\n      \"faIcon\": \"fa-users\",\r\n      \"name\": \"All Patients\",\r\n      \"isBreakAbovePatient\": true,\r\n      \"text\": {\r\n        \"main\": {\r\n          \"tooltip\": \"All patients tooltip - edit in script.js\"\r\n        }\r\n      }\r\n    });\r\n\r\n    list.map(function(v, i, arr) {\r\n      v.isSelected = i === idx + 1;\r\n      return v;\r\n    });\r\n\r\n    var renderedBefore = Mustache.render(tempMust, {\r\n      \"items\": list\r\n    }, {\r\n      \"item\": itemTemplate,\r\n      \"subItem\": $('#pathway-picker-sub-item').html()\r\n    });\r\n    $('#aside-toggle nav:first').html(renderedBefore);\r\n\r\n    $('.user').on('click', function() {\r\n      template.loadContent('#agreedactions');\r\n    });\r\n\r\n    layout.elements.navigation = true;\r\n  },\r\n\r\n  showPage: function(page) {\r\n    if (layout.page === page) return;\r\n    layout.page = page;\r\n    $('.page').hide();\r\n    $('#' + page).show();\r\n\r\n    if (page !== 'main-dashboard') {\r\n      ////layout.hideSidePanel();\r\n      $('#bottomnavbar').show();\r\n      layout.hideHeaderBarItems();\r\n    }\r\n  },\r\n\r\n  showSidePanel: function() {\r\n    if (layout.elements.navigtion) return;\r\n    layout.elements.navigtion = true;\r\n    $('#main').addClass('content');\r\n    $('#topnavbar').addClass('full');\r\n    $('#aside-toggle').show();\r\n    $('#bottomnavbar').hide();\r\n  },\r\n\r\n  hideSidePanel: function() {\r\n    if (layout.elements.navigtion === false) return;\r\n    layout.elements.navigtion = false;\r\n    $('#main').removeClass('content');\r\n    $('#topnavbar').removeClass('full');\r\n    $('#aside-toggle').hide();\r\n    $('#bottomnavbar').show();\r\n  },\r\n\r\n  showHeaderBarItems: function() {\r\n    if (layout.elements.headerbar) return;\r\n    layout.elements.headerbar = true;\r\n    $('.hide-if-logged-out').show();\r\n  },\r\n\r\n  hideHeaderBarItems: function() {\r\n    if (layout.elements.headerbar === false) return;\r\n    layout.elements.headerbar = false;\r\n    $('.hide-if-logged-out').hide();\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = layout;\r\n","var notify = require('./notify');\r\n\r\nvar log = {\r\n  reason: {},\r\n\r\n  getObj: function(options) {\r\n    var obj = JSON.parse(localStorage.bb);\r\n\r\n    if (options && options.length > 0) {\r\n      options.forEach(function(opt) {\r\n        if (!obj[opt.name]) {\r\n          obj[opt.name] = opt.value;\r\n          log.setObj(obj);\r\n        }\r\n      });\r\n    }\r\n\r\n    return obj;\r\n  },\r\n\r\n  setObj: function(obj) {\r\n    localStorage.bb = JSON.stringify(obj);\r\n  },\r\n\r\n  loadActions: function(callback) {\r\n    var r = Math.random();\r\n    log.plan = [];\r\n    log.text = [];\r\n    callback();\r\n    /*$.getJSON(\"action-plan.json?v=\" + r, function(file) {\r\n      log.plan = file.diseases;\r\n      log.text = file.plans;\r\n      callback();\r\n    });*/\r\n  },\r\n\r\n  editAction: function(id, actionId, agree, done, reason) {\r\n    var logText, obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n    if (!id) alert(\"ACTION TEAM/IND ID\");\r\n    if (!actionId) alert(\"ACTION ID\");\r\n\r\n    if (!obj.actions[id]) {\r\n      obj.actions[id] = {};\r\n    }\r\n\r\n    var dataToSend = {\r\n      event: {\r\n        what: \"agree\",\r\n        when: new Date().getTime(),\r\n        who: JSON.parse(localStorage.bb).email,\r\n        detail: [\r\n          { key: \"patient\", \"value\": id },\r\n          { key: \"action\", \"value\": actionId }\r\n          ]\r\n      }\r\n    };\r\n\r\n    if (agree) {\r\n      logText = \"You agreed with this suggested action on \" + (new Date()).toDateString();\r\n    } else if (agree === false) {\r\n      var reasonText = log.reason.reason === \"\" && log.reason.reasonText === \"\" ? \" - no reason given\" : \" . You disagreed because you said: '\" + log.reason.reason + \"; \" + log.reason.reasonText + \".'\";\r\n      logText = \"You disagreed with this action on \" + (new Date()).toDateString() + reasonText;\r\n\r\n      dataToSend.event.whate = \"disagree\";\r\n      if(reason && reason.reason) dataToSend.event.detail.push(  { key: \"reason\", value: reason.reason });\r\n      if(reason && reason.reasonText) dataToSend.event.detail.push(  { key: \"reasonText\", value: reason.reasonText });\r\n    }\r\n\r\n    if(agree || agree===false){\r\n      console.log(dataToSend);\r\n      $.ajax({\r\n        type: \"POST\",\r\n        url: \"http://130.88.250.206:9100/pingr\",\r\n        data: JSON.stringify(dataToSend),\r\n        success: function(d) { console.log(d); },\r\n        dataType: \"json\",\r\n        contentType: \"application/json\"\r\n      });\r\n    }\r\n\r\n    if (done) {\r\n      logText = \"You agreed with this suggested action on \" + (new Date()).toDateString();\r\n    }\r\n\r\n    if (!obj.actions[id][actionId]) {\r\n      obj.actions[id][actionId] = {\r\n        \"agree\": agree ? agree : false,\r\n        \"done\": done ? done : false,\r\n        \"history\": [logText]\r\n      };\r\n    } else {\r\n      if (agree === true || agree === false) obj.actions[id][actionId].agree = agree;\r\n      if (done === true || done === false) obj.actions[id][actionId].done = done;\r\n      if (logText) {\r\n        if (obj.actions[id][actionId].history) obj.actions[id][actionId].history.unshift(logText);\r\n        else obj.actions[id][actionId].done.history = [logText];\r\n      }\r\n    }\r\n\r\n    if (reason && obj.actions[id][actionId].agree === false) {\r\n      obj.actions[id][actionId].reason = reason;\r\n    } else {\r\n      delete obj.actions[id][actionId].reason;\r\n    }\r\n\r\n    log.setObj(obj);\r\n    notify.showSaved();\r\n  },\r\n\r\n  ignoreAction: function(id, actionId) {\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n    obj.actions[id][actionId].agree = null;\r\n    delete obj.actions[id][actionId].reason;\r\n    log.setObj(obj);\r\n  },\r\n\r\n  getActions: function() {\r\n    return log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]).actions;\r\n  },\r\n\r\n  listActions: function(id, pathwayId) {\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n    arr = [];\r\n    if (!id) return obj.actions;\r\n    if (!obj.actions[id]) return arr;\r\n    for (var prop in obj.actions[id]) {\r\n      obj.actions[id][prop].id = prop;\r\n      if (!obj.actions[id][prop].text)\r\n        arr.push(obj.actions[id][prop]);\r\n    }\r\n    return arr;\r\n  },\r\n\r\n  //id is either \"team\" or the patientId\r\n  recordFeedback: function(pathwayId, id, suggestion, reason, reasonText) {\r\n    log.reason = {\r\n      \"reason\": reason,\r\n      \"reasonText\": reasonText\r\n    };\r\n    var obj = log.getObj([{\r\n      name: \"feedback\",\r\n      value: []\r\n    }]);\r\n\r\n    var item = {\r\n      \"pathwayId\": pathwayId,\r\n      \"id\": id,\r\n      \"val\": suggestion\r\n    };\r\n    if (reasonText !== \"\") item.reasonText = reasonText;\r\n    if (reason !== \"\") item.reason = reason;\r\n    obj.feedback.push(item);\r\n    log.setObj(obj);\r\n  },\r\n\r\n  getEvents: function() {\r\n    return log.getObj([{\r\n      name: \"events\",\r\n      value: []\r\n    }]).events;\r\n  },\r\n\r\n  recordEvent: function(pathwayId, id, name) {\r\n    var obj = log.getObj([{\r\n      name: \"events\",\r\n      value: []\r\n    }]);\r\n    obj.events.push({\r\n      \"pathwayId\": pathwayId,\r\n      \"id\": id,\r\n      \"name\": name,\r\n      \"date\": new Date()\r\n    });\r\n    log.setObj(obj);\r\n  },\r\n\r\n  recordPlan: function(id, text, pathwayId) {\r\n    if (!id) alert(\"PLAN\");\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n\r\n    if (!obj.actions[id]) obj.actions[id] = {};\r\n    var planId = Date.now() + \"\";\r\n    obj.actions[id][planId] = {\r\n      \"text\": text,\r\n      \"agree\": null,\r\n      \"done\": false,\r\n      \"pathwayId\": pathwayId,\r\n      \"history\": [\"You added this on \" + (new Date()).toDateString()]\r\n    };\r\n\r\n    log.setObj(obj);\r\n    return planId;\r\n  },\r\n\r\n  findPlan: function(obj, planId) {\r\n    for (var k in obj.actions) {\r\n      if (obj.actions[k][planId] && obj.actions[k][planId].text) return k;\r\n    }\r\n    return -1;\r\n  },\r\n\r\n  editPlan: function(planId, text, done) {\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n    var id = log.findPlan(obj, planId);\r\n    if (text) obj.actions[id][planId].text = text;\r\n    if (done === true || done === false) obj.actions[id][planId].done = done;\r\n    log.setObj(obj);\r\n  },\r\n\r\n  deletePlan: function(planId) {\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n    var id = log.findPlan(obj, planId);\r\n    delete obj.actions[id][planId];\r\n    log.setObj(obj);\r\n  },\r\n\r\n  listPlans: function(id, pathwayId) {\r\n    var obj = log.getObj([{\r\n        name: \"actions\",\r\n        value: {}\r\n      }]),\r\n      arr = [];\r\n    if (!id) return obj.actions;\r\n    for (var prop in obj.actions[id]) {\r\n      obj.actions[id][prop].id = prop;\r\n      if ((!pathwayId || pathwayId === obj.actions[id][prop].pathwayId) && obj.actions[id][prop].text) arr.push(obj.actions[id][prop]);\r\n    }\r\n    return arr;\r\n  },\r\n\r\n  getReason: function(id, actionId) {\r\n    var obj = log.getObj([{\r\n      name: \"actions\",\r\n      value: {}\r\n    }]);\r\n\r\n    if (obj.actions[id] && obj.actions[id][actionId]) return obj.actions[id][actionId].reason;\r\n    return null;\r\n  },\r\n\r\n  getAgreeReason: function(pathwayId, pathwayStage, standard, patientId, item) {\r\n    var obj = log.getObj([{\r\n      name: \"agrees\",\r\n      value: {}\r\n    }]);\r\n    if (!pathwayId || !pathwayStage) alert(\"EDITPATIENTAGREE\");\r\n\r\n    if (!obj.agrees[patientId]) obj.agrees[patientId] = [];\r\n    var items = obj.agrees[patientId].filter(function(val) {\r\n      return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard && val.item === item;\r\n    });\r\n\r\n    return items.length === 1 ? items[0].reason || {} : {};\r\n  },\r\n\r\n  editPatientAgree: function(pathwayId, pathwayStage, standard, patientId, item, agree, reason) {\r\n    var obj = log.getObj();\r\n    if (!pathwayId || !pathwayStage) alert(\"EDITPATIENTAGREE\");\r\n\r\n    if (!obj.agrees[patientId]) obj.agrees[patientId] = [];\r\n    var items = obj.agrees[patientId].filter(function(val) {\r\n      return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard && val.item === item;\r\n    });\r\n\r\n    var logText = \"You \" + (agree ? \"\" : \"dis\") + \"agreed with this on \" + (new Date()).toDateString();\r\n\r\n    if (items.length === 1) {\r\n      items[0].agree = agree;\r\n      items[0].history.push(logText);\r\n      items[0].reason = reason;\r\n    } else if (items.length === 0) {\r\n      obj.agrees[patientId].push({\r\n        \"pathwayId\": pathwayId,\r\n        \"pathwayStage\": pathwayStage,\r\n        \"standard\": standard,\r\n        \"item\": item,\r\n        \"agree\": agree,\r\n        \"reason\": reason,\r\n        \"history\": [logText]\r\n      });\r\n    } else {\r\n      console.log(\"ERRORRR!!!!!!!\");\r\n    }\r\n\r\n    log.setObj(obj);\r\n    notify.showSaved();\r\n  },\r\n\r\n  getAgrees: function() {\r\n    return log.getObj([{\r\n      name: \"agrees\",\r\n      value: {}\r\n    }]).agrees;\r\n  },\r\n\r\n  getPatientAgreeObject: function(pathwayId, pathwayStage, standard, patientId, item) {\r\n    var obj = log.getObj([{\r\n      name: \"agrees\",\r\n      value: {}\r\n    }]);\r\n    if (!pathwayId || !pathwayStage) alert(\"EDITPATIENTAGREE\");\r\n\r\n    if (!obj.agrees[patientId]) obj.agrees[patientId] = [];\r\n    var items = obj.agrees[patientId].filter(function(val) {\r\n      return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard && val.item === item;\r\n    });\r\n    if (items.length === 1) return items[0];\r\n    return {};\r\n  },\r\n\r\n  getPatientAgree: function(pathwayId, pathwayStage, standard, patientId, item) {\r\n    var obj = log.getObj([{\r\n      name: \"agrees\",\r\n      value: {}\r\n    }]);\r\n\r\n    if (!obj.agrees[patientId]) return null;\r\n    var item2 = obj.agrees[patientId].filter(function(val) {\r\n      return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage && val.standard === standard && val.item === item;\r\n    });\r\n\r\n    if (item.length === 1) {\r\n      return item[0].agree;\r\n    }\r\n    return null;\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = log;\r\n","module.exports = {\r\n  \"currentUrl\": \"\",\r\n  \"options\": [],\r\n  \"categories\": {\r\n    \"diagnosis\": {\r\n      \"name\": \"diagnosis\",\r\n      \"display\": \"Diagnosis\"\r\n    },\r\n    \"monitoring\": {\r\n      \"name\": \"monitoring\",\r\n      \"display\": \"Monitoring\"\r\n    },\r\n    \"treatment\": {\r\n      \"name\": \"treatment\",\r\n      \"display\": \"Control\"\r\n    },\r\n    \"exclusions\": {\r\n      \"name\": \"exclusions\",\r\n      \"display\": \"Exclusions\"\r\n    }\r\n  },\r\n  \"charts\": {},\r\n  \"pathwayId\": \"htn\",\r\n  \"colors\": ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'],\r\n  \"monitored\": {\r\n    \"bp\": \"Blood Pressure\",\r\n    \"asthma\": \"Peak Expiratory Flow\"\r\n  }\r\n};\r\n","var template = require('./template'),\r\n  data = require('./data'),\r\n  base = require('./base'),\r\n  layout = require('./layout'),\r\n  welcome = require('./panels/welcome'),\r\n  log = require('./log'),\r\n  patientView = require('./views/patient');\r\n\r\nvar states, patLookup, page, hash;\r\n\r\nconsole.log(\"main.js: data.lastloader= \" + data.lastloader);\r\ndata.lastloader = \"main.js\";\r\n\r\nvar main = {\r\n  \"version\": \"2.0.0\",\r\n\r\n  hash: hash,\r\n  init: function() {\r\n    main.preWireUpPages();\r\n\r\n    log.loadActions(function() {\r\n      data.get(main.wireUpPages);\r\n    });\r\n  },\r\n\r\n  onSelected: function($e, nhsNumberObject) {\r\n    //Hide the suggestions panel\r\n    $('#search-box').find('.tt-dropdown-menu').css('display', 'none');\r\n\r\n    history.pushState(null, null, '#patients/' + nhsNumberObject.id);\r\n    template.loadContent('#patients/' + nhsNumberObject.id, true);\r\n\r\n\r\n    //template.displaySelectedPatient(nhsNumberObject.id);\r\n  },\r\n\r\n  wireUpSearchBox: function() {\r\n    if (states) {\r\n      states.clearPrefetchCache();\r\n    }\r\n\r\n    states = new Bloodhound({\r\n      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\r\n      queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n      local: $.map(data.patientArray, function(state) {\r\n        return {\r\n          id: state,\r\n          value: data.patLookup && data.patLookup[state] ? data.patLookup[state].toString().replace(/ /g,\"\") : state\r\n        };\r\n      })\r\n    });\r\n\r\n    states.initialize(true);\r\n\r\n    $('#search-box').find('.typeahead').typeahead('destroy');\r\n    $('#search-box').find('.typeahead').typeahead({\r\n        hint: true,\r\n        highlight: true,\r\n        minLength: 1,\r\n        autoselect: true\r\n      }, {\r\n        name: 'patients',\r\n        displayKey: 'value',\r\n        source: states.ttAdapter(),\r\n        templates: {\r\n          empty: [\r\n              '<div class=\"empty-message\">',\r\n                '&nbsp; &nbsp; No matches',\r\n              '</div>'\r\n            ].join('\\n')\r\n        }\r\n      }).on('typeahead:selected', main.onSelected)\r\n      .on('typeahead:autocompleted', main.onSelected);\r\n\r\n    $('#searchbtn').on('mousedown', function() {\r\n      var val = $('.typeahead').eq(0).val();\r\n      if (!val || val === \"\") val = $('.typeahead').eq(1).val();\r\n      main.onSelected(null, {\r\n        \"id\": val\r\n      });\r\n    });\r\n  },\r\n\r\n  wireUpPages: function() {\r\n    base.wireUpTooltips();\r\n    main.wireUpSearchBox();\r\n\r\n    $('#data-file').on('change', function(evt) {\r\n      $('#data-file-wrapper').addClass('disabled').text(\"Loading...\");\r\n      var file = evt.target.files[0]; // FileList object\r\n      var reader = new FileReader();\r\n\r\n      reader.onload = (function() {\r\n        return function(e) {\r\n          var JsonObj = JSON.parse(e.target.result);\r\n          data.get(null, JsonObj);\r\n          console.log(JsonObj);\r\n\r\n          main.wireUpSearchBox();\r\n\r\n          setTimeout(function() {\r\n            if (!$('#patient-file-wrapper').is(':visible')) {\r\n              $('#file-loader').hide(500);\r\n            } else {\r\n              $('#data-file-wrapper').hide(500);\r\n            }\r\n            template.loadContent('#overview');\r\n          }, 1000);\r\n        };\r\n      })(file);\r\n\r\n      reader.readAsText(file);\r\n    });\r\n\r\n    $('#patient-file').on('change', function(evt) {\r\n      $('#patient-file-wrapper').addClass('disabled').text(\"Loading...\");\r\n      var file = evt.target.files[0]; // FileList object\r\n      var reader = new FileReader();\r\n\r\n      reader.onload = (function() {\r\n        return function(e) {\r\n          var lines = e.target.result.split(\"\\n\");\r\n          data.patLookup = {};\r\n          for (var i = 0; i < lines.length; i++) {\r\n            var fields = lines[i].split(\"\\t\");\r\n            if (fields.length !== 2) continue;\r\n            data.patLookup[fields[0].trim()] = fields[1].trim();\r\n          }\r\n\r\n          main.wireUpSearchBox();\r\n\r\n          setTimeout(function() {\r\n            if (!$('#data-file-wrapper').is(':visible')) {\r\n              $('#file-loader').hide(500);\r\n            } else {\r\n              $('#patient-file-wrapper').hide(500);\r\n            }\r\n            template.loadContent('#overview');\r\n          }, 1000);\r\n        };\r\n      })(file);\r\n\r\n      reader.readAsText(file);\r\n    });\r\n\r\n    $('#outstandingTasks').on('click', function(e) {\r\n      e.preventDefault();\r\n\r\n      $('#welcome-tabs li').removeClass('active');\r\n      $(this).closest('li').addClass('active');\r\n      /*var tempMust = $('#welcome-task-list').html();\r\n      var rendered = Mustache.render(tempMust);*/\r\n      //var tmpl = require(\"templates/action-plan-task-list\");\r\n      $('#welcome-tab-content').fadeOut(100, function() {\r\n        //$(this).html(tmpl());\r\n        welcome.populate();\r\n        $(this).fadeIn(100);\r\n      });\r\n    });\r\n\r\n    $('#completedTasks').on('click', function(e) {\r\n      e.preventDefault();\r\n\r\n      $('#welcome-tabs li').removeClass('active');\r\n      $(this).closest('li').addClass('active');\r\n      /*var tempMust = $('#welcome-task-list').html();\r\n      var rendered = Mustache.render(tempMust);*/\r\n      //var tmpl = require(\"templates/action-plan-task-list\");\r\n      $('#welcome-tab-content').fadeOut(100, function() {\r\n        //$(this).html(tmpl());\r\n        welcome.populate(true);\r\n        $(this).fadeIn(100);\r\n      });\r\n    });\r\n\r\n    if (main.hash !== location.hash) location.hash = main.hash;\r\n    template.loadContent(location.hash, true);\r\n  },\r\n\r\n  preWireUpPages: function() {\r\n      layout.showPage('login');\r\n\r\n      //Every link element stores href in history\r\n      $(document).on('click', 'a.history', function() {\r\n        // keep the link in the browser history\r\n        history.pushState(null, null, this.href);\r\n        template.loadContent(location.hash, true);\r\n        // do not give a default action\r\n        return false;\r\n      });\r\n\r\n      //Called when the back button is hit\r\n      $(window).on('popstate', function(e) {\r\n        template.loadContent(location.hash, true);\r\n      });\r\n\r\n      //Templates\r\n      patientsPanelTemplate = $('#patients-panel');\r\n      actionPlanPanel = $('#action-plan-panel');\r\n      patientList = $('#patient-list');\r\n      suggestedPlanTemplate = $('#suggested-plan-template');\r\n      individualPanel = $('#individual-panel');\r\n      valueTrendPanel = $('#value-trend-panel');\r\n      medicationPanel = $('#medications-panel');\r\n      actionPlanList = $('#action-plan-list');\r\n\r\n      //Selectors\r\n      bottomLeftPanel = $('#bottom-left-panel');\r\n      bottomRightPanel = $('#bottom-right-panel');\r\n      topPanel = $('#top-panel');\r\n      topLeftPanel = $('#top-left-panel');\r\n      topRightPanel = $('#top-right-panel');\r\n      midPanel = $('#mid-panel');\r\n      farLeftPanel = $('#left-panel');\r\n      farRightPanel = $('#right-panel');\r\n    }\r\n    /*,\r\n      \"_local\": local*/\r\n};\r\n\r\nmodule.exports = main;\r\n","module.exports = {\r\n\r\n  showSaved: function() {\r\n    $(\"#saved-message\").hide().toggleClass(\"in\").fadeIn(300);\r\n    window.setTimeout(function() {\r\n      $(\"#saved-message\").fadeOut(300, function() {\r\n        $(this).toggleClass(\"in\");\r\n      });\r\n    }, 2000);\r\n  }\r\n\r\n};\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  qualityStandard = require('./qualityStandard.js'),\r\n  otherCodes = require('./otherCodes.js'),\r\n  medication = require('./medication.js'),\r\n  trend = require('./trend.js'),\r\n  individualActionPlan = require('./individualActionPlan.js'),\r\n  layout = require('../layout.js'),\r\n  chart = require('../chart.js'),\r\n  Mustache = require('mustache');\r\n\r\nvar all = {\r\n\r\n  populate: function() {\r\n    var patients = data.getAllPatients();\r\n\r\n    var localData = {\r\n      \"patients\": patients,\r\n      \"n\": patients.length,\r\n      \"header-items\": [{\r\n        \"title\": \"NHS no.\",\r\n        \"isUnSortable\": true\r\n      }, {\r\n        \"title\": \"All Opportunities\",\r\n        \"titleHTML\": '# of <i class=\"fa fa-flag\" style=\"color:red\"></i>',\r\n        \"isUnSortable\": true,\r\n        \"tooltip\": \"Total number of improvement opportunities available across all conditions\"\r\n      }]\r\n    };\r\n\r\n    localData.patients.sort(function(a, b) {\r\n      if (a.items[0] === b.items[0]) {\r\n        return 0;\r\n      }\r\n      var A = Number(a.items[0]);\r\n      var B = Number(b.items[0]);\r\n      if (isNaN(A) || isNaN(B)) {\r\n        A = a.items[0];\r\n        B = b.items[0];\r\n      }\r\n      if (A > B) {\r\n        return -1;\r\n      } else if (A < B) {\r\n        return 1;\r\n      }\r\n    });\r\n\r\n    base.createPanelShow(patientList, patientsPanel, localData, {\r\n      \"header-item\": $(\"#patient-list-header-item\").html(),\r\n      \"item\": $('#patient-list-item').html()\r\n    });\r\n\r\n    $('#patients-placeholder').hide();\r\n\r\n    base.setupClipboard($('.btn-copy'), true);\r\n\r\n    base.wireUpTooltips();\r\n\r\n    var c = patientsPanel.find('div.table-scroll').getNiceScroll();\r\n    if (c && c.length > 0) {\r\n      c.resize();\r\n    } else {\r\n      patientsPanel.find('div.table-scroll').niceScroll({\r\n        cursoropacitymin: 0.3,\r\n        cursorwidth: \"7px\",\r\n        horizrailenabled: false\r\n      });\r\n    }\r\n  },\r\n\r\n  //Show patient view from the all patient screen\r\n  showIndividualPatientView: function(pathwayId, pathwayStage, standard, patientId) {\r\n    data.patientId = patientId;\r\n\r\n    data.options.sort(function(a, b) {\r\n      a = data.getPatientStatus(patientId, a.pathwayId, a.pathwayStage, a.standard);\r\n      b = data.getPatientStatus(patientId, b.pathwayId, b.pathwayStage, b.standard);\r\n\r\n      if (a === b) return 0;\r\n      if (a === \"not\") return 1;\r\n      if (b === \"not\") return -1;\r\n      if (a === \"ok\") return 1;\r\n      if (b === \"ok\") return -1;\r\n      alert(\"!!!!!!!\");\r\n    });\r\n\r\n    if (pathwayId === null) {\r\n      //Show patient but don't select\r\n      var p = base.createPanel($('#patient-panel'), {\r\n        \"options\": data.options,\r\n        \"numberOfStandardsMissed\": data.numberOfStandardsMissed(patientId),\r\n        \"nhsNumber\": data.patLookup ? data.patLookup[patientId] : patientId,\r\n        \"patientId\": patientId\r\n      }, {\r\n        \"option\": $('#patient-panel-drop-down-options').html()\r\n      });\r\n      farRightPanel.html(p).show();\r\n      farRightPanel.removeClass('standard-missed-page').removeClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n\r\n      $('select').select2({\r\n        templateResult: base.formatStandard,\r\n        minimumResultsForSearch: Infinity,\r\n        placeholder: \"Please select an improvement opportunity area...\"\r\n      });\r\n      $('span.select2-selection__rendered').attr(\"title\", \"\");\r\n      $('select').on('change', function() {\r\n        var localData = $(this).find(':selected').data();\r\n        all.showIndividualPatientView(localData.pathwayId, localData.pathwayStage, localData.standard, data.patientId);\r\n      }).on(\"select2:open\", function(e) {\r\n        base.wireUpTooltips();\r\n      });\r\n      return;\r\n    }\r\n\r\n    var panel = base.createPanel($('#patient-panel'), {\r\n      \"options\": data.options,\r\n      \"numberOfStandardsMissed\": data.numberOfStandardsMissed(patientId),\r\n      \"standard\": data[pathwayId][pathwayStage].standards[standard].tab.title,\r\n      \"pathwayStage\": pathwayStage,\r\n      \"nhsNumber\": data.patLookup ? data.patLookup[patientId] : patientId,\r\n      \"patientId\": patientId\r\n    }, {\r\n      \"option\": $('#patient-panel-drop-down-options').html()\r\n    });\r\n\r\n    farRightPanel.html(\"\");\r\n    $('#temp-hidden').html(panel);\r\n\r\n    var actionPlan = individualActionPlan.create(pathwayStage);\r\n    $('#temp-hidden #patient-panel-right').html(actionPlan);\r\n\r\n    var qualPanel = qualityStandard.create(pathwayId, pathwayStage, standard, patientId);\r\n    var trendPanel = trend.create(pathwayId, pathwayStage, standard, patientId);\r\n    var medPanel = medication.create(pathwayId, pathwayStage, standard, patientId);\r\n    var codesPanel = otherCodes.create(pathwayId, pathwayStage, standard, patientId);\r\n    var medCodeWrapperPanel = base.createPanel($('#other-codes-and-meds-wrapper-panel'));\r\n    $('#temp-hidden #patient-panel-top').html(qualPanel);\r\n    $('#temp-hidden #patient-panel-left').html(\"\").append(trendPanel).append(medCodeWrapperPanel);\r\n    $('#temp-hidden #medCodeWrapperPanel').append(medPanel).append(codesPanel);\r\n\r\n    if (farRightPanel.is(':visible')) {\r\n      farRightPanel.fadeOut(100, function() {\r\n        $(this).html($('#temp-hidden').html());\r\n        $('#temp-hidden').html(\"\");\r\n        individualActionPlan.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        qualityStandard.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        base.wireUpStandardDropDown(pathwayId, pathwayStage, standard, all.showIndividualPatientView);\r\n        trend.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        medication.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        otherCodes.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        chart.drawTrendChart(patientId, pathwayId, pathwayStage, standard);\r\n        $(this).fadeIn(100, function() {});\r\n      });\r\n    } else {\r\n      farRightPanel.html($('#temp-hidden').html());\r\n      $('#temp-hidden').html(\"\");\r\n      individualActionPlan.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      qualityStandard.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      base.wireUpStandardDropDown(pathwayId, pathwayStage, standard, all.showIndividualPatientView);\r\n      trend.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      medication.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      otherCodes.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      chart.drawTrendChart(patientId, pathwayId, pathwayStage, standard);\r\n      farRightPanel.fadeIn(100, function() {});\r\n    }\r\n  },\r\n\r\n  show: function(location) {\r\n    base.createPanelShow($('#all-patients-panel'), location, {\r\n      \"n\": data.getAllPatients().length\r\n    });\r\n\r\n    patientsPanel = $('#patients');\r\n\r\n    patientsPanel.on('click', 'tbody tr', function(e) { //Select individual patient when row clicked\r\n      $('[data-toggle=\"tooltip\"]').tooltip('hide');\r\n      $(this).tooltip('destroy');\r\n      base.clearBox();\r\n      $('.list-item').removeClass('highlighted');\r\n      $(this).addClass('highlighted').removeAttr('title');\r\n\r\n      var patientId = $(this).find('td button').attr('data-patient-id');\r\n\r\n      all.showIndividualPatientView(null, null, null, patientId);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }).on('click', 'tbody tr button', function(e) {\r\n      //don't want row selected if just button pressed?\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n  },\r\n\r\n  showView: function(patientId, reload) {\r\n    $('#mainTitle').hide();\r\n    base.updateTitle(\"List of all patients at your practice\");\r\n\r\n    if (!patientId) data.pathwayId = \"\";\r\n    if (!patientId || reload) {\r\n\r\n      layout.showMainView(data.diseases.length);\r\n\r\n      base.switchTo110Layout();\r\n      base.hideAllPanels();\r\n\r\n      all.show(farLeftPanel);\r\n      all.populate();\r\n    }\r\n\r\n    if (patientId) {\r\n      all.showIndividualPatientView(null, null, null, patientId);\r\n    } else {\r\n      var tempMust = $('#patient-panel-placeholder').html();\r\n      farRightPanel.html(Mustache.render(tempMust)).show();\r\n    }\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = all;\r\n","var base = require('../base.js'),\r\nlog = require('../log.js');\r\n\r\nvar confirm = {\r\n\r\n  wireUp: function(agreeDivSelector, panelSelector, pathwayId, pathwayStage, standard, patientId, item, disagreeText) {\r\n    confirm.wireUpAgreeDisagree(agreeDivSelector, log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, item));\r\n\r\n    panelSelector.on('change', '.btn-toggle input[type=checkbox]', function() {\r\n      confirm.wireUpAgreeDisagree(agreeDivSelector, log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, item));\r\n      base.wireUpTooltips();\r\n    }).on('click', '.btn-toggle', function(e) {\r\n      var checkbox = $(this).find(\"input[type=checkbox]\");\r\n      var other = $(this).parent().find($(this).hasClass(\"btn-yes\") ? \".btn-no\" : \".btn-yes\");\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      if ($(this).hasClass(\"active\") && other.hasClass(\"inactive\")) {\r\n        //unselecting\r\n        if (checkbox.val() === \"no\") {\r\n          confirm.launchStandardModal(\"Disagree with \" + disagreeText, \"?\", log.getAgreeReason(pathwayId, pathwayStage, standard, patientId, item), true, function() {\r\n            log.editPatientAgree(pathwayId, pathwayStage, standard, patientId, item, false, log.reason.reasonText);\r\n            confirm.wireUpAgreeDisagree(agreeDivSelector, log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, item));\r\n            base.wireUpTooltips();\r\n          }, null, function() {\r\n            log.editPatientAgree(pathwayId, pathwayStage, standard, patientId, item, null, \"\");\r\n            other.removeClass(\"inactive\");\r\n            checkbox.removeAttr(\"checked\");\r\n            checkbox.parent().removeClass(\"active\");\r\n            confirm.wireUpAgreeDisagree(agreeDivSelector, log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, item));\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editPatientAgree(pathwayId, pathwayStage, standard, patientId, item, null);\r\n          other.removeClass(\"inactive\");\r\n        }\r\n      } else if (!$(this).hasClass(\"active\") && other.hasClass(\"active\")) {\r\n        //prevent clicking on unselected option or if the row is complete\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        return;\r\n      } else {\r\n        //selecting\r\n        var self = this;\r\n        if (checkbox.val() === \"no\") {\r\n          confirm.launchStandardModal(\"Disagree with \" + disagreeText, \"\", \"\", false, function() {\r\n            log.editPatientAgree(pathwayId, pathwayStage, standard, patientId, item, false, log.reason.reasonText);\r\n            $(self).removeClass(\"inactive\");\r\n            checkbox.attr(\"checked\", \"checked\");\r\n            checkbox.parent().addClass(\"active\");\r\n            //unselect other\r\n            other.removeClass(\"active\").addClass(\"inactive\");\r\n            other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n            confirm.wireUpAgreeDisagree(agreeDivSelector, log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, item));\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editPatientAgree(pathwayId, pathwayStage, standard, patientId, item, true);\r\n          $(this).removeClass(\"inactive\");\r\n\r\n          //unselect other\r\n          other.removeClass(\"active\").addClass(\"inactive\");\r\n          other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  wireUpAgreeDisagree: function(selector, agreeObject) {\r\n    if (agreeObject.agree === true) {\r\n      selector.children(':nth(0)').addClass('active');\r\n      selector.children(':nth(1)').addClass('inactive');\r\n      selector.children(':nth(0)').attr(\"title\", confirm.getAgreeTooltip(agreeObject)).attr(\"data-original-title\", confirm.getAgreeTooltip(agreeObject)).tooltip('fixTitle').tooltip('hide');\r\n      selector.children(':nth(1)').attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      selector.parent().addClass('success').removeClass('danger');\r\n    } else if (agreeObject.agree === false) {\r\n      selector.children(':nth(0)').addClass('inactive');\r\n      selector.children(':nth(1)').addClass('active');\r\n      selector.children(':nth(0)').attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      selector.children(':nth(1)').attr(\"title\", confirm.getDisgreeTooltip(agreeObject)).attr(\"data-original-title\", confirm.getDisgreeTooltip(agreeObject)).tooltip('fixTitle').tooltip('hide');\r\n      selector.parent().addClass('danger').removeClass('success');\r\n    } else {\r\n      selector.children(':nth(0)').attr(\"title\", \"Click to agree\").attr(\"data-original-title\", \"Click to agree\").tooltip('fixTitle').tooltip('hide');\r\n      selector.children(':nth(1)').attr(\"title\", \"Click to disagree\").attr(\"data-original-title\", \"Click to disagree\").tooltip('fixTitle').tooltip('hide');\r\n      selector.parent().removeClass('success').removeClass('danger');\r\n    }\r\n  },\r\n\r\n  getAgreeTooltip: function(agreeObject) {\r\n    return agreeObject.history[agreeObject.history.length - 1];\r\n  },\r\n\r\n  getDisgreeTooltip: function(agreeObject) {\r\n    return agreeObject.history[agreeObject.history.length - 1] + \" You said: \" + agreeObject.reason;\r\n  },\r\n\r\n  launchStandardModal: function(header, value, reason, isUndo, callbackOnSave, callbackOnCancel, callbackOnUndo) {\r\n    base.launchModal({\r\n      \"header\": header,\r\n      \"isUndo\": isUndo,\r\n      \"item\": value,\r\n      \"placeholder\": \"Provide more information here...\"\r\n    }, null, value, reason, callbackOnSave, callbackOnCancel, callbackOnUndo);\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = confirm;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  chart = require('../chart.js'),\r\n  patientList = require('./patientList.js');\r\n\r\nvar ID = \"INDICATOR_BENCHMARK\";\r\n\r\nvar iTrend = {\r\n\r\n  show: function(panel, isAppend, pathwayId, pathwayStage, standard) {\r\n\r\n    var elem = $(\"<div id='benchmark-chart' class='fit-to-scrolling-section-height'></div>\");\r\n\r\n    if (isAppend) panel.append(elem);\r\n    else panel.html(elem);\r\n\r\n    chart.drawBenchmarkChartHC(\"benchmark-chart\", null);\r\n\r\n  },\r\n\r\n  wireUp: function() {\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = iTrend;\r\n","var data = require('../data.js'),\r\n  chart = require('../chart.js');\r\n\r\nvar bd = {\r\n\r\n  wireUp: function() {\r\n\r\n  },\r\n\r\n  show: function(panel, isAppend, pathwayId, pathwayStage, standard, selectSeriesFn) {\r\n\r\n    var indicators = data.getIndicatorDataSync([pathwayId, pathwayStage, standard].join(\".\"));\r\n\r\n    var dataObj = indicators.opportunities.map(function(opp) {\r\n      return [opp.name, opp.description, opp.patients.length];\r\n    });\r\n\r\n    var elem = $(\"<div id='breakdown-chart'></div>\");\r\n\r\n    if (isAppend) panel.append(elem);\r\n    else panel.html(elem);\r\n\r\n    chart.drawAnalytics(\"breakdown-chart\", dataObj, selectSeriesFn);\r\n\r\n    bd.wireUp();\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = bd;\r\n","var data = require('../data.js'),\r\n  chart = require('../chart.js');/*,\r\n  Mustache = require('mustache');\r\n*/\r\nvar hl = {\r\n\r\n  wireUp: function() {\r\n\r\n  },\r\n\r\n  show: function(panel, isAppend, pathwayId, pathwayStage, standard) {\r\n\r\n    var indicators = data.getIndicatorDataSync([pathwayId, pathwayStage, standard].join(\".\"));\r\n\r\n    var tmpl = require('templates/indicator-headline');\r\n    var html = tmpl(indicators);\r\n\r\n    if(isAppend) panel.append(html);\r\n    else panel.html(html);\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = hl;\r\n","var base = require('../base.js'),\r\n  log = require('../log.js'),\r\n  data = require('../data.js'),\r\n  sparkline = require('jquery-sparkline'),\r\n  Mustache = require('mustache');\r\n\r\nvar indicatorList = {\r\n\r\n  show: function(panel, isAppend, loadContentFn) {\r\n    data.getAllIndicatorData(function(indicators) {\r\n      indicators.sort(function(a,b){\r\n        return a.performance.percentage - b.performance.percentage;\r\n      });\r\n      var tempMust = $('#overview-panel-table').html();\r\n      var tmpl = require('templates/overview-table');\r\n      var html = tmpl({\r\n        \"indicators\": indicators\r\n      });\r\n      if (isAppend) {\r\n        panel.append(html);\r\n      } else {\r\n        panel.html(html);\r\n      }\r\n\r\n      $('.inlinesparkline').sparkline('html', {\r\n        tooltipFormatter: function(sparkline, options, fields) {\r\n          var dts = indicators[$('.inlinesparkline').index(sparkline.el)].dates;\r\n          return dts[fields.x] + \": \" + fields.y + \"%\";\r\n        },\r\n        width: \"100px\"\r\n      });\r\n\r\n      indicatorList.wireUp(panel, loadContentFn);\r\n\r\n    });\r\n  },\r\n\r\n  populate: function() {\r\n\r\n  },\r\n\r\n  wireUp: function(panel, loadContentFn) {\r\n    panel.off('click', 'tr.show-more-row a');\r\n    panel.on('click', 'tr.show-more-row a', function(e){\r\n      e.stopPropagation();\r\n    });\r\n    panel.off('click', 'tr.standard-row,tr.show-more-row');\r\n    panel.on('click', 'tr.standard-row,tr.show-more-row', function(e) {\r\n      var url = $(this).data(\"id\").replace(/\\./g, \"/\");\r\n      history.pushState(null, null, '#indicators/' + url);\r\n      loadContentFn('#indicators/' + url);\r\n      // do not give a default action\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    });\r\n\r\n    panel.off('mouseenter', '.show-more-row,.standard-row');\r\n    panel.off('mouseleave', '.show-more-row,.standard-row');\r\n    panel.on('mouseenter', '.show-more-row,.standard-row', function(e){\r\n      var id = $(this).data(\"id\");\r\n      $('.show-more-row[data-id=\"' + id + '\"],.standard-row[data-id=\"' + id + '\"]').addClass('hover');\r\n    });\r\n    panel.on('mouseleave', '.show-more-row,.standard-row', function(e){\r\n      var id = $(this).data(\"id\");\r\n      $('.show-more-row[data-id=\"' + id + '\"],.standard-row[data-id=\"' + id + '\"]').removeClass('hover');\r\n    });\r\n\r\n    panel.off('click', '.show-more');\r\n    panel.on('click', '.show-more', function(e) {\r\n      var id = $(this).data(\"id\");\r\n      var elem = $('.show-more-row[data-id=\"' + id + '\"]');\r\n      if(elem.is(':visible')){\r\n        $('.show-more[data-id=\"' + id + '\"]:first').show();\r\n        elem.hide();\r\n      } else {\r\n        $(this).hide();\r\n        elem.show('fast');\r\n      }\r\n      // do not give a default action\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    });\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = indicatorList;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  chart = require('../chart.js'),\r\n  patientList = require('./patientList.js');\r\n\r\nvar ID = \"INDICATOR_TREND\";\r\n\r\nvar iTrend = {\r\n\r\n  show: function(panel, isAppend, pathwayId, pathwayStage, standard) {\r\n\r\n    var indicators = data.getAllIndicatorDataSync();\r\n\r\n    var elem = $(\"<div id='trend-chart' class='fit-to-scrolling-section-height'></div>\");\r\n\r\n    if (isAppend) panel.append(elem);\r\n    else panel.html(elem);\r\n\r\n    chart.drawPerformanceTrendChartHC(\"trend-chart\", indicators.filter(function(v){\r\n      return v.id===[pathwayId, pathwayStage, standard].join(\".\");\r\n    })[0]);\r\n\r\n  },\r\n\r\n  wireUp: function() {\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = iTrend;\r\n","var base = require('../base.js'),\r\n  confirm = require('./confirm.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js');\r\n\r\nvar iap = {\r\n\r\n  create: function(pathwayStage) {\r\n    return require(\"templates/individual-action-plan\")();\r\n    /*return base.createPanel($('#individual-action-plan-panel'), {\r\n      \"pathwayStage\": pathwayStage || \"default\",\r\n      \"noHeader\": true\r\n    });*/\r\n  },\r\n\r\n  show: function(panel, pathwayId, pathwayStage, standard, patientId) {\r\n    panel.html(iap.create(pathwayStage));\r\n    iap.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n\r\n    panel.find('div.fit-to-screen-height').niceScroll({\r\n      cursoropacitymin: 0.3,\r\n      cursorwidth: \"7px\",\r\n      horizrailenabled: false\r\n    });\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, standard, patientId) {\r\n    individualTab = $('#tab-plan-individual');\r\n\r\n    //find [] and replace with copy button\r\n\r\n    $('#advice-list').on('click', '.cr-styled input[type=checkbox]', function() {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(data.patientId, ACTIONID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        log.recordEvent(pathwayId, data.patientId, \"Item completed\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            base.wireUpTooltips();\r\n            parent.find('button').on('click', function() {\r\n              ACTIONID = $(this).closest('tr').data('id');\r\n              log.editAction(data.patientId, ACTIONID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              iap.updateIndividualSapRows();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n\r\n      iap.updateIndividualSapRows();\r\n    });\r\n\r\n    $('#personalPlanIndividual').on('click', 'input[type=checkbox]', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n      log.editPlan(PLANID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        $(this).parent().parent().parent().addClass('success');\r\n        log.recordEvent(pathwayId, data.patientId, \"Personal plan item\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            base.wireUpTooltips();\r\n            parent.find('button').on('click', function() {\r\n              PLANID = $(this).closest('tr').data('id');\r\n              log.editPlan(data.patientId, PLANID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              iap.updateIndividualSapRows();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var PLANID = $(this).closest('tr').data('id');\r\n      log.editPlan(PLANID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      iap.updateIndividualSapRows();\r\n      e.stopPropagation();\r\n    });\r\n\r\n    individualTab.on('click', '.edit-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#editActionPlanItem').val($($(this).closest('tr').children('td')[0]).find('span').text());\r\n\r\n      $('#editPlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        iap.displayPersonalisedIndividualActionPlan(data.patientId, $('#personalPlanIndividual'));\r\n      }).off('shown.bs.modal').on('shown.bs.modal', function() {\r\n        $('#editActionPlanItem').focus();\r\n      }).off('click', '.save-plan').on('click', '.save-plan', function() {\r\n\r\n        log.editPlan(PLANID, $('#editActionPlanItem').val());\r\n\r\n        $('#editPlan').modal('hide');\r\n      }).off('keyup', '#editActionPlanItem').on('keyup', '#editActionPlanItem', function(e) {\r\n        if (e.which === 13) $('#editPlan .save-plan').click();\r\n      }).modal();\r\n    }).on('click', '.delete-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#modal-delete-item').html($($(this).closest('tr').children('td')[0]).find('span').text());\r\n\r\n      $('#deletePlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        iap.displayPersonalisedIndividualActionPlan(data.patientId, $('#personalPlanIndividual'));\r\n      }).off('click', '.delete-plan').on('click', '.delete-plan', function() {\r\n        log.deletePlan(PLANID);\r\n\r\n        $('#deletePlan').modal('hide');\r\n      }).modal();\r\n    }).on('click', '.add-plan', function() {\r\n      log.recordPlan(data.patientId, $(this).parent().parent().find('textarea').val(), pathwayId);\r\n\r\n      iap.displayPersonalisedIndividualActionPlan(data.patientId, $('#personalPlanIndividual'));\r\n    }).on('change', '.btn-toggle input[type=checkbox]', function() {\r\n      iap.updateIndividualSapRows();\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(data.patientId, ACTIONID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      iap.updateIndividualSapRows();\r\n    }).on('click', '.btn-yes,.btn-no', function(e) {\r\n      var checkbox = $(this).find(\"input[type=checkbox]\");\r\n      var other = $(this).parent().find($(this).hasClass(\"btn-yes\") ? \".btn-no\" : \".btn-yes\");\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      if ($(this).hasClass(\"active\") && other.hasClass(\"inactive\") && !$(this).closest('tr').hasClass('success')) {\r\n        //unselecting\r\n        if (checkbox.val() === \"no\") {\r\n          iap.launchModal(data.selected, checkbox.closest('tr').children().first().children().first().text(), log.getReason(data.patientId, ACTIONID), true, function() {\r\n            log.editAction(data.patientId, ACTIONID, false, null, log.reason);\r\n            iap.updateIndividualSapRows();\r\n            base.wireUpTooltips();\r\n          }, null, function() {\r\n            log.ignoreAction(data.patientId, ACTIONID);\r\n            other.removeClass(\"inactive\");\r\n            checkbox.removeAttr(\"checked\");\r\n            checkbox.parent().removeClass(\"active\");\r\n            iap.updateIndividualSapRows();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.ignoreAction(data.patientId, ACTIONID);\r\n          other.removeClass(\"inactive\");\r\n        }\r\n      } else if ((!$(this).hasClass(\"active\") && other.hasClass(\"active\")) || $(this).closest('tr').hasClass('success')) {\r\n        //prevent clicking on unselected option or if the row is complete\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        return;\r\n      } else {\r\n        //selecting\r\n        var self = this;\r\n        if (checkbox.val() === \"no\") {\r\n          iap.launchModal(data.selected, checkbox.closest('tr').children().first().children().first().text(), log.getReason(data.patientId, ACTIONID), false, function() {\r\n            log.editAction(data.patientId, ACTIONID, false, null, log.reason);\r\n            $(self).removeClass(\"inactive\");\r\n\r\n            checkbox.attr(\"checked\", \"checked\");\r\n            checkbox.parent().addClass(\"active\");\r\n            //unselect other\r\n            other.removeClass(\"active\").addClass(\"inactive\");\r\n            other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n            iap.updateIndividualSapRows();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editAction(data.patientId, ACTIONID, true);\r\n          $(this).removeClass(\"inactive\");\r\n\r\n          //unselect other\r\n          other.removeClass(\"active\").addClass(\"inactive\");\r\n          other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n        }\r\n      }\r\n    }).on('keyup', 'input[type=text]', function(e) {\r\n      if (e.which === 13) {\r\n        individualTab.find('.add-plan').click();\r\n      }\r\n    });\r\n\r\n    $('#advice-list').off('click', '.show-more');\r\n    $('#advice-list').on('click', '.show-more', function(e) {\r\n      var id = $(this).data(\"id\");\r\n      var elem = $('.show-more-row[data-id=\"' + id + '\"]');\r\n      if(elem.is(':visible')){\r\n        $('.show-more[data-id=\"' + id + '\"]:first').show();\r\n        elem.hide();\r\n      } else {\r\n        $(this).hide();\r\n        elem.show('fast');\r\n      }\r\n      // do not give a default action\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    });\r\n\r\n    iap.populateIndividualSuggestedActions(patientId, pathwayId, pathwayStage, standard);\r\n  },\r\n\r\n  updateIndividualSapRows: function() {\r\n    /*$('#advice-list').add('#personalPlanIndividual').find('.suggestion').each(function() {\r\n      $(this).find('td').last().children().hide();\r\n    });*/\r\n\r\n    /*$('#advice-list').add('#personalPlanIndividual').find('.cr-styled input[type=checkbox]').each(function() {\r\n      if (this.checked) {\r\n        $(this).parent().parent().parent().addClass('success');\r\n      } else {\r\n        $(this).parent().parent().parent().removeClass('success');\r\n      }\r\n    });*/\r\n\r\n    /*$('#advice-list').add('#personalPlanIndividual').find('.btn-undo').each(function() {\r\n      $(this).parent().parent().addClass('success');\r\n    });*/\r\n\r\n    //no class - user not yet agreed/disagreed - no background / muted text\r\n    //active - user agrees - green background / normal text\r\n    //success - user completed - green background / strikethrough text\r\n    //danger - user disagrees - red background / strikethrough text\r\n\r\n    $('#advice-list').add('#personalPlanIndividual').find('tr.suggestion').each(function() {\r\n      var self = $(this);\r\n      var id = self.data(\"id\");\r\n      var all = $('.show-more-row[data-id=\"' + id + '\"],.suggestion[data-id=\"' + id + '\"]');\r\n      var any = false;\r\n      self.find('.btn-toggle input[type=checkbox]:checked').each(function() {\r\n        any = true;\r\n        if (this.value === \"yes\") {\r\n          all.removeClass('danger');\r\n          all.addClass('active');\r\n          //self.find('td').last().children().show();\r\n          if (log.getActions()[data.patientId][self.data(\"id\")].history) {\r\n            var tool = $(this).closest('tr').hasClass('success') ? \"\" : \"<p>\" + log.getActions()[data.patientId][self.data(\"id\")].history[0] + \"</p><p>Click again to cancel</p>\";\r\n            $(this).parent().attr(\"title\", tool).attr(\"data-original-title\", tool).tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You agreed - click again to cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        } else {\r\n          all.removeClass('active');\r\n          all.addClass('danger');\r\n          all.removeClass('success');\r\n          if (log.getActions()[data.patientId][self.data(\"id\")] && log.getActions()[data.patientId][self.data(\"id\")].history) {\r\n            $(this).parent().attr(\"title\", \"<p>\" + log.getActions()[data.patientId][self.data(\"id\")].history[0] + \"</p><p>Click again to edit/cancel</p>\").tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You disagreed - click again to edit/cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        }\r\n      });\r\n      if (self.find('.btn-toggle input[type=checkbox]:not(:checked)').length == 1) {\r\n        self.find('.btn-toggle input[type=checkbox]:not(:checked)').parent().addClass(\"inactive\").attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n      if (!any) {\r\n        all.removeClass('danger');\r\n        all.removeClass('active');\r\n        all.removeClass('success');\r\n\r\n        self.find('.btn-toggle.btn-yes').attr(\"title\", \"Click to agree with this action and save it in your agreed actions list  \").tooltip('fixTitle').tooltip('hide');\r\n        self.find('.btn-toggle.btn-no').attr(\"title\", \"Click to disagree with this action and remove it from your suggested actions list \").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n\r\n      base.wireUpTooltips();\r\n    });\r\n    base.wireUpTooltips();\r\n  },\r\n\r\n  displayPersonalisedIndividualActionPlan: function(id, parentElem) {\r\n    var plans = base.sortSuggestions(base.addDisagreePersonalTeam(log.listPlans(id)));\r\n\r\n    /*base.createPanelShow(actionPlanList, parentElem, {\r\n      \"hasSuggestions\": plans && plans.length > 0,\r\n      \"suggestions\": plans\r\n    }, {\r\n      \"action-plan\": $('#action-plan').html(),\r\n      \"action-plan-item\": $('#action-plan-item').html(),\r\n      \"chk\": $('#checkbox-template').html()\r\n    });*/\r\n\r\n    var tmpl = require('templates/action-plan-list');\r\n    parentElem.html(tmpl({\r\n      \"hasSuggestions\": plans && plans.length > 0,\r\n      \"suggestions\": plans\r\n    }));\r\n\r\n    iap.updateIndividualSapRows();\r\n  },\r\n\r\n  populateIndividualSuggestedActions: function(patientId, pathwayId, pathwayStage, standard) {\r\n    var localData = {\r\n      \"nhsNumber\": data.patLookup ? data.patLookup[patientId] : patientId,\r\n      \"patientId\": patientId\r\n    };\r\n\r\n    var patientData = data.getPatientData(patientId);\r\n\r\n    var breaches = data.patients[patientId].breach ? data.patients[patientId].breach.filter(function(v) {\r\n      return v.pathwayId === pathwayId && v.pathwayStage === pathwayStage && v.standard === standard;\r\n    }) : [];\r\n\r\n    var fn = function(val) {\r\n      return {\r\n        \"id\": val,\r\n        \"subsection\": subsection\r\n      };\r\n    };\r\n\r\n    if (patientData.actions.length === 0) {\r\n      localData.noSuggestions = true;\r\n    } else {\r\n      /*var suggestions = [],\r\n        subsection = \"\";\r\n      for (var i = 0; i < breaches.length; i++) {\r\n        subsection = breaches[i].subsection;\r\n        suggestions = suggestions.concat(data[pathwayId][pathwayStage].bdown[subsection].suggestions ?\r\n          data[pathwayId][pathwayStage].bdown[subsection].suggestions.map(fn) : []);\r\n      }*/\r\n\r\n      localData.suggestions = base.sortSuggestions(base.mergeIndividualStuff(patientData.actions, patientId));\r\n      /*localData.section = {\r\n        \"name\": data[pathwayId][pathwayStage].bdown[subsection].name,\r\n        \"agree\": log.getPatientAgree(pathwayId, pathwayStage, patientId, \"section\") === true,\r\n        \"disagree\": log.getPatientAgree(pathwayId, pathwayStage, patientId, \"section\") === false,\r\n      };\r\n      localData.category = {\r\n        \"name\": data.patients[patientId].category,\r\n        \"agree\": log.getPatientAgree(pathwayId, pathwayStage, patientId, \"category\") === true,\r\n        \"disagree\": log.getPatientAgree(pathwayId, pathwayStage, patientId, \"category\") === false,\r\n      };*/\r\n    }\r\n\r\n    $('#advice-placeholder').hide();\r\n    $('#advice').show();\r\n\r\n    //base.createPanelShow(individualPanel, $('#advice-list'), localData);\r\n    var tmpl = require(\"templates/individual\");\r\n    $('#advice-list').html(tmpl(localData));\r\n\r\n    //Wire up any clipboard stuff in the suggestions\r\n    $('#advice-list').find('span:contains(\"[COPY\")').each(function() {\r\n      var html = $(this).html();\r\n      $(this).html(html.replace(/\\[COPY:([^\\]]*)\\]/g, '$1 <button type=\"button\" data-clipboard-text=\"$1\" data-content=\"Copied\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Copy $1 to clipboard.\" class=\"btn btn-xs btn-default btn-copy\"><span class=\"fa fa-clipboard\"></span></button>'));\r\n    });\r\n    $('#advice-list').find('span:contains(\"[\")').each(function() {\r\n      var html = $(this).html();\r\n      $(this).html(html.replace(/\\[([^\\]]*)\\]/g, ' <button type=\"button\" data-clipboard-text=\"$1\" data-content=\"Copied\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Copy $1 to clipboard.\" class=\"btn btn-xs btn-default btn-copy\"><span class=\"fa fa-clipboard\"></span></button>'));\r\n    });\r\n\r\n    $('#advice-list').find('span:contains(\"[INFO\")').each(function() {\r\n      var html = $(this).html();\r\n      var subsection = $(this).data().subsection;\r\n      var desc = data[pathwayId][pathwayStage].standards[standard].opportunities.filter(function(val) {\r\n          return val.name === subsection;\r\n        }).length > 0 ?\r\n        data[pathwayId][pathwayStage].standards[standard].opportunities.filter(function(val) {\r\n          return val.name === subsection;\r\n        })[0].desc : subsection;\r\n      var tooltip = subsection ? \"This action is suggested because PINGR classified this patient as:'\" + desc + \"'\" : '';\r\n      var newHtml = ' <i class=\"fa fa-info-circle fa-lg info-button clickable\" data-toggle=\"tooltip\" data-placement=\"right\" title=\"' + tooltip + '\"></i>';\r\n      $(this).html(html.replace(/\\[INFO\\]/g, newHtml));\r\n    });\r\n\r\n    $('#advice-list').find('span:contains(\"[MED-SUGGESTION\")').each(function() {\r\n      var html = $(this).html();\r\n      var suggestion = Math.random() < 0.33 ? \"Increase Ramipril to 10mg per day\" : (Math.random() < 0.5 ? \"Consider adding an ACE inhibior\" : \"Consider adding a thiazide-like diuretic\");\r\n      $(this).html(html.replace(/\\[MED\\-SUGGESTION\\]/g, suggestion));\r\n    });\r\n\r\n\r\n    base.setupClipboard($('.btn-copy'), true);\r\n\r\n    iap.displayPersonalisedIndividualActionPlan(patientId, $('#personalPlanIndividual'));\r\n  },\r\n\r\n  launchModal: function(label, value, reason, isUndo, callbackOnSave, callbackOnCancel, callbackOnUndo) {\r\n    var reasons = [{\r\n      \"reason\": \"Already done this\",\r\n      \"value\": \"done\"\r\n    }, {\r\n      \"reason\": \"Wouldn't work\",\r\n      \"value\": \"nowork\"\r\n    }, {\r\n      \"reason\": \"Something else\",\r\n      \"value\": \"else\"\r\n    }];\r\n    if (reason && reason.reason) {\r\n      for (var i = 0; i < reasons.length; i++) {\r\n        if (reasons[i].reason === reason.reason) {\r\n          reasons[i].checked = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    base.launchModal({\r\n      \"header\": \"Disagree with a suggested action\",\r\n      \"isUndo\": isUndo,\r\n      \"item\": value,\r\n      \"placeholder\": \"Provide more information here...\",\r\n      \"reasons\": reasons\r\n    }, label, value, reason ? reason.reasonText : null, callbackOnSave, callbackOnCancel, callbackOnUndo);\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = iap;\r\n","var Highcharts = require('highcharts/highstock'),\r\n  base = require('../base.js');\r\nrequire('highcharts/highcharts-more')(Highcharts);\r\n\r\nvar ID = \"LIFELINE\";\r\n\r\nvar colour = {\r\n  index: 0,\r\n  next: function() {\r\n    if (this.index >= Highcharts.getOptions().colors.length) this.index = 0;\r\n    return Highcharts.getOptions().colors[this.index++];\r\n  },\r\n  reset: function() {\r\n    this.index = 0;\r\n  }\r\n};\r\n\r\nvar ll = {\r\n  chartArray: [],\r\n\r\n  destroy: function(elementId) {\r\n    $(elementId).html('');\r\n    $(elementId).off('mousemove touchmove touchstart', '.sync-chart');\r\n\r\n    for (var i = 0; i < Highcharts.charts.length; i++) {\r\n      if (Highcharts.charts[i] && Highcharts.charts[i].renderTo.className.indexOf(\"h-chart\") > -1) Highcharts.charts[i].destroy();\r\n    }\r\n  },\r\n\r\n  show: function(panel, isAppend, patientId, data) {\r\n\r\n    var element = 'lifeline-chart';\r\n    var elementId = '#' + element;\r\n\r\n    //Most recent max date of series minus one month or 1 year whichever is most\r\n    var minMaxDate=new Date();\r\n    minMaxDate.setMonth(minMaxDate.getMonth()-11);\r\n\r\n    ll.destroy(elementId);\r\n\r\n    var htmlElement = $('<div class=\"panel panel-default\"><div class=\"panel-body\"><div id=\"' + element + '\"></div></div></div>');\r\n\r\n    if (isAppend) panel.append(htmlElement);\r\n    else panel.html(htmlElement);\r\n\r\n    colour.reset();\r\n    /**\r\n     * In order to synchronize tooltips and crosshairs, override the\r\n     * built-in events with handlers defined on the parent element.\r\n     */\r\n\r\n    $(elementId).on('mousemove touchmove touchstart', '.sync-chart', function(e) {\r\n      var chart, point, i, event, series;\r\n\r\n      for (i = 1; i < ll.chartArray.length - 2; i = i + 1) {\r\n        chart = ll.chartArray[i];\r\n        event = chart.pointer.normalize(e.originalEvent); // Find coordinates within the chart\r\n        //if (i === 0) console.log(event.chartX + \" --- \" + event.chartY);\r\n        series = i === 0 ? Math.max(Math.min(Math.floor((130 - event.chartY) / 34), chart.series.length - 1), 0) : 0;\r\n        point = chart.series[series].searchPoint(event, true); // Get the hovered point\r\n\r\n        if (point) {\r\n          point.onMouseOver(); // Show the hover marker\r\n          chart.tooltip.refresh(point); // Show the tooltip\r\n          chart.xAxis[0].drawCrosshair(event, point); // Show the crosshair\r\n        }\r\n      }\r\n    });\r\n\r\n    /**\r\n     * Synchronize zooming through the setExtremes event handler.\r\n     */\r\n    function syncExtremes(e) {\r\n      var thisChart = this.chart;\r\n\r\n      if (e.trigger !== 'syncExtremes') { // Prevent feedback loop\r\n        Highcharts.each(ll.chartArray, function(chart) {\r\n          if (chart !== thisChart) {\r\n            if (chart.inverted) {\r\n              if (chart.yAxis[0].setExtremes) { // It is null while updating\r\n                chart.yAxis[0].setExtremes(e.min, e.max, undefined, false, {\r\n                  trigger: 'syncExtremes'\r\n                });\r\n              }\r\n            } else {\r\n              if (chart.xAxis[0].setExtremes) { // It is null while updating\r\n                chart.xAxis[0].setExtremes(e.min, e.max, undefined, false, {\r\n                  trigger: 'syncExtremes'\r\n                });\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n    var plotConditions = function(conditions, importantCodes, contacts) {\r\n      ll.charts = 1;\r\n      var series = [];\r\n      $.each(conditions.reverse(), function(i, task) {\r\n        var item = {\r\n          name: task.name,\r\n          data: [],\r\n          color: colour.next()\r\n        };\r\n\r\n        var latestIntervalEndDate;\r\n\r\n        $.each(task.intervals, function(j, interval) {\r\n          if(!latestIntervalEndDate) latestIntervalEndDate = interval.to;\r\n          else latestIntervalEndDate = Math.max(latestIntervalEndDate, interval.to);\r\n          item.data.push([i + 0.49, interval.from, interval.to]);\r\n        });\r\n\r\n        if(latestIntervalEndDate) minMaxDate = Math.min(latestIntervalEndDate, minMaxDate);\r\n\r\n        series.push(item);\r\n      });\r\n\r\n      var markerTemplate = { \"lineWidth\": 1, \"lineColor\": \"black\", \"radius\": 8 };\r\n      var markers = {\r\n        \"default\": $.extend({ \"symbol\": \"triangle\" }, markerTemplate),\r\n        \"Face to face\": $.extend({ \"symbol\": \"square\" }, markerTemplate),\r\n        \"Telephone\": $.extend({ \"symbol\": \"circle\" }, markerTemplate),\r\n        \"Hospital admission\": $.extend({ \"symbol\": \"triangle\" }, markerTemplate)\r\n      };\r\n      var contactSeries = {};\r\n      var eventSeries = {};\r\n      var latestContact;\r\n      $.each(contacts, function(i, contact) {\r\n        if(!latestContact) latestContact = contact.time;\r\n        else latestContact = Math.max(latestContact, contact.time);\r\n        if (!contactSeries[contact.name]) {\r\n          contactSeries[contact.name] = Highcharts.extend(contact, {\r\n            data: [],\r\n            type: 'scatter',\r\n            marker: markers[contact.name] || markers.default,\r\n            color: colour.next()\r\n          });\r\n        }\r\n        contactSeries[contact.name].data.push([\r\n              contact.task,\r\n              contact.time\r\n          ]);\r\n      });\r\n      if(latestContact) minMaxDate = Math.min(latestContact, minMaxDate);\r\n\r\n      var latestImportantCode;\r\n      $.each(importantCodes, function(i, event) {\r\n        if(!latestImportantCode) latestImportantCode = event.time;\r\n        else latestImportantCode = Math.max(latestImportantCode, event.time);\r\n        if (!eventSeries[event.name]) {\r\n          eventSeries[event.name] = Highcharts.extend(event, {\r\n            data: [],\r\n            type: 'scatter',\r\n            marker: markers[event.name] || markers.default,\r\n            color: colour.next()\r\n          });\r\n        }\r\n        eventSeries[event.name].data.push([\r\n              event.task,\r\n              event.time\r\n          ]);\r\n      });\r\n\r\n      if(latestImportantCode) minMaxDate = Math.min(latestImportantCode, minMaxDate);\r\n\r\n      series = series.concat(Object.keys(contactSeries).map(function(key) {\r\n        return contactSeries[key];\r\n      }));\r\n\r\n      series = series.concat(Object.keys(eventSeries).map(function(key) {\r\n        return eventSeries[key];\r\n      }));\r\n\r\n      $(elementId).append($('<div class=\"chart-title\">Patient conditions and contacts</div>'));\r\n      // create the chart\r\n      $('<div class=\"h-chart h-condition-chart\">')\r\n        .appendTo(elementId)\r\n        .highcharts({\r\n\r\n          chart: {\r\n            renderTo: element,\r\n            marginLeft: 120, // Keep all charts left aligned\r\n            spacingTop: 20,\r\n            spacingBottom: 20,\r\n            type: 'columnrange',\r\n            inverted: true,\r\n            backgroundColor: '#F9F3F9',\r\n            borderWidth: 2,\r\n            borderColor: '#ddd'\r\n          },\r\n\r\n          title: '',\r\n\r\n          yAxis: {\r\n            type: 'datetime',\r\n            min: Date.UTC(2005, 6, 12),\r\n            max: new Date().getTime(),\r\n            crosshair: true,\r\n            events: {\r\n              setExtremes: syncExtremes\r\n            },\r\n            labels: {\r\n              enabled: false\r\n            },\r\n\r\n            //things that are normally xAxis defaults\r\n            endOnTick: false,\r\n            gridLineWidth: 0,\r\n            lineWidth: 1,\r\n            maxPadding: 0.01,\r\n            minPadding: 0.01,\r\n            startOnTick: false,\r\n            tickWidth: 0,\r\n            title: {\r\n              text: ''\r\n            },\r\n            tickPixelInterval: 100\r\n          },\r\n\r\n          xAxis: {\r\n            labels: {\r\n              enabled: false\r\n            },\r\n            startOnTick: false,\r\n            endOnTick: false,\r\n            title: {\r\n              text: ''\r\n            },\r\n            tickWidth: 0,\r\n            minPadding: 0.2,\r\n            maxPadding: 0.2,\r\n\r\n            //things that are normally yAxis defaults\r\n            gridLineWidth: 0,\r\n            lineWidth: 0\r\n\r\n          },\r\n          credits: {\r\n            enabled: false\r\n          },\r\n\r\n          legend: {\r\n            enabled: false\r\n          },\r\n\r\n          tooltip: {\r\n            formatter: function() {\r\n              if (this.series.data[0].x !== 1 && this.series.data[0].x !== 2) {\r\n                //Range ergo condition\r\n                var yCoord = this.y;\r\n                var labelTmp = conditions[Math.floor(this.x)].intervals.filter(function(v) {\r\n                  return yCoord >= v.from && yCoord <= v.to;\r\n                });\r\n                var label = labelTmp.length > 0 ? labelTmp[0].label : \"No label A\";\r\n                return '<b>' + conditions[Math.floor(this.x)].name + (label ? ': ' + label : '') + '</b><br/>' +\r\n                  Highcharts.dateFormat('%d/%m/%Y', this.point.options.low) +\r\n                  ' - ' + Highcharts.dateFormat('%d/%m/%Y', this.point.options.high);\r\n              } else {\r\n                //Single value hence contact\r\n                var time = this.y;\r\n                return (this.series.data[0].x === 1 ? importantCodes : contacts).filter(function(val) {\r\n                  return val.data && val.data.filter(function(v) {\r\n                    return v[1] === time;\r\n                  }).length > 0;\r\n                }).map(function(val) {\r\n                  return '<b>' + val.name + '</b><br/>' + Highcharts.dateFormat('%d/%m/%Y', time);\r\n                }).join('<br/>');\r\n              }\r\n            },\r\n            followPointer: true\r\n          },\r\n\r\n          plotOptions: {\r\n            columnrange: {\r\n              grouping: false,\r\n              /*groupPadding: 0.3,*/\r\n              dataLabels: {\r\n                allowOverlap: true,\r\n                enabled: true,\r\n                formatter: function() {\r\n                  var yCoord = this.y;\r\n                  var idx = -1;\r\n                  var labelTmp = conditions[Math.floor(this.x)].intervals.filter(function(v, i) {\r\n                    if (yCoord >= v.from && yCoord <= v.to) {\r\n                      idx = i;\r\n                      return true;\r\n                    }\r\n                    return false;\r\n                  });\r\n                  var label = labelTmp.length > 0 ? labelTmp[0].label : \"No label B\";\r\n                  return this.y === this.point.low &&\r\n                    (conditions[Math.floor(this.x)].intervals.length - 1 === idx ||\r\n                      (this.series.chart.yAxis[0].min <= yCoord && this.series.chart.yAxis[0].max >= yCoord) ||\r\n                      (this.series.chart.yAxis[0].min >= this.point.low && this.series.chart.yAxis[0].max <= this.point.high)) ? conditions[Math.floor(this.x)].name + (label ? ': ' + label : '') : '';\r\n                }\r\n              }\r\n            }\r\n          },\r\n\r\n          series: series\r\n\r\n        });\r\n    };\r\n\r\n    var plotMeasurements = function(measurements) {\r\n      $(elementId).append($('<div class=\"chart-title\">Patient measurements</div>'));\r\n      //Make measurements alphabetical so they are always in the same order\r\n      measurements.sort(function(a,b){\r\n        if(a.name<b.name) return -1;\r\n        if(a.name>b.name) return 1;\r\n        return 0;\r\n      });\r\n      $.each(measurements, function(i, dataset) {\r\n        ll.charts++;\r\n        var maxMeasurementDate=0;\r\n        dataset.data.forEach(function(v){\r\n          maxMeasurementDate = Math.max(maxMeasurementDate, v[0]);\r\n        });\r\n        minMaxDate = Math.min(minMaxDate, maxMeasurementDate);\r\n        var chartOptions = {\r\n          chart: {\r\n            marginLeft: 120, // Keep all charts left aligned\r\n            spacingTop: 0,\r\n            spacingBottom: 8,\r\n            backgroundColor: '#F9F9F3',\r\n            borderWidth: 2,\r\n            borderColor: '#ddd'\r\n          },\r\n          title: {\r\n            text: '',\r\n            align: 'left',\r\n            margin: 0,\r\n            x: 30\r\n          },\r\n          marker: {\r\n            enabled: true\r\n          },\r\n          credits: {\r\n            enabled: false\r\n          },\r\n          legend: {\r\n            enabled: false\r\n          },\r\n          xAxis: {\r\n            type: 'datetime',\r\n            min: Date.UTC(2005, 6, 12),\r\n            max: new Date().getTime(),\r\n            crosshair: {\r\n              snap: false\r\n            },\r\n            events: {\r\n              setExtremes: syncExtremes\r\n            },\r\n            labels: {\r\n              enabled: false\r\n            },\r\n            lineWidth: 0,\r\n            minorGridLineWidth: 0,\r\n            lineColor: 'transparent',\r\n            minorTickLength: 0,\r\n            tickLength: 0\r\n          },\r\n          yAxis: {\r\n            title: {\r\n              text: dataset.name + \"<br>\" + dataset.unit.replace(/\\^([0-9]+)/, \"<sup>$1</sup>\") + \"\",\r\n              margin: 60,\r\n              rotation: 0\r\n            },\r\n            startOnTick: false,\r\n            endOnTick: false,\r\n            labels: {\r\n              style: {\r\n                \"textOverflow\": \"none\"\r\n              }\r\n            },\r\n            tickPixelInterval: 25,\r\n            maxPadding: 0.1,\r\n            minPadding: 0.1\r\n          },\r\n          tooltip: {\r\n            positioner: function(labelWidth, labelHeight, point) {\r\n              return {\r\n                x: Math.max(50, point.plotX - labelWidth), // left aligned\r\n                y: -1 // align to title\r\n              };\r\n            },\r\n            useHTML: true,\r\n            pointFormat: '<b>' + dataset.name + ':</b> {point.y} ' + dataset.unit.replace(/\\^([0-9]+)/, \"<sup>$1</sup>\"),\r\n            valueDecimals: dataset.valueDecimals\r\n          },\r\n          plotOptions: {\r\n            series: {\r\n              events: {\r\n                mouseOut: function() {\r\n                  var chart, i;\r\n                  for (i = 1; i < ll.chartArray.length - 2; i = i + 1) {\r\n                    chart = ll.chartArray[i];\r\n                    chart.tooltip.hide();\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          },\r\n          series: [{\r\n            data: dataset.data,\r\n            name: dataset.name,\r\n            type: dataset.type,\r\n            color: colour.next(),\r\n            fillOpacity: 0.3\r\n            }]\r\n        };\r\n\r\n        if (dataset.name === \"BP\") {\r\n          chartOptions.tooltip.pointFormat = \"<b>BP:</b> {point.low}/{point.high} mmHg<br/>\";\r\n          //chartOptions.series[0].tooltip = {};\r\n          chartOptions.series[0].stemWidth = 3;\r\n          chartOptions.series[0].whiskerWidth = 5;\r\n        }\r\n\r\n        /*if (i === 0) {\r\n          chartOptions.title = {\r\n            text: 'Patient measurements',\r\n            align: 'left',\r\n            margin: 1,\r\n            style: {\r\n              color: \"#333333\",\r\n              fontSize: \"12px\",\r\n              fontWeight: \"bold\"\r\n            }\r\n          };\r\n        }*/\r\n\r\n        /*if (i === measurements.datasets.length - 1) {\r\n          chartOptions.xAxis = {\r\n            crosshair: true,\r\n            events: {\r\n              setExtremes: syncExtremes\r\n            },\r\n            type: 'datetime'\r\n          };\r\n        }*/\r\n        $('<div class=\"sync-chart h-chart' + (i === measurements.length - 1 ? \" h-last-measurement-chart\" : \"\") + '\">')\r\n          .appendTo(elementId)\r\n          .highcharts(chartOptions);\r\n\r\n      });\r\n    };\r\n\r\n    var plotNavigator = function() {\r\n      ll.charts++;\r\n      var chart = $('<div class=\"h-chart h-navigator-chart\">')\r\n        .appendTo(elementId)\r\n        .highcharts({\r\n\r\n          chart: {\r\n            renderTo: element,\r\n            marginLeft: 120, // Keep all charts left aligned\r\n            spacingTop: 20,\r\n            spacingBottom: 20,\r\n            ignoreHiddenSeries: false,\r\n            borderWidth: 2,\r\n            borderColor: '#ddd'\r\n          },\r\n\r\n          title: {\r\n            text: ''\r\n          },\r\n\r\n          xAxis: {\r\n            type: 'datetime',\r\n            min: Date.UTC(2005, 6, 12),\r\n            max: new Date().getTime(),\r\n            crosshair: false,\r\n            events: {\r\n              setExtremes: syncExtremes\r\n            },\r\n            labels: {\r\n              enabled: false\r\n            },\r\n            lineWidth: 0,\r\n            minorGridLineWidth: 0,\r\n            lineColor: 'transparent',\r\n            minorTickLength: 0,\r\n            tickLength: 0\r\n          },\r\n\r\n          yAxis: {\r\n            min: 0,\r\n            max: 1,\r\n            tickInterval: 1,\r\n            startOnTick: false,\r\n            endOnTick: false,\r\n            title: {\r\n              text: ''\r\n            },\r\n            minPadding: 0.2,\r\n            maxPadding: 0.2,\r\n            labels: {\r\n              enabled: false\r\n            }\r\n          },\r\n\r\n          legend: {\r\n            enabled: false\r\n          },\r\n\r\n          navigator: {\r\n            enabled: true\r\n          },\r\n\r\n          plotOptions: {\r\n            line: {\r\n              lineWidth: 0,\r\n              marker: {\r\n                enabled: false\r\n              },\r\n              dataLabels: {\r\n                enabled: false\r\n              }\r\n            }\r\n          },\r\n\r\n          series: [{\r\n            \"name\": \"HTN\",\r\n            \"data\": [{\r\n              \"x\": 1373587200000,\r\n              \"y\": 0,\r\n              \"from\": 1373587200000,\r\n              \"to\": 1459814400000\r\n              }]\r\n            }]\r\n\r\n        });\r\n      chart.highcharts().series[0].hide();\r\n    };\r\n\r\n    var plotMedications = function(medications) {\r\n      ll.charts++;\r\n      var series = [];\r\n      $.each(medications.reverse(), function(i, task) {\r\n        var item = {\r\n          name: task.name,\r\n          data: [],\r\n          color: colour.next()\r\n        };\r\n        $.each(task.intervals, function(j, interval) {\r\n          item.data.push([i + 0.49, interval.from, interval.to]);\r\n        });\r\n\r\n        series.push(item);\r\n      });\r\n      var noData = false;\r\n      if (series.length === 0) {\r\n        series.push({\r\n          type: 'line',\r\n          name: 'Random data',\r\n          data: []\r\n        });\r\n        noData = true;\r\n      }\r\n\r\n      //$(elementId).append($('<div class=\"chart-title\"' + (noData ? 'style=\"display:none\"' : '') + '>Patient medications</div>'));\r\n      $(elementId).append($('<div class=\"chart-title\">Patient medications</div>'));\r\n      // create the chart\r\n      //return $('<div class=\"h-chart h-medication-chart\"' + (noData ? 'style=\"display:none\"' : '') + '>')\r\n      return $('<div class=\"h-chart h-medication-chart\">')\r\n        .appendTo(elementId)\r\n        .highcharts({\r\n\r\n          chart: {\r\n            renderTo: element,\r\n            marginLeft: 120, // Keep all charts left aligned\r\n            spacingTop: 20,\r\n            spacingBottom: 20,\r\n            type: 'columnrange',\r\n            inverted: true,\r\n            backgroundColor: '#F3F9F9'\r\n          },\r\n          lang: {\r\n            noData: \"No relevant medications\"\r\n          },\r\n          noData: {\r\n            style: {\r\n              fontWeight: 'bold',\r\n              fontSize: '15px',\r\n              color: '#303030'\r\n            }\r\n          },\r\n\r\n          title: '',\r\n          /*{\r\n                      text: 'Patient medications',\r\n                      align: 'left',\r\n                      margin: 1,\r\n                      style: {\r\n                        color: \"#333333\",\r\n                        fontSize: \"12px\",\r\n                        fontWeight: \"bold\"\r\n                      }\r\n                    },*/\r\n\r\n\r\n          yAxis: {\r\n            type: 'datetime',\r\n            min: Date.UTC(2005, 6, 12),\r\n            max: new Date().getTime(),\r\n            crosshair: {\r\n              snap: false\r\n            },\r\n            events: {\r\n              setExtremes: syncExtremes\r\n            },\r\n\r\n\r\n\r\n            //things that are normally xAxis defaults\r\n            endOnTick: false,\r\n            gridLineWidth: 0,\r\n            lineWidth: 1,\r\n            maxPadding: 0.01,\r\n            minPadding: 0.01,\r\n            startOnTick: false,\r\n            tickWidth: 1,\r\n            title: {\r\n              text: ''\r\n            },\r\n            tickPixelInterval: 100\r\n          },\r\n\r\n          xAxis: {\r\n            labels: {\r\n              enabled: false\r\n            },\r\n            startOnTick: false,\r\n            endOnTick: false,\r\n            title: {\r\n              text: ''\r\n            },\r\n            tickWidth: 0,\r\n            minPadding: 0.2,\r\n            maxPadding: 0.2,\r\n\r\n            //things that are normally yAxis defaults\r\n            gridLineWidth: 0,\r\n            lineWidth: 0\r\n          },\r\n          credits: {\r\n            enabled: false\r\n          },\r\n\r\n          legend: {\r\n            enabled: false\r\n          },\r\n\r\n          tooltip: {\r\n            formatter: function() {\r\n              var yCoord = this.y;\r\n              var labelTmp = medications[Math.floor(this.x)].intervals.filter(function(v) {\r\n                return yCoord >= v.from && yCoord <= v.to;\r\n              });\r\n              var label = labelTmp.length > 0 ? labelTmp[0].label : \"No label C\";\r\n              return '<b>' + medications[Math.floor(this.x)].name + (label ? ': ' + label : '') + '</b><br/>' +\r\n                Highcharts.dateFormat('%d/%m/%Y', this.point.options.low) +\r\n                ' - ' + Highcharts.dateFormat('%d/%m/%Y', this.point.options.high);\r\n            },\r\n            followPointer: true\r\n          },\r\n\r\n          plotOptions: {\r\n            columnrange: {\r\n              grouping: false,\r\n              dataLabels: {\r\n                allowOverlap: true,\r\n                enabled: true,\r\n                formatter: function() {\r\n                  var yCoord = this.y;\r\n                  var idx = -1;\r\n                  var labelTmp = medications[Math.floor(this.x)].intervals.filter(function(v, i) {\r\n                    if (yCoord >= v.from && yCoord <= v.to) {\r\n                      idx = i;\r\n                      return true;\r\n                    }\r\n                    return false;\r\n                  });\r\n                  var label = labelTmp.length > 0 ? labelTmp[0].label : \"No label D\";\r\n                  return this.y === this.point.low &&\r\n                    (medications[Math.floor(this.x)].intervals.length - 1 === idx ||\r\n                      (this.series.chart.yAxis[0].min <= yCoord && this.series.chart.yAxis[0].max >= yCoord) ||\r\n                      (this.series.chart.yAxis[0].min >= this.point.low && this.series.chart.yAxis[0].max <= this.point.high)) ? medications[Math.floor(this.x)].name + (label ? ': ' + label : '') : '';\r\n                }\r\n              }\r\n            }\r\n          },\r\n\r\n          series: series\r\n\r\n        });\r\n    };\r\n\r\n    minMaxDate.setMonth(minMaxDate.getMonth()-1); //gives 1 month padding\r\n\r\n    plotConditions(data.conditions, data.events, data.contacts);\r\n    plotMeasurements(data.measurements);\r\n    var c = plotMedications(data.medications);\r\n    plotNavigator();\r\n    var today = new Date().getTime();\r\n    c.highcharts().axes[1].setExtremes(minMaxDate, today, undefined, false, {\r\n      trigger: 'syncExtremes'\r\n    });\r\n\r\n    ll.chartArray = Highcharts.charts.slice(Highcharts.charts.length - ll.charts, Highcharts.charts.length);\r\n\r\n    var s = syncExtremes.bind(c.highcharts().series[0]);\r\n    s({\r\n      trigger: 'navigator',\r\n      min: minMaxDate,\r\n      max: today\r\n    });\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = ll;\r\n","var base = require('../base.js'),\r\n  confirm = require('./confirm.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js');\r\n\r\nvar med = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard, patientId) {\r\n    var medications = data.patients[patientId].medications || [];\r\n    var agree = log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, \"medication\");\r\n    return base.createPanel(medicationPanel, {\r\n      \"areMedications\": medications.length > 0,\r\n      \"agree\": agree && agree.agree,\r\n      \"disagree\": agree && agree.agree === false,\r\n      \"pathway\": data.pathwayNames[pathwayId],\r\n      \"medications\": medications,\r\n      \"pathwayStage\": pathwayStage\r\n    }, {\r\n      \"medicationRow\": $('#medication-row').html()\r\n    });\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, standard, patientId) {\r\n    confirm.wireUp($('#medication-agree-disagree'), $('#medication-panel'), pathwayId, pathwayStage, standard, patientId, \"medication\", \"medication data\");\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = med;\r\n","var base = require('../base.js'),\r\n  confirm = require('./confirm.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js');\r\n\r\nvar other = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard, patientId) {\r\n    var codes = (data.patients[patientId].codes || []).map(function(val) {\r\n      val.description = data.codes[val.code];\r\n      return val;\r\n    });\r\n    var agree = log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, \"codes\");\r\n    return base.createPanel($('#other-codes-panel'), {\r\n      \"areCodes\": codes.length > 0,\r\n      \"agree\": agree && agree.agree,\r\n      \"disagree\": agree && agree.agree === false,\r\n      \"pathway\": data.pathwayNames[pathwayId],\r\n      \"standard\": data[pathwayId][pathwayStage].standards[standard].tab.title,\r\n      \"codes\": codes,\r\n      \"pathwayStage\": pathwayStage\r\n    }, {\r\n      \"codeRow\": $('#other-codes-row').html()\r\n    });\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, standard, patientId) {\r\n    confirm.wireUp($('#other-codes-agree-disagree'), $('#other-codes-panel'), pathwayId, pathwayStage, standard, patientId, \"codes\", \"other codes\");\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = other;\r\n","var data = require('../data.js'),\r\n  Mustache = require('mustache');\r\n\r\nvar pc = {\r\n\r\n  show: function(panel, isAppend, patientId) {\r\n\r\n    var patientData = data.getPatientData(patientId);\r\n\r\n    var tempMust = $('#patient-characteristics-panel').html();\r\n    var html = Mustache.render(tempMust, patientData.characteristics);\r\n\r\n    if (isAppend) panel.append(html);\r\n    else panel.html(html);\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = pc;\r\n","var Highcharts = require('highcharts/highstock'),\r\n  base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  lookup = require('../lookup.js'),\r\n  Mustache = require('mustache');\r\n\r\nvar ID = \"PATIENT_LIST\";\r\n\r\nvar pl = {\r\n\r\n  wireUp: function(onPatientSelected) {\r\n    patientsPanel = $('#patients');\r\n\r\n    patientsPanel.on('click', 'thead tr th.sortable', function() { //Sort columns when column header clicked\r\n      var sortAsc = !$(this).hasClass('sort-asc');\r\n      if (sortAsc) {\r\n        $(this).removeClass('sort-desc').addClass('sort-asc');\r\n      } else {\r\n        $(this).removeClass('sort-asc').addClass('sort-desc');\r\n      }\r\n      pl.populate(pl.state[0], pl.state[1], pl.state[2], pl.state[3], $(this).index(), sortAsc);\r\n    }).on('click', 'tbody tr', function(e) { //Select individual patient when row clicked#\r\n      var callback = onPatientSelected.bind(this);\r\n      var patientId = $(this).find('td button').attr('data-patient-id');\r\n      callback(patientId);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }).on('click', 'tbody tr button', function(e) {\r\n      //don't want row selected if just button pressed?\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n  },\r\n\r\n  selectSubsection: function(section) {\r\n    pl.populate(pl.state[0], pl.state[1], pl.state[2], section, pl.state[4], pl.state[5]);\r\n  },\r\n\r\n  populate: function(pathwayId, pathwayStage, standard, subsection, sortField, sortAsc) {\r\n    pl.state = [pathwayId, pathwayStage, standard, subsection, sortField, sortAsc];\r\n    patientsPanel = $('#patients');\r\n    //Remove scroll if exists\r\n    patientsPanel.find('div.table-scroll').getNiceScroll().remove();\r\n\r\n    var i, k, prop, header, pList = [];\r\n\r\n    data.getIndicatorData([pathwayId, pathwayStage, standard].join(\".\"), function(indicators) {\r\n\r\n      if (pathwayId && pathwayStage && standard && subsection) {\r\n        pList = indicators.opportunities.filter(function(val) {\r\n          return val.name === subsection;\r\n        })[0].patients;\r\n        header = indicators.opportunities.filter(function(val) {\r\n          return val.name === subsection;\r\n        })[0].description;\r\n      } else if (pathwayId && pathwayStage && standard) {\r\n        pList = indicators.opportunities.reduce(function(a, b) {\r\n          return a.patients ? a.patients.concat(b.patients) : a.concat(b.patients);\r\n        });\r\n        header = data.text.pathways[pathwayId][pathwayStage].standards[standard].tableTitle;\r\n      }\r\n\r\n      pList = data.removeDuplicates(pList);\r\n      var vId = data.text.pathways[pathwayId][pathwayStage].standards[standard].valueId;\r\n      var dOv = data.text.pathways[pathwayId][pathwayStage].standards[standard].dateORvalue;\r\n      var patients = pList.map(function(patientId) {\r\n        var ret = indicators.patients[patientId];\r\n        ret.nhsNumber = data.patLookup[patientId] || patientId;\r\n        ret.patientId = patientId;\r\n        ret.items = [data.patients[patientId].characteristics.age]; //The fields in the patient list table\r\n\r\n        var measures = data.patients[patientId].measurements.filter(function(v){return v.id===vId;});\r\n\r\n        if ( measures[0] && measures[0].data) {\r\n          if (dOv === \"date\") {\r\n            ret.items.push(new Date(measures[0].data[measures[0].data.length-1][0]));\r\n          } else {\r\n            ret.items.push(measures[0].data[measures[0].data.length-1][1]);\r\n          }\r\n        } else {\r\n          ret.items.push(\"?\");\r\n        }\r\n        ret.items.push(indicators.patients[patientId].opportunities.map(function(v){return '<span style=\"width:13px;height:13px;float:left;background-color:' + Highcharts.getOptions().colors[v] + '\"></span>';}).join(\"\"));\r\n        //ret.items.push(data.numberOfStandardsMissed(patientId));\r\n        return ret;\r\n      });\r\n\r\n      var localData = {\r\n        \"patients\": patients,\r\n        \"n\": patients.length,\r\n        \"header\": header,\r\n        \"header-items\": [{\r\n          \"title\": \"NHS no.\",\r\n          \"isSorted\": false,\r\n          \"direction\": \"sort-asc\",\r\n          \"tooltip\": \"NHS number of each patient\"\r\n        },{\r\n          \"title\": \"Age\",\r\n          \"isSorted\": false,\r\n          \"direction\": \"sort-asc\",\r\n          \"tooltip\": \"The age of the patient\"\r\n        }]\r\n      };\r\n\r\n      //middle column is either value or date\r\n      if (dOv) {\r\n        localData[\"header-items\"].push({\r\n          \"title\": data.text.pathways[pathwayId][pathwayStage].standards[standard].valueName,\r\n          \"tooltip\": dOv === \"date\" ? \"Last date \" + vId + \" was measured\" : \"Last \" + vId + \" reading\",\r\n          \"isSorted\": false,\r\n          \"direction\": \"sort-asc\"\r\n        });\r\n      } else {\r\n        if (pathwayStage === lookup.categories.monitoring.name) {\r\n          localData[\"header-items\"].push({\r\n            \"title\": \"Last BP Date\",\r\n            \"isSorted\": false,\r\n            \"direction\": \"sort-asc\",\r\n            \"tooltip\": \"Last date BP was measured\"\r\n          });\r\n        } else {\r\n          localData[\"header-items\"].push({\r\n            \"title\": \"Last SBP\",\r\n            \"tooltip\": \"Last systolic BP reading\",\r\n            \"isSorted\": false,\r\n            \"direction\": \"sort-asc\"\r\n          });\r\n        }\r\n      }\r\n\r\n      //add qual standard column\r\n      localData[\"header-items\"].push({\r\n        \"title\": \"Improvement opportunities\",\r\n        \"titleHTML\": 'Improvement opportunities',\r\n        \"isSorted\": true,\r\n        \"tooltip\": \"Improvement opportunities from the bar chart above\"\r\n      });\r\n\r\n      if (sortField === undefined) sortField = 2;\r\n      if (sortField !== undefined) {\r\n        localData.patients.sort(function(a, b) {\r\n          if (sortField === 0) { //NHS number\r\n            if (a.nhsNumber === b.nhsNumber) {\r\n              return 0;\r\n            }\r\n\r\n            if (a.nhsNumber > b.nhsNumber) {\r\n              return sortAsc ? 1 : -1;\r\n            } else if (a.nhsNumber < b.nhsNumber) {\r\n              return sortAsc ? -1 : 1;\r\n            }\r\n          } else {\r\n            if (a.items[sortField - 1] === b.items[sortField - 1]) {\r\n              return 0;\r\n            }\r\n\r\n            if (a.items[sortField - 1] == \"?\") return 1;\r\n            if (b.items[sortField - 1] == \"?\") return -1;\r\n\r\n            var A = Number(a.items[sortField - 1]);\r\n            var B = Number(b.items[sortField - 1]);\r\n            if (isNaN(A) || isNaN(B)) {\r\n              A = a.items[sortField - 1];\r\n              B = b.items[sortField - 1];\r\n            }\r\n            if (A > B) {\r\n              return sortAsc ? 1 : -1;\r\n            } else if (A < B) {\r\n              return sortAsc ? -1 : 1;\r\n            }\r\n          }\r\n        });\r\n\r\n        for (i = 0; i < localData[\"header-items\"].length; i++) {\r\n          if (i === sortField) {\r\n            localData[\"header-items\"][i].direction = sortAsc ? \"sort-asc\" : \"sort-desc\";\r\n            localData[\"header-items\"][i].isAsc = sortAsc;\r\n            localData[\"header-items\"][i].isSorted = true;\r\n          } else {\r\n            localData[\"header-items\"][i].isSorted = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      base.createPanelShow(require('templates/patient-list'), patientsPanel, localData);/*, {\r\n        \"header-item\": require('src/templates/partials/_patient-list-header-item')(),\r\n        \"item\": require('src/templates/partials/_patient-list-item')()\r\n      });*/\r\n\r\n      $('#patients-placeholder').hide();\r\n\r\n      base.setupClipboard($('.btn-copy'), true);\r\n\r\n      base.wireUpTooltips();\r\n\r\n      patientsPanel.find('div.table-scroll').niceScroll({\r\n        cursoropacitymin: 0.3,\r\n        cursorwidth: \"7px\",\r\n        horizrailenabled: false\r\n      });\r\n\r\n    });\r\n\r\n  },\r\n\r\n  show: function(panel, isAppend, pathwayId, pathwayStage, standard, loadContentFn) {\r\n\r\n    //var tempMust = $('#patients-panel-yes').html();\r\n    var tmpl = require('templates/patient-list-wrapper');\r\n\r\n    if(isAppend) panel.append(tmpl());\r\n    else panel.html(tmpl());\r\n\r\n    pl.wireUp(function(patientId) {\r\n      history.pushState(null, null, '#patient/' + patientId);\r\n      loadContentFn('#patient/' + patientId);\r\n    });\r\n    pl.populate(pathwayId, pathwayStage, standard, null);\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = pl;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  lookup = require('../lookup.js');\r\nvar states, loadContFn, ID = \"PATIENT_SEARCH\";\r\n\r\nvar ps = {\r\n\r\n  wireUp: function() {\r\n    if (states) {\r\n      states.clearPrefetchCache();\r\n    }\r\n\r\n    states = new Bloodhound({\r\n      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\r\n      queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n      local: $.map(data.patientArray, function(state) {\r\n        return {\r\n          id: state,\r\n          value: data.patLookup && data.patLookup[state] ? data.patLookup[state].toString().replace(/ /g,\"\") : state\r\n        };\r\n      })\r\n    });\r\n\r\n    states.initialize(true);\r\n\r\n    $('#search-box').find('.typeahead').typeahead('destroy');\r\n    $('#search-box').find('.typeahead').typeahead({\r\n        hint: true,\r\n        highlight: true,\r\n        minLength: 1,\r\n        autoselect: true\r\n      }, {\r\n        name: 'patients',\r\n        displayKey: 'value',\r\n        source: states.ttAdapter(),\r\n        templates: {\r\n          empty: [\r\n              '<div class=\"empty-message\">',\r\n                '&nbsp; &nbsp; No matches',\r\n              '</div>'\r\n            ].join('\\n')\r\n        }\r\n      }).on('typeahead:selected', ps.onSelected)\r\n      .on('typeahead:autocompleted', ps.onSelected);\r\n\r\n    $('#searchbtn').on('mousedown', function() {\r\n      var val = $('.typeahead').eq(0).val();\r\n      if (!val || val === \"\") val = $('.typeahead').eq(1).val();\r\n      ps.onSelected(null, {\r\n        \"id\": val\r\n      });\r\n    });\r\n  },\r\n\r\n  onSelected: function($e, nhsNumberObject) {\r\n    //Hide the suggestions panel\r\n    $('#search-box').find('.tt-dropdown-menu').css('display', 'none');\r\n\r\n    history.pushState(null, null, '#patients/' + nhsNumberObject.id);\r\n    loadContFn('#patients/' + nhsNumberObject.id, true);\r\n\r\n  },\r\n\r\n  show: function(panel, isAppend, loadContentFn) {\r\n\r\n    loadContFn = loadContentFn;\r\n    var tmpl = require(\"templates/patient-search\");\r\n\r\n    if(isAppend) panel.append(tmpl());\r\n    else panel.html(tmpl());\r\n\r\n    ps.wireUp();\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = ps;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  lookup = require('../lookup.js'),\r\n  chart = require('../chart.js'),\r\n  qualityStandard = require('./qualityStandard.js'),\r\n  otherCodes = require('./otherCodes.js'),\r\n  medication = require('./medication.js'),\r\n  trend = require('./trend.js'),\r\n  individualActionPlan = require('./individualActionPlan.js'),\r\n  patientList = require('./patientList.js');\r\n\r\nvar pt = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard) {\r\n    var tabData = [];\r\n    for (var key in data[pathwayId][pathwayStage].standards) {\r\n      tabData.push({\r\n        \"header\": data[pathwayId][pathwayStage].standards[key].tab,\r\n        \"active\": key === standard,\r\n        \"url\": window.location.hash.replace(/\\/no.*/g, '\\/no/' + key)\r\n      });\r\n    }\r\n    return base.createPanel(patientsPanelTemplate, {\r\n      \"pathwayStage\": pathwayStage,\r\n      \"header\": data[pathwayId][pathwayStage].standards[standard].chartTitle,\r\n      \"tooltip\": data[pathwayId][pathwayStage].standards[standard].tooltip,\r\n      \"url\": window.location.hash.replace(/\\/yes.*/g, '').replace(/\\/no.*/g, ''),\r\n      \"tabs\": tabData,\r\n      \"text\": data[pathwayId][pathwayStage].text\r\n    }, {\r\n      \"content\": $('#patients-panel-no').html(),\r\n      \"tab-header\": $('#patients-panel-no-tabs').html(),\r\n      \"tab-content\": $('#patients-panel-no-page').html()\r\n    });\r\n  },\r\n\r\n  createOk: function(pathwayId, pathwayStage) {\r\n    return base.createPanel(patientsPanelTemplate, {\r\n      \"ok\": true,\r\n      \"pathwayStage\": pathwayStage,\r\n      \"url\": window.location.hash.replace(/\\/yes/g, '').replace(/\\/no/g, ''),\r\n      \"text\": data[pathwayId][pathwayStage].text\r\n    }, {\r\n      \"content\": $('#patients-panel-yes').html()\r\n    });\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, location, standard) {\r\n\r\n    patientList.wireUp(function(patientId){\r\n      $('[data-toggle=\"tooltip\"]').tooltip('hide');\r\n      $(this).tooltip('destroy');\r\n      base.clearBox();\r\n      $('.list-item').removeClass('highlighted');\r\n      $(this).addClass('highlighted').removeAttr(\"title\");\r\n\r\n      pt.showPathwayStagePatientView(patientId, pathwayId, selected, standard);\r\n    });\r\n\r\n    patientsPanel = $('#patients');\r\n\r\n    location.off('click', '#breakdown-chart');\r\n    location.on('click', '#breakdown-chart', function() {\r\n      if (!lookup.chartClicked) {\r\n        /*jshint unused: true*/\r\n        $('path.c3-bar').attr('class', function(index, classNames) {\r\n          return classNames.replace(/_unselected_/g, '');\r\n        });\r\n        /*jshint unused: false*/\r\n\r\n        if (lookup.charts['breakdown-chart']) lookup.charts['breakdown-chart'].unselect();\r\n\r\n        patientList.populate(pathwayId, pathwayStage, standard, null);\r\n        data.subselected = null;\r\n\r\n        farRightPanel.fadeOut(200);\r\n      }\r\n      lookup.chartClicked = false;\r\n    });\r\n\r\n    chart.destroyCharts(['breakdown-chart']);\r\n    setTimeout(function() {\r\n      lookup.charts['breakdown-chart'] = c3.generate({\r\n        bindto: '#breakdown-chart',\r\n        tooltip: {\r\n          format: {\r\n            name: function(name, a, b) {\r\n              var text = data[pathwayId][pathwayStage].standards[standard].opportunities[lookup.index].desc;\r\n              var html = \"\";\r\n              while (text.length > 40) {\r\n                if (text.indexOf(' ', 40) < 0) break;\r\n                html += text.substr(0, text.indexOf(' ', 40)) + '<br>';\r\n                text = text.substr(text.indexOf(' ', 40) + 1);\r\n              }\r\n              html += text;\r\n              return html;\r\n            },\r\n            value: function(value, ratio, id, index) {\r\n              lookup.index = index;\r\n              return value;\r\n            }\r\n          }\r\n        },\r\n        data: {\r\n          columns: [\r\n            [\"Patients\"].concat(data[pathwayId][pathwayStage].standards[standard].opportunities.map(function(val) {\r\n              return val.patients.length;\r\n            }))\r\n          ],\r\n          type: 'bar',\r\n          labels: true,\r\n          color: function(color, d) {\r\n            return lookup.colors[d.index];\r\n          },\r\n          selection: {\r\n            enabled: true\r\n          },\r\n          onclick: function(d) {\r\n            chart.selectPieSlice('breakdown-chart', d);\r\n            patientList.populate(pathwayId, pathwayStage, standard, data[pathwayId][pathwayStage].standards[standard].opportunities[d.index].name);\r\n            data.subselected = data[pathwayId][pathwayStage].standards[standard].opportunities[d.index].name;\r\n\r\n            //colour table appropriately - need to add opacity\r\n            var sliceColourHex = lookup.colors[d.index];\r\n            var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n            sliceColourHex = sliceColourHex.replace(shorthandRegex, function(m, r, g, b) {\r\n              return r + r + g + g + b + b;\r\n            });\r\n            var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(sliceColourHex);\r\n            var opacity = 0.2;\r\n            var sliceColour = 'rgba(' + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16) + ',' + opacity + ')';\r\n\r\n            $('.table.patient-list.table-head-hidden').css({\r\n              \"backgroundColor\": sliceColour\r\n            });\r\n          }\r\n        },\r\n        bar: {\r\n          width: {\r\n            ratio: 0.5\r\n          }\r\n        },\r\n        legend: {\r\n          show: false\r\n        },\r\n        grid: {\r\n          focus: {\r\n            show: false\r\n          }\r\n        },\r\n        axis: {\r\n          x: {\r\n            type: 'category',\r\n            categories: data[pathwayId][pathwayStage].standards[standard].opportunities.map(function(val) {\r\n              return val.name;\r\n            }),\r\n            label: false\r\n          },\r\n          y: {\r\n            label: {\r\n              text: 'Patient count (n)',\r\n              position: 'outer-middle'\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }, 1);\r\n  },\r\n\r\n  wireUpOk: function(pathwayId, pathwayStage, location) {\r\n    patientsPanel = $('#patients');\r\n\r\n    patientsPanel.on('click', 'thead tr th.sortable', function() { //Sort columns when column header clicked\r\n      var sortAsc = !$(this).hasClass('sort-asc');\r\n      if (sortAsc) {\r\n        $(this).removeClass('sort-desc').addClass('sort-asc');\r\n      } else {\r\n        $(this).removeClass('sort-asc').addClass('sort-desc');\r\n      }\r\n      pt.populateOk(pathwayId, data.selected, data.subselected, $(this).index(), sortAsc);\r\n    }).on('click', 'tbody tr', function(e) { //Select individual patient when row clicked\r\n      $('[data-toggle=\"tooltip\"]').tooltip('hide');\r\n      $(this).tooltip('destroy');\r\n      base.clearBox();\r\n      $('.list-item').removeClass('highlighted');\r\n      $(this).addClass('highlighted').removeAttr('title');\r\n\r\n      var patientId = $(this).find('td button').attr('data-patient-id');\r\n\r\n      pt.showPathwayStagePatientView(patientId, pathwayId, data.selected, null);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }).on('click', 'tbody tr button', function(e) {\r\n      //don't want row selected if just button pressed?\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n\r\n    data.selected = pathwayStage;\r\n    data.subselected = null;\r\n  },\r\n\r\n  populateOk: function(pathwayId, pathwayStage, subsection, sortField, sortAsc) {\r\n    var pList = [],\r\n      i, k, prop, header, tooltip;\r\n    patientsPanel.fadeOut(200, function() {\r\n      $(this).fadeIn(200);\r\n    });\r\n\r\n    pList = data[pathwayId][pathwayStage].patientsOk;\r\n    header = data[pathwayId][pathwayStage].text.panelOkHeader.text;\r\n    tooltip = data[pathwayId][pathwayStage].text.panelOkHeader.tooltip;\r\n\r\n    pList = data.removeDuplicates(pList);\r\n    var patients = pList.map(function(patientId) {\r\n      var ret = data.patients[patientId];\r\n      ret.nhsNumber = data.patLookup ? data.patLookup[patientId] : patientId;\r\n      ret.patientId = patientId;\r\n      ret.items = []; //The fields in the patient list table\r\n      ret.items.push(data.patients[patientId].breach ? data.numberOfStandardsMissed(patientId) : 0);\r\n      return ret;\r\n    });\r\n    var localData = {\r\n      \"patients\": patients,\r\n      \"n\": patients.length,\r\n      \"header\": header,\r\n      \"tooltip\": tooltip,\r\n      \"header-items\": [{\r\n        \"title\": \"NHS no.\",\r\n        \"isSorted\": false,\r\n        \"direction\": \"sort-asc\"\r\n      }, {\r\n        \"title\": \"All Opportunities\",\r\n        \"titleHTML\": '# of <i class=\"fa fa-flag\" style=\"color:red\"></i>',\r\n        \"isSorted\": true,\r\n        \"direction\": \"sort-desc\",\r\n        \"tooltip\": \"Total number of improvement opportunities available across all conditions\"\r\n      }]\r\n    };\r\n\r\n    if (sortField === undefined) sortField = 1;\r\n\r\n    localData.patients.sort(function(a, b) {\r\n      if (sortField === 0) { //NHS number\r\n        if (a.nhsNumber === b.nhsNumber) {\r\n          return 0;\r\n        }\r\n\r\n        if (a.nhsNumber > b.nhsNumber) {\r\n          return sortAsc ? 1 : -1;\r\n        } else if (a.nhsNumber < b.nhsNumber) {\r\n          return sortAsc ? -1 : 1;\r\n        }\r\n      } else {\r\n        if (a.items[sortField - 1] === b.items[sortField - 1]) {\r\n          return 0;\r\n        }\r\n\r\n        var A = Number(a.items[sortField - 1]);\r\n        var B = Number(b.items[sortField - 1]);\r\n        if (isNaN(A) || isNaN(B)) {\r\n          A = a.items[sortField - 1];\r\n          B = b.items[sortField - 1];\r\n        }\r\n        if (A > B) {\r\n          return sortAsc ? 1 : -1;\r\n        } else if (A < B) {\r\n          return sortAsc ? -1 : 1;\r\n        }\r\n      }\r\n    });\r\n\r\n    for (i = 0; i < localData[\"header-items\"].length; i++) {\r\n      if (i === sortField) {\r\n        localData[\"header-items\"][i].direction = sortAsc ? \"sort-asc\" : \"sort-desc\";\r\n        localData[\"header-items\"][i].isAsc = sortAsc;\r\n        localData[\"header-items\"][i].isSorted = true;\r\n      } else {\r\n        localData[\"header-items\"][i].isSorted = false;\r\n      }\r\n    }\r\n\r\n\r\n    base.createPanelShow(patientList, patientsPanel, localData, {\r\n      \"header-item\": $(\"#patient-list-header-item\").html(),\r\n      \"item\": $('#patient-list-item').html()\r\n    });\r\n\r\n    $('#patients-placeholder').hide();\r\n\r\n    base.setupClipboard($('.btn-copy'), true);\r\n\r\n    base.wireUpTooltips();\r\n\r\n    var c = patientsPanel.find('div.table-scroll').getNiceScroll();\r\n    if (c && c.length > 0) {\r\n      c.resize();\r\n    } else {\r\n      patientsPanel.find('div.table-scroll').niceScroll({\r\n        cursoropacitymin: 0.3,\r\n        cursorwidth: \"7px\",\r\n        horizrailenabled: false\r\n      });\r\n    }\r\n  },\r\n\r\n  //Show patient view within the pathway stage view\r\n  showPathwayStagePatientView: function(patientId, pathwayId, pathwayStage, standard) {\r\n    data.patientId = patientId;\r\n\r\n    base.switchTo110Layout();\r\n\r\n    pt.showIndividualPatientPanel(pathwayId, pathwayStage, standard, patientId);\r\n  },\r\n\r\n  showIndividualPatientPanel: function(pathwayId, pathwayStage, standard, patientId) {\r\n    var stan = data[pathwayId][pathwayStage].standards[standard] ? data[pathwayId][pathwayStage].standards[standard].tab.title : \"UNSPECIFIED\";\r\n\r\n    data.options.sort(function(a, b) {\r\n      a = data.getPatientStatus(patientId, a.pathwayId, a.pathwayStage, a.standard);\r\n      b = data.getPatientStatus(patientId, b.pathwayId, b.pathwayStage, b.standard);\r\n\r\n      if (a === b) return 0;\r\n      if (a === \"not\") return 1;\r\n      if (b === \"not\") return -1;\r\n      if (a === \"ok\") return 1;\r\n      if (b === \"ok\") return -1;\r\n      alert(\"!!!!!!!\");\r\n    });\r\n\r\n    var panel = base.createPanel($('#patient-panel'), {\r\n      \"options\": data.options,\r\n      \"numberOfStandardsMissed\": data.numberOfStandardsMissed(patientId),\r\n      \"standard\": stan,\r\n      \"pathwayStage\": pathwayStage,\r\n      \"nhsNumber\": data.patLookup ? data.patLookup[patientId] : patientId,\r\n      \"patientId\": patientId\r\n    }, {\r\n      \"option\": $('#patient-panel-drop-down-options').html()\r\n    });\r\n\r\n    if (standard === null) {\r\n      //Must be a patient from the *** OK group\r\n      standard = data.options.filter(function(val) {\r\n        return val.pathwayId === pathwayId && val.pathwayStage === pathwayStage;\r\n      })[0].standard;\r\n    }\r\n\r\n    farRightPanel.html(\"\");\r\n    $('#temp-hidden').html(panel);\r\n\r\n    var actionPlan = individualActionPlan.create(pathwayStage);\r\n    $('#temp-hidden #patient-panel-right').html(actionPlan);\r\n\r\n    var qualPanel = qualityStandard.create(pathwayId, pathwayStage, standard, patientId);\r\n    var trendPanel = trend.create(pathwayId, pathwayStage, standard, patientId);\r\n    var medPanel = medication.create(pathwayId, pathwayStage, standard, patientId);\r\n    var codesPanel = otherCodes.create(pathwayId, pathwayStage, standard, patientId);\r\n    var medCodeWrapperPanel = base.createPanel($('#other-codes-and-meds-wrapper-panel'));\r\n    $('#temp-hidden #patient-panel-top').html(qualPanel);\r\n    $('#temp-hidden #patient-panel-left').html(\"\").append(trendPanel).append(medCodeWrapperPanel);\r\n    $('#temp-hidden #medCodeWrapperPanel').append(medPanel).append(codesPanel);\r\n\r\n    if (farRightPanel.is(':visible')) {\r\n      farRightPanel.fadeOut(500, function() {\r\n        $(this).html($('#temp-hidden').html());\r\n        $('#temp-hidden').html(\"\");\r\n        individualActionPlan.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        qualityStandard.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        base.wireUpStandardDropDown(pathwayId, pathwayStage, standard, pt.showIndividualPatientPanel);\r\n        trend.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        medication.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        otherCodes.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n        chart.drawTrendChart(patientId, pathwayId, pathwayStage, standard);\r\n        $(this).fadeIn(500, function() {});\r\n      });\r\n    } else {\r\n      farRightPanel.html($('#temp-hidden').html());\r\n      $('#temp-hidden').html(\"\");\r\n      individualActionPlan.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      qualityStandard.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      base.wireUpStandardDropDown(pathwayId, pathwayStage, standard, pt.showIndividualPatientPanel);\r\n      trend.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      medication.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      otherCodes.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n      chart.drawTrendChart(patientId, pathwayId, pathwayStage, standard);\r\n      farRightPanel.fadeIn(500, function() {});\r\n    }\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = pt;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js'),\r\n  confirm = require('./confirm.js');\r\n\r\nvar ID = \"QUALITYSTANDARD\";\r\n\r\nvar qs = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard, patientId) {\r\n\r\n    var localData = {\r\n      \"nhsNumber\": data.patLookup ? data.patLookup[patientId] : patientId,\r\n      \"patientId\": patientId\r\n    };\r\n    localData.standard = data.pathwayNames[pathwayId] + ' - ' + pathwayStage;\r\n    if (data.patients[patientId].standards && data.patients[patientId].standards[pathwayId] &&\r\n      data.patients[patientId].standards[pathwayId][pathwayStage] &&\r\n      data.patients[patientId].standards[pathwayId][pathwayStage][standard]) {\r\n      localData.standard = data.patients[patientId].standards[pathwayId][pathwayStage][standard];\r\n    }\r\n\r\n    localData.tooltip = data[pathwayId][pathwayStage].standards[standard][\"standard-met-tooltip\"];\r\n\r\n    switch (data.getPatientStatus(patientId, pathwayId, pathwayStage, standard)) {\r\n      case \"ok\":\r\n        ////farRightPanel.removeClass('standard-missed-page').addClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n        localData.achieved = true;\r\n        localData.relevant = true;\r\n        break;\r\n      case \"missed\":\r\n        ////farRightPanel.addClass('standard-missed-page').removeClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n        localData.relevant = true;\r\n        localData.achieved = false;\r\n        break;\r\n      case \"not\":\r\n        ////farRightPanel.removeClass('standard-missed-page').removeClass('standard-achieved-page').addClass('standard-not-relevant-page');\r\n        localData.relevant = false;\r\n        break;\r\n    }\r\n\r\n    var agObj = log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, \"standard\");\r\n    if (agObj && agObj.agree) localData.agree = true;\r\n    else if (agObj && agObj.agree === false) localData.disagree = true;\r\n\r\n    return base.createPanel($('#qual-standard'), localData);\r\n  },\r\n\r\n  show: function(panel, pathwayId, pathwayStage, standard, patientId){\r\n\r\n    var panelId = panel.attr(\"id\");\r\n\r\n    if (base.panels[panelId] &&\r\n      base.panels[panelId].id === ID &&\r\n      base.panels[panelId].patientId === patientId) {\r\n        //Already showing the right thing\r\n        return;\r\n    }\r\n\r\n    base.panels[panelId] = {\r\n      id: ID,\r\n      patientId: patientId\r\n    };\r\n\r\n    panel.html(qs.create(pathwayId, pathwayStage, standard, patientId));\r\n    qs.wireUp(pathwayId, pathwayStage, standard, patientId);\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, standard, patientId) {\r\n    confirm.wireUp($('#qual-agree-disagree'), $('#individual-panel-classification'), pathwayId, pathwayStage, standard, patientId, \"standard\", \"quality standard\");\r\n  },\r\n\r\n  update: function() {\r\n    $('#individual-panel-classification').find('div').each(function() {\r\n      var self = $(this);\r\n      var any = false;\r\n      self.find('.btn-toggle input[type=checkbox]:checked').each(function() {\r\n        var isClassification = $(this).closest(\"div\").data(\"isClassification\") !== undefined;\r\n        any = true;\r\n        var item = log.getAgrees()[data.patientId].filter(function(i) {\r\n          return isClassification ? i.item === \"section\" : i.item !== \"section\";\r\n        });\r\n        var tool;\r\n        if (this.value === \"yes\") {\r\n          if (item && item[0].history) {\r\n            tool = \"<p>\" + item[0].history[0] + \"</p><p>Click again to cancel</p>\";\r\n            $(this).parent().attr(\"title\", tool).attr(\"data-original-title\", tool).tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You agreed - click again to cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        } else {\r\n          if (item && item[0].history) {\r\n            tool = \"<p>\" + item[0].history[0] + \"</p><p>Click again to edit/cancel</p>\";\r\n            $(this).parent().attr(\"title\", tool).attr(\"data-original-title\", tool).tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You disagreed - click again to edit/cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        }\r\n      });\r\n\r\n      if (self.find('.btn-toggle input[type=checkbox]:not(:checked)').length == 1) {\r\n        self.find('.btn-toggle input[type=checkbox]:not(:checked)').parent().addClass(\"inactive\").attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n\r\n      if (!any) {\r\n        self.find('.btn-toggle.btn-yes').attr(\"title\", \"Click to agree with this action and save it in your agreed actions list  \").tooltip('fixTitle').tooltip('hide');\r\n        self.find('.btn-toggle.btn-no').attr(\"title\", \"Click to disagree with this action and remove it from your suggested actions list \").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n\r\n      base.wireUpTooltips();\r\n    });\r\n\r\n    base.wireUpTooltips();\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = qs;\r\n","var data = require('../data.js');\r\n\r\nvar qs = {\r\n\r\n  show: function(panel, isAppend, patientId) {\r\n\r\n    var patientData = data.getPatientData(patientId);\r\n\r\n    var tmpl = require(\"templates/quality-standard\");\r\n    var html = tmpl({\r\n      \"standards\": patientData.standards\r\n    });\r\n\r\n    if (isAppend) panel.append(html);\r\n    else panel.html(html);\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = qs;\r\n","var base = require('../base.js'),\r\n  confirm = require('./confirm.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js');\r\n\r\nvar tap = {\r\n\r\n  show: function(location) {\r\n    location.removeClass('standard-missed-page').removeClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n    //base.createPanelShow($('#team-action-plan-panel'), location);\r\n    var tmpl = require('templates/team-action-plan');\r\n    location.html(tmpl());\r\n\r\n    suggestedPlanTeam = $('#suggestedPlanTeam');\r\n\r\n    suggestedPlanTeam.on('click', '.cr-styled input[type=checkbox]', function() {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(\"team\", ACTIONID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        log.recordEvent(data.pathwayId, \"team\", \"Item completed\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        base.wireUpTooltips();\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            parent.find('button').on('click', function() {\r\n              ACTIONID = $(this).closest('tr').data('id');\r\n              log.editAction(\"team\", ACTIONID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              tap.updateTeamSapRows();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n\r\n      tap.updateTeamSapRows();\r\n    });\r\n\r\n    $('#personalPlanTeam').on('click', 'input[type=checkbox]', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n      editPlan(PLANID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        $(this).parent().parent().parent().addClass('success');\r\n        recordEvent(data.pathwayId, \"team\", \"Personal plan item\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            base.wireUpTooltips();\r\n            parent.find('button').on('click', function() {\r\n              PLANID = $(this).closest('tr').data('id');\r\n              editPlan(\"team\", PLANID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              tap.updateTeamSapRows();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var PLANID = $(this).closest('tr').data('id');\r\n      log.editPlan(PLANID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      tap.updateTeamSapRows();\r\n      e.stopPropagation();\r\n    });\r\n\r\n    var teamTab = $('#tab-plan-team'),\r\n      current;\r\n    teamTab.on('click', '.edit-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#editActionPlanItem').val($($(this).closest('tr').children('td')[0]).find('span').text());\r\n\r\n      $('#editPlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        tap.displayPersonalisedTeamActionPlan($('#personalPlanTeam'));\r\n      }).off('shown.bs.modal').on('shown.bs.modal', function() {\r\n        $('#editActionPlanItem').focus();\r\n      }).off('click', '.save-plan').on('click', '.save-plan', function() {\r\n\r\n        log.editPlan(PLANID, $('#editActionPlanItem').val());\r\n\r\n        $('#editPlan').modal('hide');\r\n      }).off('keyup', '#editActionPlanItem').on('keyup', '#editActionPlanItem', function(e) {\r\n        if (e.which === 13) $('#editPlan .save-plan').click();\r\n      }).modal();\r\n    }).on('click', '.delete-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#modal-delete-item').html($($(this).closest('tr').children('td')[0]).find('span').text());\r\n\r\n      $('#deletePlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        tap.displayPersonalisedTeamActionPlan($('#personalPlanTeam'));\r\n      }).off('click', '.delete-plan').on('click', '.delete-plan', function() {\r\n        log.deletePlan(PLANID);\r\n\r\n        $('#deletePlan').modal('hide');\r\n      }).modal();\r\n    }).on('click', '.add-plan', function() {\r\n      log.recordPlan(\"team\", $(this).parent().parent().find('textarea').val(), data.pathwayId);\r\n\r\n      tap.displayPersonalisedTeamActionPlan($('#personalPlanTeam'));\r\n    }).on('change', '.btn-toggle input[type=checkbox]', function() {\r\n      tap.updateTeamSapRows();\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(\"team\", ACTIONID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      tap.updateTeamSapRows();\r\n    }).on('click', '.btn-yes,.btn-no', function(e) {\r\n      var checkbox = $(this).find(\"input[type=checkbox]\");\r\n      var other = $(this).parent().find($(this).hasClass(\"btn-yes\") ? \".btn-no\" : \".btn-yes\");\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      if ($(this).hasClass(\"active\") && other.hasClass(\"inactive\") && !$(this).closest('tr').hasClass('success')) {\r\n        //unselecting\r\n        if (checkbox.val() === \"no\") {\r\n          tap.launchModal(data.selected, checkbox.closest('tr').children().first().children().first().text(), log.getReason(\"team\", ACTIONID), true, function() {\r\n            log.editAction(\"team\", ACTIONID, false, null, log.reason);\r\n            tap.updateTeamSapRows();\r\n            base.wireUpTooltips();\r\n          }, null, function() {\r\n            log.ignoreAction(\"team\", ACTIONID);\r\n            other.removeClass(\"inactive\");\r\n            checkbox.removeAttr(\"checked\");\r\n            checkbox.parent().removeClass(\"active\");\r\n            tap.updateTeamSapRows();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.ignoreAction(\"team\", ACTIONID);\r\n          other.removeClass(\"inactive\");\r\n        }\r\n      } else if ((!$(this).hasClass(\"active\") && other.hasClass(\"active\")) || $(this).closest('tr').hasClass('success')) {\r\n        //prevent clicking on unselected option or if the row is complete\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        return;\r\n      } else {\r\n        //selecting\r\n        var self = this;\r\n        if (checkbox.val() === \"no\") {\r\n          tap.launchModal(data.selected, checkbox.closest('tr').children().first().children().first().text(), log.getReason(\"team\", ACTIONID), false, function() {\r\n            log.editAction(\"team\", ACTIONID, false, null, log.reason);\r\n            $(self).removeClass(\"inactive\");\r\n\r\n            checkbox.attr(\"checked\", \"checked\");\r\n            checkbox.parent().addClass(\"active\");\r\n            //unselect other\r\n            other.removeClass(\"active\").addClass(\"inactive\");\r\n            other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n            tap.updateTeamSapRows();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editAction(\"team\", ACTIONID, true);\r\n          $(this).removeClass(\"inactive\");\r\n\r\n          //unselect other\r\n          other.removeClass(\"active\").addClass(\"inactive\");\r\n          other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n        }\r\n      }\r\n    }).on('keyup', 'input[type=text]', function(e) {\r\n      if (e.which === 13) {\r\n        teamTab.find('.add-plan').click();\r\n      }\r\n    });\r\n\r\n    tap.populateTeamSuggestedActionsPanel();\r\n\r\n    location.find('div.fit-to-screen-height').niceScroll({\r\n      cursoropacitymin: 0.3,\r\n      cursorwidth: \"7px\",\r\n      horizrailenabled: false\r\n    });\r\n  },\r\n\r\n  populateTeamSuggestedActionsPanel: function() {\r\n    /*var suggestions = base.suggestionList(log.plan[data.pathwayId].team);\r\n    suggestions = base.sortSuggestions(tap.mergeTeamStuff(suggestions));*/\r\n    var suggestions=[];\r\n\r\n    /*base.createPanelShow(suggestedPlanTemplate, suggestedPlanTeam, {\r\n      \"suggestions\": suggestions\r\n    }, {\r\n      \"item\": $('#suggested-plan-item').html(),\r\n      \"chk\": $('#checkbox-template').html()\r\n    });*/\r\n\r\n    var tmpl = require('templates/suggested-plan');\r\n    suggestedPlanTeam.html(tmpl({\r\n      \"suggestions\": suggestions\r\n    }));\r\n    tap.displayPersonalisedTeamActionPlan($('#personalPlanTeam'));\r\n  },\r\n\r\n  updateTeamSapRows: function() {\r\n    suggestedPlanTeam.add('#personalPlanTeam').find('.suggestion').each(function() {\r\n      $(this).find('td').last().children().hide();\r\n    });\r\n\r\n    suggestedPlanTeam.add('#personalPlanTeam').find('.cr-styled input[type=checkbox]').each(function() {\r\n      if (this.checked) {\r\n        $(this).parent().parent().parent().addClass('success');\r\n      } else {\r\n        $(this).parent().parent().parent().removeClass('success');\r\n      }\r\n    });\r\n\r\n    suggestedPlanTeam.add('#personalPlanTeam').find('.btn-undo').each(function() {\r\n      $(this).parent().parent().addClass('success');\r\n    });\r\n\r\n    //no class - user not yet agreed/disagreed - no background / muted text\r\n    //active - user agrees - green background / normal text\r\n    //success - user completed - green background / strikethrough text\r\n    //danger - user disagrees - red background / strikethrough text\r\n    suggestedPlanTeam.add('#personalPlanTeam').find('tr').each(function() {\r\n      var self = $(this);\r\n      var any = false;\r\n      self.find('.btn-toggle input[type=checkbox]:checked').each(function() {\r\n        any = true;\r\n        if (this.value === \"yes\") {\r\n          self.removeClass('danger');\r\n          self.addClass('active');\r\n          self.find('td').last().children().show();\r\n          if (log.getActions().team[self.data(\"id\")].history) {\r\n            var tool = $(this).closest('tr').hasClass('success') ? \"\" : \"<p>\" + log.getActions().team[self.data(\"id\")].history[0] + \"</p><p>Click again to cancel</p>\";\r\n            $(this).parent().attr(\"title\", tool).attr(\"data-original-title\", tool).tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You agreed - click again to cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        } else {\r\n          self.removeClass('active');\r\n          self.addClass('danger');\r\n          self.removeClass('success');\r\n          if (log.getActions().team[self.data(\"id\")] && log.getActions().team[self.data(\"id\")].history) {\r\n            $(this).parent().attr(\"title\", \"<p>\" + log.getActions().team[self.data(\"id\")].history[0] + \"</p><p>Click again to edit/cancel</p>\").tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You disagreed - click again to edit/cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        }\r\n      });\r\n      if (self.find('.btn-toggle input[type=checkbox]:not(:checked)').length == 1) {\r\n        self.find('.btn-toggle input[type=checkbox]:not(:checked)').parent().addClass(\"inactive\").attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n      if (!any) {\r\n        self.removeClass('danger');\r\n        self.removeClass('active');\r\n        self.removeClass('success');\r\n\r\n        self.find('.btn-toggle.btn-yes').attr(\"title\", \"Click to agree with this action and save it in your agreed actions list  \").tooltip('fixTitle').tooltip('hide');\r\n        self.find('.btn-toggle.btn-no').attr(\"title\", \"Click to disagree with this action and remove it from your suggested actions list \").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n\r\n      base.wireUpTooltips();\r\n    });\r\n\r\n    base.wireUpTooltips();\r\n  },\r\n\r\n  displayPersonalisedTeamActionPlan: function(parentElem) {\r\n    var plans = base.sortSuggestions(base.addDisagreePersonalTeam(log.listPlans(\"team\", data.pathwayId)));\r\n\r\n    /*base.createPanelShow(actionPlanList, parentElem, {\r\n      \"hasSuggestions\": plans && plans.length > 0,\r\n      \"suggestions\": plans\r\n    }, {\r\n      \"action-plan\": $('#action-plan').html(),\r\n      \"action-plan-item\": $('#action-plan-item').html(),\r\n      \"chk\": $('#checkbox-template').html()\r\n    });*/\r\n\r\n    var tmpl = require('templates/action-plan-list');\r\n    parentElem.html(tmpl({\r\n      \"hasSuggestions\": plans && plans.length > 0,\r\n      \"suggestions\": plans\r\n    }));\r\n\r\n    tap.updateTeamSapRows();\r\n  },\r\n\r\n  mergeTeamStuff: function(suggestions) {\r\n    var teamActions = log.listActions();\r\n    if (!teamActions.team) return suggestions;\r\n\r\n    suggestions = tap.addDisagree(suggestions, teamActions, \"team\");\r\n    return suggestions;\r\n  },\r\n\r\n  launchModal: function(label, value, reason, isUndo, callbackOnSave, callbackOnCancel, callbackOnUndo) {\r\n    var reasons = [{\r\n      \"reason\": \"We've already done this\",\r\n      \"value\": \"done\"\r\n    }, {\r\n      \"reason\": \"It wouldn't work\",\r\n      \"value\": \"nowork\"\r\n    }, {\r\n      \"reason\": \"Other\",\r\n      \"value\": \"else\"\r\n    }];\r\n    if (reason && reason.reason) {\r\n      for (var i = 0; i < reasons.length; i++) {\r\n        if (reasons[i].reason === reason.reason) {\r\n          reasons[i].checked = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    base.launchModal({\r\n      \"header\": \"Disagree with a suggested action\",\r\n      \"isUndo\": isUndo,\r\n      \"item\": value,\r\n      \"placeholder\": \"Enter free-text here...\",\r\n      \"reasons\": reasons\r\n    }, label, value, reason ? reason.reasonText : null, callbackOnSave, callbackOnCancel, callbackOnUndo);\r\n  },\r\n\r\n  addDisagree: function(suggestions, actions, id) {\r\n    for (var i = 0; i < suggestions.length; i++) {\r\n      if (actions[id][suggestions[i].id]) {\r\n        if (actions[id][suggestions[i].id].agree) {\r\n          suggestions[i].agree = true;\r\n          suggestions[i].disagree = false;\r\n        } else if (actions[id][suggestions[i].id].agree === false) {\r\n          suggestions[i].agree = false;\r\n          suggestions[i].disagree = true;\r\n        }\r\n        if (actions[id][suggestions[i].id].done) suggestions[i].done = actions[id][suggestions[i].id].done;\r\n        else suggestions[i].done = false;\r\n      }\r\n    }\r\n    return suggestions;\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = tap;\r\n","var base = require('../base.js'),\r\n  confirm = require('./confirm.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js'),\r\n  lookup = require('../lookup.js');\r\n\r\nvar trnd = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard, patientId) {\r\n    var agree = log.getPatientAgreeObject(pathwayId, pathwayStage, standard, patientId, \"trend\");\r\n    return base.createPanel(valueTrendPanel, {\r\n      \"pathway\": lookup.monitored[pathwayId],\r\n      \"agree\": agree && agree.agree,\r\n      \"disagree\": agree && agree.agree === false,\r\n      \"standard\": data[pathwayId][pathwayStage].standards[standard].tab.title,\r\n      \"pathwayStage\": pathwayStage\r\n    });\r\n  },\r\n\r\n  wireUp: function(pathwayId, pathwayStage, standard, patientId) {\r\n    confirm.wireUp($('#trend-agree-disagree'), $('#trend-panel'), pathwayId, pathwayStage, standard, patientId, \"trend\", \"trend data\");\r\n\r\n    $('#trend-panel').on('click', '.table-chart-toggle', function() {\r\n      if ($(this).text() === \"Table\") {\r\n        $(this).text(\"Chart\");\r\n        $('#chart-demo-trend').hide();\r\n        $('#table-demo-trend').show();\r\n\r\n        var c = $('#table-demo-trend .tableScroll').getNiceScroll();\r\n        if (c && c.length > 0) {\r\n          c.resize();\r\n        } else {\r\n          $('#table-demo-trend .tableScroll').niceScroll({\r\n            cursoropacitymin: 0.3,\r\n            cursorwidth: \"7px\",\r\n            horizrailenabled: false\r\n          });\r\n        }\r\n      } else {\r\n        $(this).text(\"Table\");\r\n        $('#chart-demo-trend').show();\r\n        $('#table-demo-trend').hide();\r\n      }\r\n    });\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = trnd;\r\n","var base = require('../base.js'),\r\n  data = require('../data.js'),\r\n  log = require('../log.js'),\r\n  individualActionPlan = require('./individualActionPlan.js'),\r\n  teamActionPlan = require('./teamActionPlan.js'),\r\n  Mustache = require('mustache');\r\n\r\nvar welcome = {\r\n\r\n  wireUpWelcomePage: function(pathwayId, pathwayStage) {\r\n    $('#team-task-panel').on('click', '.cr-styled input[type=checkbox]', function() {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(\"team\", ACTIONID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        log.recordEvent(pathwayId, \"team\", \"Item completed\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        base.wireUpTooltips();\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            parent.find('button').on('click', function() {\r\n              ACTIONID = $(this).closest('tr').data('id');\r\n              log.editAction(\"team\", ACTIONID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              welcome.updateWelcomePage();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n      welcome.updateWelcomePage();\r\n    }).on('change', '.btn-toggle input[type=checkbox]', function() {\r\n      welcome.updateWelcomePage();\r\n    }).on('click', '.edit-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#editActionPlanItem').val($($(this).closest('tr').children('td')[1]).find('span').text());\r\n\r\n      $('#editPlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        welcome.populate(!$('#outstandingTasks').parent().hasClass(\"active\"));\r\n      }).off('shown.bs.modal').on('shown.bs.modal', function() {\r\n        $('#editActionPlanItem').focus();\r\n      }).off('click', '.save-plan').on('click', '.save-plan', function() {\r\n\r\n        log.editPlan(PLANID, $('#editActionPlanItem').val());\r\n\r\n        $('#editPlan').modal('hide');\r\n      }).off('keyup', '#editActionPlanItem').on('keyup', '#editActionPlanItem', function(e) {\r\n        if (e.which === 13) $('#editPlan .save-plan').click();\r\n      }).modal();\r\n    }).on('click', '.delete-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#modal-delete-item').html($($(this).closest('tr').children('td')[1]).find('span').text());\r\n\r\n      $('#deletePlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        welcome.populate(!$('#outstandingTasks').parent().hasClass(\"active\"));\r\n      }).off('click', '.delete-plan').on('click', '.delete-plan', function() {\r\n        log.deletePlan(PLANID);\r\n\r\n        $('#deletePlan').modal('hide');\r\n      }).modal();\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      log.editAction(\"team\", ACTIONID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      welcome.updateWelcomePage();\r\n    }).on('click', '.btn-yes,.btn-no', function(e) {\r\n      var checkbox = $(this).find(\"input[type=checkbox]\");\r\n      var other = $(this).parent().find($(this).hasClass(\"btn-yes\") ? \".btn-no\" : \".btn-yes\");\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      if ($(this).hasClass(\"active\") && other.hasClass(\"inactive\") && !$(this).closest('tr').hasClass('success')) {\r\n        //unselecting\r\n        if (checkbox.val() === \"no\") {\r\n          teamActionPlan.launchModal(data.selected, checkbox.closest('tr').children(':nth(1)').find('span').text(), log.getReason(\"team\", ACTIONID), true, function() {\r\n            log.editAction(\"team\", ACTIONID, false, null, log.reason);\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          }, null, function() {\r\n            log.ignoreAction(\"team\", ACTIONID);\r\n            other.removeClass(\"inactive\");\r\n            checkbox.removeAttr(\"checked\");\r\n            checkbox.parent().removeClass(\"active\");\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.ignoreAction(\"team\", ACTIONID);\r\n          other.removeClass(\"inactive\");\r\n        }\r\n      } else if ((!$(this).hasClass(\"active\") && other.hasClass(\"active\")) || $(this).closest('tr').hasClass('success')) {\r\n        //prevent clicking on unselected option or if the row is complete\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        return;\r\n      } else {\r\n        //selecting\r\n        var self = this;\r\n        if (checkbox.val() === \"no\") {\r\n          teamActionPlan.launchModal(data.selected, checkbox.closest('tr').children(':nth(1)').find('span').text(), log.getReason(\"team\", ACTIONID), false, function() {\r\n            log.editAction(\"team\", ACTIONID, false, null, log.reason);\r\n            $(self).removeClass(\"inactive\");\r\n\r\n            checkbox.attr(\"checked\", \"checked\");\r\n            checkbox.parent().addClass(\"active\");\r\n            //unselect other\r\n            other.removeClass(\"active\").addClass(\"inactive\");\r\n            other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editAction(\"team\", ACTIONID, true);\r\n          $(this).removeClass(\"inactive\");\r\n\r\n          //unselect other\r\n          other.removeClass(\"active\").addClass(\"inactive\");\r\n          other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n        }\r\n      }\r\n    });\r\n\r\n    $('#individual-task-panel').on('click', '.cr-styled input[type=checkbox]', function() {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      var patientId = $(this).closest('tr').data('team-or-patient-id');\r\n      log.editAction(patientId, ACTIONID, null, this.checked);\r\n\r\n      if (this.checked) {\r\n        log.recordEvent(pathwayId, patientId, \"Item completed\");\r\n        var self = this;\r\n        $(self).parent().attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n        base.wireUpTooltips();\r\n        setTimeout(function(e) {\r\n          $(self).parent().fadeOut(300, function() {\r\n            var parent = $(this).parent();\r\n            $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n              \"done\": true\r\n            }));\r\n            parent.find('button').on('click', function() {\r\n              ACTIONID = $(this).closest('tr').data('id');\r\n              log.editAction(patientId, ACTIONID, null, false);\r\n              $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n                \"done\": false\r\n              }));\r\n              welcome.updateWelcomePage();\r\n            });\r\n          });\r\n        }, 1000);\r\n      }\r\n      welcome.updateWelcomePage();\r\n    }).on('change', '.btn-toggle input[type=checkbox]', function() {\r\n      welcome.updateWelcomePage();\r\n    }).on('click', '.edit-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#editActionPlanItem').val($($(this).closest('tr').children('td')[2]).find('span').text());\r\n\r\n      $('#editPlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        welcome.populate(!$('#outstandingTasks').parent().hasClass(\"active\"));\r\n      }).off('shown.bs.modal').on('shown.bs.modal', function() {\r\n        $('#editActionPlanItem').focus();\r\n      }).off('click', '.save-plan').on('click', '.save-plan', function() {\r\n\r\n        log.editPlan(PLANID, $('#editActionPlanItem').val());\r\n\r\n        $('#editPlan').modal('hide');\r\n      }).off('keyup', '#editActionPlanItem').on('keyup', '#editActionPlanItem', function(e) {\r\n        if (e.which === 13) $('#editPlan .save-plan').click();\r\n      }).modal();\r\n    }).on('click', '.delete-plan', function() {\r\n      var PLANID = $(this).closest('tr').data(\"id\");\r\n\r\n      $('#modal-delete-item').html($($(this).closest('tr').children('td')[2]).find('span').text());\r\n\r\n      $('#deletePlan').off('hidden.bs.modal').on('hidden.bs.modal', function() {\r\n        welcome.populate(!$('#outstandingTasks').parent().hasClass(\"active\"));\r\n      }).off('click', '.delete-plan').on('click', '.delete-plan', function() {\r\n        log.deletePlan(PLANID);\r\n\r\n        $('#deletePlan').modal('hide');\r\n      }).modal();\r\n    }).on('click', '.btn-undo', function(e) {\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      var patientId = $(this).closest('tr').data('team-or-patient-id');\r\n      log.editAction(patientId, ACTIONID, null, false);\r\n      $(this).replaceWith(base.createPanel($('#checkbox-template'), {\r\n        \"done\": false\r\n      }));\r\n      welcome.updateWelcomePage();\r\n    }).on('click', '.btn-yes,.btn-no', function(e) {\r\n      var checkbox = $(this).find(\"input[type=checkbox]\");\r\n      var other = $(this).parent().find($(this).hasClass(\"btn-yes\") ? \".btn-no\" : \".btn-yes\");\r\n      var ACTIONID = $(this).closest('tr').data('id');\r\n      var patientId = $(this).closest('tr').data('team-or-patient-id');\r\n      if ($(this).hasClass(\"active\") && other.hasClass(\"inactive\") && !$(this).closest('tr').hasClass('success')) {\r\n        //unselecting\r\n        if (checkbox.val() === \"no\") {\r\n          individualActionPlan.launchModal(data.selected, checkbox.closest('tr').children(':nth(2)').find('span').text(), log.getReason(patientId, ACTIONID), true, function() {\r\n            log.editAction(patientId, ACTIONID, false, null, log.reason);\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          }, null, function() {\r\n            log.ignoreAction(patientId, ACTIONID);\r\n            other.removeClass(\"inactive\");\r\n            checkbox.removeAttr(\"checked\");\r\n            checkbox.parent().removeClass(\"active\");\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.ignoreAction(patientId, ACTIONID);\r\n          other.removeClass(\"inactive\");\r\n        }\r\n      } else if ((!$(this).hasClass(\"active\") && other.hasClass(\"active\")) || $(this).closest('tr').hasClass('success')) {\r\n        //prevent clicking on unselected option or if the row is complete\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        return;\r\n      } else {\r\n        //selecting\r\n        var self = this;\r\n        if (checkbox.val() === \"no\") {\r\n          individualActionPlan.launchModal(data.selected, checkbox.closest('tr').children(':nth(2)').find('span').text(), log.getReason(patientId, ACTIONID), false, function() {\r\n            log.editAction(patientId, ACTIONID, false, null, log.reason);\r\n            $(self).removeClass(\"inactive\");\r\n\r\n            checkbox.attr(\"checked\", \"checked\");\r\n            checkbox.parent().addClass(\"active\");\r\n            //unselect other\r\n            other.removeClass(\"active\").addClass(\"inactive\");\r\n            other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n            welcome.updateWelcomePage();\r\n            base.wireUpTooltips();\r\n          });\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        } else {\r\n          log.editAction(patientId, ACTIONID, true);\r\n          $(this).removeClass(\"inactive\");\r\n\r\n          //unselect other\r\n          other.removeClass(\"active\").addClass(\"inactive\");\r\n          other.find(\"input[type=checkbox]\").prop(\"checked\", false);\r\n        }\r\n      }\r\n    });\r\n\r\n    welcome.updateWelcomePage();\r\n  },\r\n\r\n  updateWelcomePage: function() {\r\n    $('#team-task-panel').add('#individual-task-panel').find('.suggestion').each(function() {\r\n      $(this).find('td').last().children().hide();\r\n    });\r\n\r\n    $('#team-task-panel').add('#individual-task-panel').find('.cr-styled input[type=checkbox]').each(function() {\r\n      if (this.checked) {\r\n        $(this).parent().parent().parent().addClass('success');\r\n      } else {\r\n        $(this).parent().parent().parent().removeClass('success');\r\n      }\r\n    });\r\n\r\n    $('#team-task-panel').add('#individual-task-panel').find('.btn-undo').each(function() {\r\n      $(this).parent().parent().addClass('success');\r\n    });\r\n\r\n    //no class - user not yet agreed/disagreed - no background / muted text\r\n    //active - user agrees - green background / normal text\r\n    //success - user completed - green background / strikethrough text\r\n    //danger - user disagrees - red background / strikethrough text\r\n    $('#team-task-panel').add('#individual-task-panel').find('tr').each(function() {\r\n      var self = $(this);\r\n      var any = false;\r\n      self.find('.btn-toggle input[type=checkbox]:checked').each(function() {\r\n        any = true;\r\n        if (this.value === \"yes\") {\r\n          self.removeClass('danger');\r\n          self.addClass('active');\r\n          self.find('td').last().children().show();\r\n          if (log.getActions().team[self.data(\"id\")] && log.getActions().team[self.data(\"id\")].history) {\r\n            var tool = $(this).closest('tr').hasClass('success') ? \"\" : \"<p>\" + log.getActions().team[self.data(\"id\")].history[0] + \"</p><p>Click again to cancel</p>\";\r\n            $(this).parent().attr(\"title\", tool).attr(\"data-original-title\", tool).tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You agreed - click again to cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        } else {\r\n          self.removeClass('active');\r\n          self.addClass('danger');\r\n          self.removeClass('success');\r\n          if (log.getActions().team[self.data(\"id\")] && log.getActions().team[self.data(\"id\")].history) {\r\n            $(this).parent().attr(\"title\", \"<p>\" + log.getActions().team[self.data(\"id\")].history[0] + \"</p><p>Click again to edit/cancel</p>\").tooltip('fixTitle').tooltip('hide');\r\n          } else {\r\n            $(this).parent().attr(\"title\", \"You disagreed - click again to edit/cancel\").tooltip('fixTitle').tooltip('hide');\r\n          }\r\n        }\r\n      });\r\n      if (self.find('.btn-toggle input[type=checkbox]:not(:checked)').length == 1) {\r\n        self.find('.btn-toggle input[type=checkbox]:not(:checked)').parent().addClass(\"inactive\").attr(\"title\", \"\").attr(\"data-original-title\", \"\").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n      if (!any) {\r\n        self.removeClass('danger');\r\n        self.removeClass('active');\r\n        self.removeClass('success');\r\n\r\n        self.find('.btn-toggle.btn-yes').attr(\"title\", \"Click to agree with this action and save it in your agreed actions list  \").tooltip('fixTitle').tooltip('hide');\r\n        self.find('.btn-toggle.btn-no').attr(\"title\", \"Click to disagree with this action and remove it from your suggested actions list \").tooltip('fixTitle').tooltip('hide');\r\n      }\r\n\r\n      base.wireUpTooltips();\r\n    });\r\n\r\n    base.wireUpTooltips();\r\n  },\r\n\r\n  populate: function(complete) {\r\n\r\n    var k,l;\r\n    //add tasks\r\n    var teamTasks = [];\r\n    var individualTasks = [];\r\n\r\n    //Add the team tasks\r\n    for (k in log.listActions(\"team\")) {\r\n      if (log.listActions(\"team\")[k].agree && ((!log.listActions(\"team\")[k].done && !complete) || (log.listActions(\"team\")[k].done && complete))) {\r\n        teamTasks.push({\r\n          \"pathway\": \"N/A\",\r\n          \"task\": {short:log.text[log.listActions(\"team\")[k].id].text},\r\n          \"data\": log.listActions(\"team\")[k].id,\r\n          \"tpId\": \"team\",\r\n          \"agree\": true,\r\n          \"done\": complete\r\n        });\r\n      }\r\n    }\r\n\r\n    //Add the user added team tasks\r\n    for (k in log.listPlans(\"team\")) {\r\n      if ((!log.listPlans(\"team\")[k].done && !complete) || (log.listPlans(\"team\")[k].done && complete)) {\r\n        teamTasks.push({\r\n          \"canEdit\": true,\r\n          \"pathway\": data.pathwayNames[log.listPlans(\"team\")[k].pathwayId],\r\n          \"pathwayId\": log.listPlans(\"team\")[k].pathwayId,\r\n          \"task\": {short:log.listPlans(\"team\")[k].text},\r\n          \"data\": log.listPlans(\"team\")[k].id,\r\n          \"agree\": log.listPlans(\"team\")[k].agree,\r\n          \"disagree\": log.listPlans(\"team\")[k].agree === false,\r\n          \"done\": complete\r\n        });\r\n      }\r\n    }\r\n\r\n    //Add individual\r\n    for (k in log.listActions()) {\r\n      if (k === \"team\") continue;\r\n      for (l in log.listActions()[k]) {\r\n        if (log.listActions()[k][l].agree && ((!log.listActions()[k][l].done && !complete) || (log.listActions()[k][l].done && complete))) {\r\n          individualTasks.push({\r\n            \"pathway\": \"N/A\",\r\n            \"patientId\": k,\r\n            \"task\": data.patients[k].actions.filter(function(v){\r\n              return v.id === l;\r\n            })[0],\r\n            \"pathwayId\": log.listPlans()[k][l].pathwayId,\r\n            \"data\": l,\r\n            \"tpId\": k,\r\n            \"agree\": true,\r\n            \"done\": complete\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    //Add custom individual\r\n    for (k in log.listPlans()) {\r\n      if (k === \"team\") continue;\r\n      for (l in log.listPlans()[k]) {\r\n        if (log.listPlans()[k][l].text && (!log.listPlans()[k][l].done && !complete) || (log.listPlans()[k][l].done && complete)) {\r\n          individualTasks.push({\r\n            \"canEdit\": true,\r\n            \"pathway\": data.pathwayNames[log.listPlans()[k][l].pathwayId],\r\n            \"pathwayId\": log.listPlans()[k][l].pathwayId,\r\n            \"patientId\": k,\r\n            \"tpId\": k,\r\n            \"task\": {short: log.listPlans()[k][l].text},\r\n            \"data\": l,\r\n            \"agree\": true,\r\n            \"done\": complete\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    /*var listTemplate = $('#welcome-task-list').html();\r\n    Mustache.parse(listTemplate);\r\n    $('#welcome-tab-content').html(Mustache.render(listTemplate));*/\r\n    var tmpl = require(\"templates/action-plan-task-list\");\r\n    $('#welcome-tab-content').html(tmpl({\r\n      team:{\r\n        \"tasks\": teamTasks,\r\n        \"hasTasks\": teamTasks.length > 0\r\n      },\r\n      individual:{\r\n        \"tasks\": individualTasks,\r\n        \"isPatientTable\": true,\r\n        \"hasTasks\": individualTasks.length > 0\r\n      }\r\n    }));\r\n\r\n    /*var addTemplate = $('#action-plan').html();\r\n    Mustache.parse(addTemplate);\r\n    var rendered = Mustache.render(addTemplate);\r\n    $('#team-add-plan').html(rendered);*/\r\n\r\n    /*var tempMust = $('#welcome-task-items').html();\r\n    var itemTemplate = $('#welcome-task-item').html();\r\n    Mustache.parse(tempMust);\r\n    Mustache.parse(itemTemplate);*/\r\n\r\n    $('#team-add-plan').off('click').on('click', '.add-plan', function() {\r\n      var plan = $(this).parent().parent().find('textarea').val();\r\n      var planId = recordPlan(\"team\", plan, \"custom\");\r\n      $('#team-task-panel').find('table tbody').append(Mustache.render(itemTemplate, {\r\n        \"pathway\": \"\",\r\n        \"pathwayId\": \"custom\",\r\n        \"canEdit\": true,\r\n        \"task\": plan,\r\n        \"data\": planId,\r\n        \"agree\": null,\r\n        \"done\": null\r\n      }, {\r\n        \"chk\": $('#checkbox-template').html()\r\n      }));\r\n    });\r\n\r\n/*\r\n    rendered = Mustache.render(tempMust, {\r\n      \"tasks\": teamTasks,\r\n      \"hasTasks\": teamTasks.length > 0\r\n    }, {\r\n      \"task-item\": itemTemplate,\r\n      \"chk\": $('#checkbox-template').html()\r\n    });\r\n    $('#team-task-panel').children().not(\":first\").remove();\r\n    $('#team-task-panel').append(rendered);\r\n\r\n    rendered = Mustache.render(tempMust, {\r\n      \"tasks\": individualTasks,\r\n      \"isPatientTable\": true,\r\n      \"hasTasks\": individualTasks.length > 0\r\n    }, {\r\n      \"task-item\": itemTemplate,\r\n      \"chk\": $('#checkbox-template').html()\r\n    });\r\n    $('#individual-task-panel').children().not(\":first\").remove();\r\n    $('#individual-task-panel').append(rendered);*/\r\n\r\n    welcome.wireUpWelcomePage();\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = welcome;\r\n","var data = require('../data.js'),\r\n  chart = require('../chart.js');\r\n\r\nvar bd = {\r\n\r\n  wireUp: function() {\r\n\r\n  },\r\n\r\n  show: function(panel, isAppend, subPanels, isDownText, isUpText) {\r\n\r\n    var sectionElement = $('<div class=\"section\"></div>');\r\n\r\n    if (isAppend) panel.append(sectionElement);\r\n    else panel.html(sectionElement);\r\n\r\n    subPanels.forEach(function(v) {\r\n      var args = v.args;\r\n      args.unshift(true);\r\n      args.unshift(sectionElement);\r\n      v.show.apply(null, args);\r\n    });\r\n\r\n    if (isUpText) sectionElement.prepend($('<div class=\"fp-controlArrow fp-up\"><div>' + isUpText + '</div></div>'));\r\n    if (isDownText) sectionElement.append($('<div class=\"fp-controlArrow fp-down\"><div>' + isDownText + '</div></div>'));\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = bd;\r\n","/*jslint browser: true*/\r\n/*jshint -W055 */\r\n/*global console, alert*/\r\n\r\n/*\r\n * For each disease area there will be 4 stages: Diagnosis, Monitoring, Treatment and Exclusions.\r\n * Each stage gets a single panel on the front screen.\r\n * Clicking on a panel takes you to a screen specific to that stage, but similar in layout and content\r\n *  to all the others.\r\n */\r\n\r\nvar template = require('./template'),\r\n  main = require('./main');\r\n\r\n//TODO not sure why i did this - was in local variable\r\n//maybe a separate module\r\n//window.location = window.history.location || window.location;\r\n/********************************************************\r\n *** Shows the pre-load image and slowly fades it out. ***\r\n ********************************************************/\r\n\r\nvar App = {\r\n  init: function init() {\r\n    $(window).load(function() {\r\n      $('.loading-container').fadeOut(1000, function() {\r\n        //$(this).remove();\r\n      });\r\n    });\r\n\r\n    /******************************************\r\n     *** This happens when the page is ready ***\r\n     ******************************************/\r\n    $(document).on('ready', function() {\r\n      //Grab the hash if exists - IE seems to forget it\r\n      main.hash = location.hash;\r\n\r\n      //CHANGE THIS - added to spoof login\r\n      location.hash = \"\";\r\n      main.hash = \"\";\r\n      $('#signin').on('click', function() {\r\n        if ($('#inpEmail').val().length < 8) alert(\"Please enter your email address.\");\r\n        else {\r\n          var dataToSend = {\r\n            event: {\r\n              what: \"login\",\r\n              when: new Date().getTime(),\r\n              who: $(\"#inpEmail\").val(),\r\n              detail: [\r\n                { key: \"href\", value: location.href }\r\n              ]\r\n            }\r\n          };\r\n          console.log(dataToSend);\r\n          $.ajax({\r\n            type: \"POST\",\r\n            url: \"http://130.88.250.206:9100/pingr\",\r\n            data: JSON.stringify(dataToSend),\r\n            success: function(d) { console.log(d); },\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n          });\r\n\r\n          var obj = JSON.parse(localStorage.bb);\r\n          obj.email = $('#inpEmail').val();\r\n          localStorage.bb = JSON.stringify(obj);\r\n\r\n\r\n          history.pushState(null, null, '#overview');\r\n          template.loadContent('#overview');\r\n        }\r\n      });\r\n      $('#inpEmail').on('keyup', function(e) {\r\n        var code = e.which;\r\n        if (code == 13) {\r\n          $('#signin').click();\r\n        }\r\n      });\r\n\r\n      //Load the data then wire up the events on the page\r\n      main.init();\r\n\r\n      //Sorts out the data held locally in the user's browser\r\n      if (!localStorage.bb) localStorage.bb = JSON.stringify({});\r\n      var obj = JSON.parse(localStorage.bb);\r\n      if (!obj.version || obj.version !== main.version) {\r\n        localStorage.bb = JSON.stringify({\r\n          \"version\": main.version\r\n        });\r\n      }\r\n\r\n      if (JSON.parse(localStorage.bb).email) {\r\n        $('#inpEmail').val(JSON.parse(localStorage.bb).email);\r\n      }\r\n\r\n      $('[data-toggle=\"tooltip\"]').tooltip({\r\n        container: 'body',\r\n        delay: {\r\n          \"show\": 500,\r\n          \"hide\": 100\r\n        },\r\n        html: true\r\n      });\r\n      $('[data-toggle=\"lone-tooltip\"]').tooltip({\r\n        container: 'body',\r\n        delay: {\r\n          \"show\": 300,\r\n          \"hide\": 100\r\n        }\r\n      });\r\n      $('[data-toggle=\"lone-tooltip\"]').on('shown.bs.tooltip', function(e) {\r\n        $('[data-toggle=\"tooltip\"]').not(this).tooltip('hide');\r\n      });\r\n\r\n      //ensure on first load the login screen is cached to the history\r\n      history.pushState(null, null, '');\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = App;\r\n","var data = require('./data'),\r\n  lookup = require('./lookup'),\r\n  base = require('./base'),\r\n  patients = require('./panels/patients'),\r\n  patientList = require('./panels/patientList'),\r\n  teamActionPlan = require('./panels/teamActionPlan'),\r\n  allPatients = require('./panels/allPatients'),\r\n  welcome = require('./panels/welcome'),\r\n  layout = require('./layout'),\r\n  overview = require('./views/overview'),\r\n  indicatorView = require('./views/indicator'),\r\n  patientView = require('./views/patient'),\r\n  actionPlan = require('./views/actions'),\r\n  Mustache = require('mustache');\r\n\r\nvar template = {\r\n\r\n  loadContent: function(hash, isPoppingState) {\r\n    base.hideTooltips();\r\n\r\n    var i, pathwayId, pathwayStage, standard, indicator, patientId;\r\n    if (!isPoppingState) {\r\n      window.location.hash = hash;\r\n    }\r\n\r\n    if (hash === '') {\r\n      base.clearBox();\r\n      base.showFooter();\r\n      layout.showPage('login');\r\n      $('html').removeClass('scroll-bar');\r\n    } else {\r\n      base.hideFooter();\r\n      $('html').addClass('scroll-bar');\r\n      var params = {};\r\n      var urlBits = hash.split('/');\r\n\r\n      if (hash.indexOf('?') > -1) {\r\n        hash.split('?')[1].split('&').forEach(function(param) {\r\n          var elems = param.split(\"=\");\r\n          params[elems[0]] = elems[1];\r\n        });\r\n        urlBits = hash.split('?')[0].split('/');\r\n      }\r\n\r\n      if (urlBits[0] === \"#overview\" && !urlBits[1]) {\r\n\r\n        overview.create(template.loadContent);\r\n\r\n      } else if (urlBits[0] === \"#indicators\") {\r\n\r\n        indicatorView.create(urlBits[1], urlBits[2], urlBits[3], params.tab || \"trend\", template.loadContent);\r\n\r\n      } else if (urlBits[0] === \"#main\") {\r\n        base.clearBox();\r\n        pathwayId = urlBits[1];\r\n        data.pathwayId = pathwayId;\r\n        pathwayStage = urlBits[2];\r\n        var yesPeople = urlBits[3] !== \"no\";\r\n        standard = urlBits[4];\r\n\r\n        if (pathwayStage && layout.page !== 'main-dashboard') {\r\n          $('.page').hide();\r\n          $('#main-dashboard').show();\r\n\r\n          ////layout.showSidePanel();\r\n          layout.showOverviewPanels();\r\n          layout.showHeaderBarItems();\r\n        }\r\n\r\n        if (pathwayStage) {\r\n          if (yesPeople) {\r\n            template.showPathwayStageViewOk(pathwayId, pathwayStage, template.shouldWeFade(lookup.currentUrl, hash));\r\n          } else {\r\n            template.showPathwayStageView(pathwayId, pathwayStage, standard, template.shouldWeFade(lookup.currentUrl, hash));\r\n          }\r\n        } else {\r\n          template.showOverview(pathwayId);\r\n        }\r\n\r\n        base.wireUpTooltips();\r\n\r\n      } else if (urlBits[0] === \"#help\") {\r\n        layout.view=\"HELP\";\r\n        lookup.suggestionModalText = \"Screen: Help\\n===========\\n\";\r\n        base.clearBox();\r\n        base.selectTab(\"\");\r\n        layout.showPage('help-page');\r\n\r\n        layout.showHeaderBarItems();\r\n\r\n      } else if (urlBits[0] === \"#contact\") {\r\n        layout.view=\"CONTACT\";\r\n        lookup.suggestionModalText = \"Screen: Contact us\\n===========\\n\";\r\n        base.clearBox();\r\n        base.selectTab(\"\");\r\n        layout.showPage('contact-page');\r\n\r\n        layout.showHeaderBarItems();\r\n\r\n      } else if (urlBits[0] === \"#patient\") {\r\n\r\n        //create(pathwayId, pathwayStage, standard, patientId)\r\n        patientView.create(urlBits[2], urlBits[3], urlBits[4], urlBits[1], template.loadContent);\r\n\r\n      } else if (urlBits[0] === \"#patients\") {\r\n\r\n        patientId = urlBits[1];\r\n\r\n        patientView.create(null, null, null, patientId, template.loadContent);\r\n        /*pathwayId = urlBits[2];\r\n\r\n        allPatients.showView(patientId, true);\r\n\r\n        base.wireUpTooltips();\r\n\r\n        if (patientId) {\r\n          var nhs = data.patLookup ? data.patLookup[patientId] : patientId;\r\n          $('#patients').find('div.table-scroll').getNiceScroll().doScrollPos(0, $('#patients td').filter(function() {\r\n            return $(this).text().trim() === nhs;\r\n          }).position().top - 140);\r\n          $('#patients').find('tr:contains(' + nhs + ')').addClass(\"highlighted\");\r\n        }*/\r\n      } else if (urlBits[0] === \"#agreedactions\") {\r\n\r\n        actionPlan.create();\r\n\r\n      } else {\r\n        //if screen not in correct segment then select it\r\n        alert(\"shouldn't get here\");\r\n        pathwayStage = hash.substr(1);\r\n\r\n        template.showPathwayStageView(pathwayStage);\r\n\r\n        base.wireUpTooltips();\r\n      }\r\n\r\n      $('#suggs').off('click').on('click', function(e){\r\n        base.launchSuggestionModal();\r\n        e.preventDefault();\r\n      });\r\n    }\r\n\r\n    lookup.currentUrl = hash;\r\n  },\r\n\r\n  //Show the overview page for a disease\r\n  showOverview: function(disease) {\r\n    data.pathwayId = disease;\r\n\r\n    layout.showMainView(data.diseases.map(function(v) {\r\n      return v.id;\r\n    }).indexOf(disease));\r\n\r\n    $('aside li ul li').removeClass('active');\r\n    $('aside a[href=\"#main/' + disease + '\"]:contains(\"Overview\")').parent().addClass('active');\r\n\r\n    $('#mainTitle').show();\r\n    base.updateTitle(data.text.pathways[data.pathwayId][\"display-name\"] + \": Overview (practice-level data)\");\r\n\r\n    //Show overview panels\r\n    template.showOverviewPanels();\r\n    teamActionPlan.show(farRightPanel);\r\n  },\r\n\r\n  showOverviewPanels: function() {\r\n    base.switchTo221Layout();\r\n\r\n    template.showPanel(lookup.categories.diagnosis.name, topLeftPanel, true);\r\n    template.showPanel(lookup.categories.monitoring.name, topRightPanel, true);\r\n    template.showPanel(lookup.categories.treatment.name, bottomLeftPanel, true);\r\n    template.showPanel(lookup.categories.exclusions.name, bottomRightPanel, true);\r\n\r\n    base.wireUpTooltips();\r\n  },\r\n\r\n  showPanel: function(pathwayStage, location, enableHover) {\r\n    base.showPathwayStageOverviewPanel(location, enableHover, data.pathwayId, pathwayStage);\r\n\r\n    if (enableHover) template.highlightOnHoverAndEnableSelectByClick(location);\r\n    else location.children('div').addClass('unclickable');\r\n  },\r\n\r\n  //Show the pathway stage for a disease\r\n  showPathwayStageView: function(pathwayId, pathwayStage, standard, shouldFade) {\r\n    farRightPanel.removeClass('standard-missed-page').removeClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n    data.pathwayId = pathwayId;\r\n    layout.showMainView(data.diseases.map(function(v) {\r\n      return v.id;\r\n    }).indexOf(pathwayId));\r\n\r\n    $('aside li ul li').removeClass('active');\r\n    var re = new RegExp(pathwayStage, \"g\");\r\n    $('aside a').filter(function() {\r\n      return this.href.match(re);\r\n    }).parent().addClass('active');\r\n\r\n    base.switchTo110Layout();\r\n\r\n    if (!standard) {\r\n      standard = Object.keys(data[pathwayId][pathwayStage].standards)[0];\r\n    }\r\n\r\n    var panel = patients.create(pathwayId, pathwayStage, standard);\r\n\r\n    if (shouldFade) {\r\n      farLeftPanel.fadeOut(100, function() {\r\n        $(this).html(panel);\r\n        patients.wireUp(pathwayId, pathwayStage, farLeftPanel, standard);\r\n        patientList.populate(pathwayId, pathwayStage, standard, null);\r\n        $('#mainTitle').hide();\r\n        base.updateTitle(data.text.pathways[pathwayId][pathwayStage].text.page.text, data.text.pathways[pathwayId][pathwayStage].text.page.tooltip);\r\n        $(this).fadeIn(100);\r\n      });\r\n    } else {\r\n      farLeftPanel.html(panel);\r\n      patients.wireUp(pathwayId, pathwayStage, farLeftPanel, standard);\r\n      patientList.populate(pathwayId, pathwayStage, standard, null);\r\n      $('#mainTitle').hide();\r\n      base.updateTitle(data.text.pathways[pathwayId][pathwayStage].text.page.text, data.text.pathways[pathwayId][pathwayStage].text.page.tooltip);\r\n    }\r\n\r\n    var tempMust = $('#patient-panel-placeholder').html();\r\n    farRightPanel.html(Mustache.render(tempMust));\r\n  },\r\n\r\n  showPathwayStageViewOk: function(pathwayId, pathwayStage, shouldFade) {\r\n    farRightPanel.removeClass('standard-missed-page').removeClass('standard-achieved-page').removeClass('standard-not-relevant-page');\r\n    layout.showMainView(data.diseases.map(function(v) {\r\n      return v.id;\r\n    }).indexOf(pathwayId));\r\n\r\n    $('aside li ul li').removeClass('active');\r\n    var re = new RegExp(pathwayStage, \"g\");\r\n    $('aside a').filter(function() {\r\n      return this.href.match(re);\r\n    }).parent().addClass('active');\r\n\r\n    base.switchTo110Layout();\r\n\r\n    var panel = patients.createOk(pathwayId, pathwayStage);\r\n\r\n    if (shouldFade) {\r\n      farLeftPanel.fadeOut(200, function() {\r\n        $(this).html(panel);\r\n        patients.wireUpOk(pathwayId, pathwayStage, farLeftPanel);\r\n        patients.populateOk(pathwayId, pathwayStage, null);\r\n        $('#mainTitle').hide();\r\n        base.updateTitle(data.text.pathways[pathwayId][pathwayStage].text.page.text, data.text.pathways[pathwayId][pathwayStage].text.page.tooltip);\r\n        $(this).fadeIn(300);\r\n      });\r\n      var tempMust = $('#patient-panel-placeholder').html();\r\n      farRightPanel.html(Mustache.render(tempMust));\r\n    } else {\r\n      farLeftPanel.html(panel);\r\n      patients.wireUpOk(pathwayId, pathwayStage, farLeftPanel);\r\n      patients.populateOk(pathwayId, pathwayStage, null);\r\n      $('#mainTitle').hide();\r\n      base.updateTitle(data.text.pathways[pathwayId][pathwayStage].text.page.text, data.text.pathways[pathwayId][pathwayStage].text.page.tooltip);\r\n    }\r\n  },\r\n\r\n  highlightOnHoverAndEnableSelectByClick: function(panelSelector) {\r\n    panelSelector.children('div').removeClass('unclickable').on('mouseover', function() {\r\n      $(this).removeClass('panel-default');\r\n    }).on('mouseout', function(e) {\r\n      $(this).addClass('panel-default');\r\n    }).on('click', 'tr.standard-row', function(e) {\r\n      history.pushState(null, null, '#main/' + data.pathwayId + '/' + $(this).closest('.panel').data('stage') + '/no/' + $(this).data('standard'));\r\n      template.loadContent('#main/' + data.pathwayId + '/' + $(this).closest('.panel').data('stage') + '/no/' + $(this).data('standard'), true);\r\n      // do not give a default action\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    }).on('click', function(e) {\r\n      // keep the link in the browser history\r\n      history.pushState(null, null, '#main/' + data.pathwayId + '/' + $(this).data('stage') + '/no');\r\n      template.loadContent('#main/' + data.pathwayId + '/' + $(this).data('stage') + '/no', true);\r\n      // do not give a default action\r\n      return false;\r\n    });\r\n\r\n  },\r\n\r\n  displaySelectedPatient: function(id) {\r\n    var nhs = data.patLookup ? data.patLookup[id] : id;\r\n\r\n    history.pushState(null, null, '#patients/' + id);\r\n    template.loadContent('#patients/' + id, true);\r\n\r\n    $('.list-item').removeClass('highlighted');\r\n    $('.list-item:has(button[data-clipboard-text=' + nhs + '])').addClass('highlighted');\r\n\r\n    //scroll to patients\r\n    $('#patients').find('div.table-scroll').getNiceScroll().doScrollPos(0, $('#patients td').filter(function() {\r\n      return $(this).text().trim() === nhs;\r\n    }).position().top - 140);\r\n  },\r\n\r\n  shouldWeFade: function(oldHash, newHash) {\r\n    oldHash = oldHash.split('/');\r\n    newHash = newHash.split('/');\r\n\r\n    if (oldHash[0] === newHash[0] && oldHash[1] === newHash[1] && oldHash[2] === newHash[2] && oldHash[0] && newHash[0]) return false;\r\n    return true;\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = template;\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (hasSuggestions, suggestions, undefined) {\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\njade_mixins[\"actionPlanItem\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", suggestion.tpid ? suggestion.tpId : undefined, true, false)) + (jade.cls(['suggestion','active',suggestion.done ? 'success' : ''], [null,null,true])) + \"><td><span>\" + (null == (jade_interp = suggestion.text) ? \"\" : jade_interp) + \"</span><div data-toggle=\\\"buttons\\\" class=\\\"btn-group btn-hover-show-group pull-right\\\"><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Edit plan\\\" class=\\\"fa fa-pencil edit-plan clickable\\\"></i><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Delete plan\\\" class=\\\"fa fa-trash delete-plan clickable\\\"></i></div></td><td>\");\njade_mixins[\"thumbs\"](suggestion);\nbuf.push(\"</td></tr>\");\n};\nif ( hasSuggestions)\n{\nbuf.push(\"<table class=\\\"table\\\"><thead><tr><th>Suggested by you</th><th style=\\\"width: 105px\\\">Add to action plan?</th></tr></thead><tbody>\");\n// iterate suggestions\n;(function(){\n  var $$obj = suggestions;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var suggestion = $$obj[$index];\n\njade_mixins[\"actionPlanItem\"](suggestion);\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var suggestion = $$obj[$index];\n\njade_mixins[\"actionPlanItem\"](suggestion);\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table>\");\n}}.call(this,\"hasSuggestions\" in locals_for_with?locals_for_with.hasSuggestions:typeof hasSuggestions!==\"undefined\"?hasSuggestions:undefined,\"suggestions\" in locals_for_with?locals_for_with.suggestions:typeof suggestions!==\"undefined\"?suggestions:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (individual, team) {\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\njade_mixins[\"checkbox\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( !suggestion.done)\n{\nbuf.push(\"<label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to indicate you have implemented this action in your practice and remove it from your awaiting implementation list\\\" class=\\\"cr-styled\\\"><input type=\\\"checkbox\\\"\" + (jade.attr(\"checked\", suggestion.done ? 'checked' : undefined, true, false)) + \"/><i class=\\\"fa\\\"></i></label>\");\n}\nelse\n{\nbuf.push(\"<button data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"You marked this as complete - click to undo\\\" class=\\\"btn btn-xs btn-warning btn-undo\\\">Undo</button>\");\n}\n};\njade_mixins[\"actionPlanTaskListItem\"] = jade_interp = function(thing){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( thing.task)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-pathway-id\", thing.pathwayId, true, false)) + (jade.attr(\"data-id\", thing.task.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", thing.tpid ? thing.tpId : undefined, true, false)) + \" class=\\\"suggestion\\\"><td><span>\" + (jade.escape(null == (jade_interp = thing.pathway) ? \"\" : jade_interp)) + \"</span></td>\");\nif ( thing.patientId)\n{\nbuf.push(\"<td><span>\" + (jade.escape(null == (jade_interp = thing.patientId) ? \"\" : jade_interp)) + \"</span></td>\");\n}\nbuf.push(\"<td><span\" + (jade.attr(\"data-subsection\", thing.subsection, true, false)) + \"><strong class=\\\"black f20\\\">\" + (null == (jade_interp = thing.task.short) ? \"\" : jade_interp) + \"</strong>\");\nif ( thing.canEdit)\n{\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group btn-hover-show-group pull-right\\\"><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Edit plan\\\" class=\\\"fa fa-pencil edit-plan clickable\\\"></i><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Delete plan\\\" class=\\\"fa fa-trash delete-plan clickable\\\"></i></div>\");\n}\nif ( thing.task.long || thing.task.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a>\");\n}\nbuf.push(\"</span></td><td>\");\njade_mixins[\"thumbs\"](thing);\nbuf.push(\"</td><td>\");\njade_mixins[\"checkbox\"](thing);\nbuf.push(\"</td></tr>\");\nif ( thing.task.long)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more-row\\\"><td colspan=\\\"3\\\">\" + (null == (jade_interp = thing.task.long) ? \"\" : jade_interp) + \"</td>\");\nif ( !thing.task.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a>\");\n}\nbuf.push(\"</tr>\");\n}\nif ( thing.task.reason)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more-row\\\"><td colspan=\\\"3\\\">\" + (null == (jade_interp = thing.task.reason) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\n}\n}\nelse\n{\nbuf.push(jade.escape(null == (jade_interp = thing.task) ? \"\" : jade_interp));\n}\n};\njade_mixins[\"actionPlanTaskList\"] = jade_interp = function(thing){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( thing.hasTasks)\n{\nbuf.push(\"<table class=\\\"table\\\"><thead><tr><th style=\\\"width: 150px\\\">Condition</th>\");\nif ( thing.isPatientTable)\n{\nbuf.push(\"<th>NHS number</th>\");\n}\nbuf.push(\"<th>Planned action</th><th style=\\\"width: 105px\\\">Agree?</th><th style=\\\"width: 106px\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to indicate you have implemented this action in your practice and remove it from your awaiting implementation list\\\">Action implemented?</th></tr></thead><tbody>\");\n// iterate thing.tasks\n;(function(){\n  var $$obj = thing.tasks;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var task = $$obj[$index];\n\njade_mixins[\"actionPlanTaskListItem\"](task);\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var task = $$obj[$index];\n\njade_mixins[\"actionPlanTaskListItem\"](task);\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"panel-body\\\">You currently have no outstanding planned actions</div>\");\n}\n};\nbuf.push(\"<div class=\\\"container-fluid\\\"><div class=\\\"row\\\"><div id=\\\"team-task-panel\\\" class=\\\"panel panel-info\\\"><div class=\\\"panel-heading\\\">Practice-level      </div>\");\njade_mixins[\"actionPlanTaskList\"](team);\nbuf.push(\"</div></div><div class=\\\"row\\\"><div id=\\\"team-add-plan\\\" style=\\\"padding-bottom: 15px;margin-top: -10px;\\\"><form onsubmit=\\\"return false;\\\"><div class=\\\"form-group\\\"><textarea rows=\\\"3\\\" style=\\\"resize:none\\\" placeholder=\\\"Enter your own improvement action then click 'add' below...\\\" class=\\\"form-control\\\"></textarea></div><button class=\\\"btn btn-info add-plan\\\">Add</button></form></div></div><div class=\\\"row\\\"><div id=\\\"individual-task-panel\\\" class=\\\"panel panel-warning\\\"><div class=\\\"panel-heading\\\">Individual patient</div>\");\njade_mixins[\"actionPlanTaskList\"](individual);\nbuf.push(\"</div></div></div><div id=\\\"editPlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"exampleModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"exampleModalLabel\\\" class=\\\"modal-title\\\">Edit Plan</h4></div><div class=\\\"modal-body\\\"><div class=\\\"form-group\\\"><input id=\\\"editActionPlanItem\\\" type=\\\"text\\\" class=\\\"form-control\\\"/></div></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary save-plan\\\">Save</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div><div id=\\\"deletePlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"deleteModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"deleteModalLabel\\\" class=\\\"modal-title\\\">Delete a suggested action you added</h4></div><div class=\\\"modal-body\\\"><p><strong>You indicated that you want to delete:</strong></p><span id=\\\"modal-delete-item\\\" style=\\\"font-style:italic\\\"></span><br/><p><strong>Are you sure?</strong></p></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-danger delete-plan\\\">Delete</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div>\");}.call(this,\"individual\" in locals_for_with?locals_for_with.individual:typeof individual!==\"undefined\"?individual:undefined,\"team\" in locals_for_with?locals_for_with.team:typeof team!==\"undefined\"?team:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (performance, positiveMessage, tagline, target) {\nbuf.push(\"<ul><li class=\\\"perf-bullet\\\"><b>\" + (null == (jade_interp = performance.percentage + '%') ? \"\" : jade_interp) + \"</b><span>\" + (null == (jade_interp = ' (' + performance.fraction + ') ' + tagline) ? \"\" : jade_interp) + \"</span></li><li class=\\\"perf-bullet\\\">The target for this quality indicator is <b>\" + (jade.escape(null == (jade_interp = target) ? \"\" : jade_interp)) + \"</b></li><li class=\\\"perf-bullet perf-bullet-msg\\\">\" + (null == (jade_interp = positiveMessage) ? \"\" : jade_interp) + \"</li></ul>\");}.call(this,\"performance\" in locals_for_with?locals_for_with.performance:typeof performance!==\"undefined\"?performance:undefined,\"positiveMessage\" in locals_for_with?locals_for_with.positiveMessage:typeof positiveMessage!==\"undefined\"?positiveMessage:undefined,\"tagline\" in locals_for_with?locals_for_with.tagline:typeof tagline!==\"undefined\"?tagline:undefined,\"target\" in locals_for_with?locals_for_with.target:typeof target!==\"undefined\"?target:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div class=\\\"affix panel panel-default\\\"><div class=\\\"clearfix panel-heading\\\">Recommended actions: <span style=\\\"color: black;font-weight:bold\\\"> Patient-level </span></div><div id=\\\"tab-plan-individual\\\" class=\\\"panel-body fit-to-screen-height\\\"><div id=\\\"advice-placeholder\\\">Select an individual patient from the patient panel to view advice</div><div id=\\\"advice-list\\\"></div><div id=\\\"personalPlanIndividual\\\"></div></div></div><div id=\\\"editPlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"exampleModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"exampleModalLabel\\\" class=\\\"modal-title\\\">Edit Plan</h4></div><div class=\\\"modal-body\\\"><div class=\\\"form-group\\\"><input id=\\\"editActionPlanItem\\\" type=\\\"text\\\" class=\\\"form-control\\\"/></div></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary save-plan\\\">Save</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div><div id=\\\"deletePlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"deleteModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"deleteModalLabel\\\" class=\\\"modal-title\\\">Delete a suggested action you added</h4></div><div class=\\\"modal-body\\\"><p><strong>You indicated that you want to delete:</strong></p><span id=\\\"modal-delete-item\\\" style=\\\"font-style:italic\\\"></span><br/><p><strong>Are you sure?</strong></p></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-danger delete-plan\\\">Delete</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (noSuggestions, suggestions, undefined) {\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\nif ( noSuggestions)\n{\nbuf.push(\"<p>There are no improvement action suggestions from PINGR because this patient has either met the quality standard or it is not relevant to them.</p>\");\n}\nelse\n{\nbuf.push(\"<table id=\\\"individual-suggested-actions-table\\\" class=\\\"table\\\"><thead><tr><th></th><th style=\\\"width: 105px\\\"></th></tr></thead><tbody>\");\nvar alt = false\n// iterate suggestions\n;(function(){\n  var $$obj = suggestions;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var suggestion = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", suggestion.tpid ? suggestion.tpId : undefined, true, false)) + (jade.cls(['suggestion',alt ? 'alternate-row': ''], [null,true])) + \"><td><span\" + (jade.attr(\"data-subsection\", suggestion.subsection, true, false)) + \"><strong class=\\\"black f20\\\">\" + (null == (jade_interp = suggestion.short) ? \"\" : jade_interp) + \"</strong>\");\nif ( suggestion.long || suggestion.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a>\");\n}\nbuf.push(\"</span></td><td>\");\njade_mixins[\"thumbs\"](suggestion);\nbuf.push(\"</td></tr>\");\nif ( suggestion.long)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"2\\\">\" + (null == (jade_interp = suggestion.long) ? \"\" : jade_interp) + \"</td>\");\nif ( !suggestion.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a>\");\n}\nbuf.push(\"</tr>\");\n}\nif ( suggestion.reason)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"2\\\">\" + (null == (jade_interp = suggestion.reason) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\n}\nalt = !alt\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var suggestion = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", suggestion.tpid ? suggestion.tpId : undefined, true, false)) + (jade.cls(['suggestion',alt ? 'alternate-row': ''], [null,true])) + \"><td><span\" + (jade.attr(\"data-subsection\", suggestion.subsection, true, false)) + \"><strong class=\\\"black f20\\\">\" + (null == (jade_interp = suggestion.short) ? \"\" : jade_interp) + \"</strong>\");\nif ( suggestion.long || suggestion.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a>\");\n}\nbuf.push(\"</span></td><td>\");\njade_mixins[\"thumbs\"](suggestion);\nbuf.push(\"</td></tr>\");\nif ( suggestion.long)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"2\\\">\" + (null == (jade_interp = suggestion.long) ? \"\" : jade_interp) + \"</td>\");\nif ( !suggestion.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a>\");\n}\nbuf.push(\"</tr>\");\n}\nif ( suggestion.reason)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"2\\\">\" + (null == (jade_interp = suggestion.reason) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\n}\nalt = !alt\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table>\");\n}\nbuf.push(\"<form onsubmit=\\\"return false;\\\"><div class=\\\"form-group\\\"><textarea rows=\\\"3\\\" style=\\\"resize:none\\\" placeholder=\\\"Enter your own improvement action then click 'add' below...\\\" class=\\\"form-control\\\"></textarea></div><button class=\\\"btn btn-info add-plan\\\">Add</button></form>\");}.call(this,\"noSuggestions\" in locals_for_with?locals_for_with.noSuggestions:typeof noSuggestions!==\"undefined\"?noSuggestions:undefined,\"suggestions\" in locals_for_with?locals_for_with.suggestions:typeof suggestions!==\"undefined\"?suggestions:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\n\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\njade_mixins[\"checkbox\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( !suggestion.done)\n{\nbuf.push(\"<label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to indicate you have implemented this action in your practice and remove it from your awaiting implementation list\\\" class=\\\"cr-styled\\\"><input type=\\\"checkbox\\\"\" + (jade.attr(\"checked\", suggestion.done ? 'checked' : undefined, true, false)) + \"/><i class=\\\"fa\\\"></i></label>\");\n}\nelse\n{\nbuf.push(\"<button data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"You marked this as complete - click to undo\\\" class=\\\"btn btn-xs btn-warning btn-undo\\\">Undo</button>\");\n}\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\njade_mixins[\"checkbox\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( !suggestion.done)\n{\nbuf.push(\"<label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to indicate you have implemented this action in your practice and remove it from your awaiting implementation list\\\" class=\\\"cr-styled\\\"><input type=\\\"checkbox\\\"\" + (jade.attr(\"checked\", suggestion.done ? 'checked' : undefined, true, false)) + \"/><i class=\\\"fa\\\"></i></label>\");\n}\nelse\n{\nbuf.push(\"<button data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"You marked this as complete - click to undo\\\" class=\\\"btn btn-xs btn-warning btn-undo\\\">Undo</button>\");\n}\n};\njade_mixins[\"actionPlanTaskListItem\"] = jade_interp = function(thing){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nif ( thing.task)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-pathway-id\", thing.pathwayId, true, false)) + (jade.attr(\"data-id\", thing.task.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", thing.tpid ? thing.tpId : undefined, true, false)) + \" class=\\\"suggestion\\\"><td><span>\" + (jade.escape(null == (jade_interp = thing.pathway) ? \"\" : jade_interp)) + \"</span></td>\");\nif ( thing.patientId)\n{\nbuf.push(\"<td><span>\" + (jade.escape(null == (jade_interp = thing.patientId) ? \"\" : jade_interp)) + \"</span></td>\");\n}\nbuf.push(\"<td><span\" + (jade.attr(\"data-subsection\", thing.subsection, true, false)) + \"><strong class=\\\"black f20\\\">\" + (null == (jade_interp = thing.task.short) ? \"\" : jade_interp) + \"</strong>\");\nif ( thing.canEdit)\n{\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group btn-hover-show-group pull-right\\\"><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Edit plan\\\" class=\\\"fa fa-pencil edit-plan clickable\\\"></i><i data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"Delete plan\\\" class=\\\"fa fa-trash delete-plan clickable\\\"></i></div>\");\n}\nif ( thing.task.long || thing.task.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a>\");\n}\nbuf.push(\"</span></td><td>\");\njade_mixins[\"thumbs\"](thing);\nbuf.push(\"</td><td>\");\njade_mixins[\"checkbox\"](thing);\nbuf.push(\"</td></tr>\");\nif ( thing.task.long)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more-row\\\"><td colspan=\\\"3\\\">\" + (null == (jade_interp = thing.task.long) ? \"\" : jade_interp) + \"</td>\");\nif ( !thing.task.reason)\n{\nbuf.push(\"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a>\");\n}\nbuf.push(\"</tr>\");\n}\nif ( thing.task.reason)\n{\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more-row\\\"><td colspan=\\\"3\\\">\" + (null == (jade_interp = thing.task.reason) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", thing.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\n}\n}\nelse\n{\nbuf.push(jade.escape(null == (jade_interp = thing.task) ? \"\" : jade_interp));\n}\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\n\n\n\n\n\n\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div id=\\\"deletePlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"deleteModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"deleteModalLabel\\\" class=\\\"modal-title\\\">Delete a suggested action you added</h4></div><div class=\\\"modal-body\\\"><p><strong>You indicated that you want to delete:</strong></p><span id=\\\"modal-delete-item\\\" style=\\\"font-style:italic\\\"></span><br/><p><strong>Are you sure?</strong></p></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-danger delete-plan\\\">Delete</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div id=\\\"editPlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"exampleModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"exampleModalLabel\\\" class=\\\"modal-title\\\">Edit Plan</h4></div><div class=\\\"modal-body\\\"><div class=\\\"form-group\\\"><input id=\\\"editActionPlanItem\\\" type=\\\"text\\\" class=\\\"form-control\\\"/></div></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary save-plan\\\">Save</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<form onsubmit=\\\"return false;\\\"><div class=\\\"form-group\\\"><textarea rows=\\\"3\\\" style=\\\"resize:none\\\" placeholder=\\\"Enter your own improvement action then click 'add' below...\\\" class=\\\"form-control\\\"></textarea></div><button class=\\\"btn btn-info add-plan\\\">Add</button></form>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\n\n\n\n;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (text) {\nbuf.push(\"<div tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"modalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog modal-dialog-top\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"modalLabel\\\" class=\\\"modal-title\\\">Suggestions, comments and bugs</h4></div><div class=\\\"modal-body\\\"><form><div class=\\\"form-group\\\"><div class=\\\"no\\\">Please send us any suggestions, comments or bugs you find with PINGR. This could be problems with the data or ideas on how we could improve it</div><div class=\\\"text-danger small\\\">But please don't send us any patient identifiable information - e.g. NHS number, name, date of birth.</div><textarea rows=\\\"10\\\" style=\\\"resize:none\\\" class=\\\"form-control\\\">\" + (jade.escape(null == (jade_interp = '===========\\nThis text tells us which part of PINGR youre referring to  please dont delete it!\\n' + text) ? \"\" : jade_interp)) + \"</textarea></div><button type=\\\"submit\\\" class=\\\"btn btn-primary save-plan\\\">Send</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></form></div><div class=\\\"modal-footer\\\"></div></div></div></div>\");}.call(this,\"text\" in locals_for_with?locals_for_with.text:typeof text!==\"undefined\"?text:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (hasReasons, header, isUndo, item, placeholder, reasons, undefined) {\nbuf.push(\"<div tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"modalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"modalLabel\\\" class=\\\"modal-title\\\">\" + (jade.escape(null == (jade_interp = header) ? \"\" : jade_interp)) + \"</h4></div><div class=\\\"modal-body\\\">\");\nif ( item)\n{\nbuf.push(\"<label>You have disagreed with the following suggested action:</label><p></p><span style=\\\"font-style:italic\\\">\" + (jade.escape(null == (jade_interp = item) ? \"\" : jade_interp)) + \"</span>\");\n}\nbuf.push(\"<form><div class=\\\"form-group\\\"><p></p><label>Why?\");\n// iterate reasons\n;(function(){\n  var $$obj = reasons;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var reason = $$obj[$index];\n\nbuf.push(\"<div class=\\\"radio\\\"><label><input type=\\\"radio\\\" name=\\\"reason\\\"\" + (jade.attr(\"value\", reason.reason, true, false)) + (jade.attr(\"checked\", reason.checked ? 'checked' : undefined, true, false)) + \" required=\\\"\\\"/>\" + (jade.escape(null == (jade_interp = reason.reason) ? \"\" : jade_interp)) + \"</label></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var reason = $$obj[$index];\n\nbuf.push(\"<div class=\\\"radio\\\"><label><input type=\\\"radio\\\" name=\\\"reason\\\"\" + (jade.attr(\"value\", reason.reason, true, false)) + (jade.attr(\"checked\", reason.checked ? 'checked' : undefined, true, false)) + \" required=\\\"\\\"/>\" + (jade.escape(null == (jade_interp = reason.reason) ? \"\" : jade_interp)) + \"</label></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</label></div><div class=\\\"form-group\\\"><label>\" + (jade.escape(null == (jade_interp = 'Please tell us more' + hasReasons ? '- whatever your selection above:' : '') ? \"\" : jade_interp)) + \"</label><textarea rows=\\\"3\\\" style=\\\"resize:none\\\"\" + (jade.attr(\"placeholder\", placeholder, true, false)) + \" class=\\\"form-control\\\"></textarea></div><button type=\\\"submit\\\" class=\\\"btn btn-primary save-plan\\\">Save</button>\");\nif ( isUndo)\n{\nbuf.push(\"<button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-warning undo-plan\\\">Undo disagree</button>\");\n}\nbuf.push(\"<button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></form></div><div class=\\\"modal-footer\\\"></div></div></div></div>\");}.call(this,\"hasReasons\" in locals_for_with?locals_for_with.hasReasons:typeof hasReasons!==\"undefined\"?hasReasons:undefined,\"header\" in locals_for_with?locals_for_with.header:typeof header!==\"undefined\"?header:undefined,\"isUndo\" in locals_for_with?locals_for_with.isUndo:typeof isUndo!==\"undefined\"?isUndo:undefined,\"item\" in locals_for_with?locals_for_with.item:typeof item!==\"undefined\"?item:undefined,\"placeholder\" in locals_for_with?locals_for_with.placeholder:typeof placeholder!==\"undefined\"?placeholder:undefined,\"reasons\" in locals_for_with?locals_for_with.reasons:typeof reasons!==\"undefined\"?reasons:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (indicators, undefined) {\nbuf.push(\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-body pastel-pink\\\"><table class=\\\"table\\\"><thead><tr><th>Indicator</th><th>Performance</th><th>Target</th><th>Benchmark</th><th>Change</th><th>Trend</th></tr></thead><tbody>\");\nvar alt=false\n// iterate indicators\n;(function(){\n  var $$obj = indicators;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var indicator = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" data-toggle=\\\"tooltip\\\" data-placement=\\\"left\\\" title=\\\"Click for more detail\\\"\" + (jade.cls(['standard-row',alt ? 'alternate-row': ''], [null,true])) + \"><td><strong>\" + (jade.escape(null == (jade_interp = indicator.name) ? \"\" : jade_interp)) + \"</strong><br/><a\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a></td><td><strong\" + (jade.cls([indicator.aboveTarget ? 'text-success' : 'text-danger'], [true])) + \">\" + (jade.escape(null == (jade_interp = indicator.performance.percentage + '%') ? \"\" : jade_interp)) + \"</strong><span>\" + (jade.escape(null == (jade_interp = ' (' + indicator.performance.fraction + ')') ? \"\" : jade_interp)) + \"</span></td><td>\" + (jade.escape(null == (jade_interp = indicator.target) ? \"\" : jade_interp)) + \"</td><td>\" + (jade.escape(null == (jade_interp = indicator.benchmark) ? \"\" : jade_interp)) + \"</td><td>\");\nif ( indicator.up)\n{\nbuf.push(\"<i class=\\\"fa fa-2x fa-caret-up\\\"></i>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"fa fa-2x fa-caret-down\\\"></i>\");\n}\nbuf.push(\"</td><td><span class=\\\"inlinesparkline\\\">\" + (jade.escape(null == (jade_interp = indicator.trend) ? \"\" : jade_interp)) + \"</span></td></tr><tr\" + (jade.attr(\"data-id\", indicator.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"6\\\">\" + (null == (jade_interp = indicator.description) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\nalt = !alt\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var indicator = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" data-toggle=\\\"tooltip\\\" data-placement=\\\"left\\\" title=\\\"Click for more detail\\\"\" + (jade.cls(['standard-row',alt ? 'alternate-row': ''], [null,true])) + \"><td><strong>\" + (jade.escape(null == (jade_interp = indicator.name) ? \"\" : jade_interp)) + \"</strong><br/><a\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" class=\\\"show-more\\\">Show more <i class=\\\"fa fa-caret-down\\\"></i></a></td><td><strong\" + (jade.cls([indicator.aboveTarget ? 'text-success' : 'text-danger'], [true])) + \">\" + (jade.escape(null == (jade_interp = indicator.performance.percentage + '%') ? \"\" : jade_interp)) + \"</strong><span>\" + (jade.escape(null == (jade_interp = ' (' + indicator.performance.fraction + ')') ? \"\" : jade_interp)) + \"</span></td><td>\" + (jade.escape(null == (jade_interp = indicator.target) ? \"\" : jade_interp)) + \"</td><td>\" + (jade.escape(null == (jade_interp = indicator.benchmark) ? \"\" : jade_interp)) + \"</td><td>\");\nif ( indicator.up)\n{\nbuf.push(\"<i class=\\\"fa fa-2x fa-caret-up\\\"></i>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"fa fa-2x fa-caret-down\\\"></i>\");\n}\nbuf.push(\"</td><td><span class=\\\"inlinesparkline\\\">\" + (jade.escape(null == (jade_interp = indicator.trend) ? \"\" : jade_interp)) + \"</span></td></tr><tr\" + (jade.attr(\"data-id\", indicator.id, true, false)) + (jade.cls(['show-more-row',alt ? 'alternate-row': ''], [null,true])) + \"><td colspan=\\\"6\\\">\" + (null == (jade_interp = indicator.description) ? \"\" : jade_interp) + \"<br/><a\" + (jade.attr(\"data-id\", indicator.id, true, false)) + \" class=\\\"show-more\\\">Show less <i class=\\\"fa fa-caret-up\\\"></i></a></td></tr>\");\nalt = !alt\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table></div></div>\");}.call(this,\"indicators\" in locals_for_with?locals_for_with.indicators:typeof indicators!==\"undefined\"?indicators:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-body\\\"><div id=\\\"patients\\\"></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (header, n, patients, undefined) {\njade_mixins[\"header\"] = jade_interp = function(item){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<th style=\\\"min-width:90px\\\" data-toggle=\\\"tooltip\\\"\" + (jade.attr(\"title\", item.tooltip, true, false)) + (jade.cls(['sortable',item.direction], [null,true])) + \">\");\nif ( item.titleHTML)\n{\nbuf.push(null == (jade_interp = item.titleHTML) ? \"\" : jade_interp);\n}\nelse\n{\nbuf.push(null == (jade_interp = item.title + ' ') ? \"\" : jade_interp);\n}\nif ( !item.isUnSortable)\n{\nif ( item.isSorted)\n{\nif ( item.isAsc)\n{\nbuf.push(\"<i data-toggle=\\\"tooltip\\\"\" + (jade.attr(\"title\", 'Order patients by'+item.title, true, false)) + \" class=\\\"fa fa-sort-asc\\\"></i>\");\n}\nelse\n{\nbuf.push(\"<i data-toggle=\\\"tooltip\\\"\" + (jade.attr(\"title\", 'Order patients by'+item.title, true, false)) + \" class=\\\"fa fa-sort-desc\\\"></i>\");\n}\n}\nelse\n{\nbuf.push(\"<i data-toggle=\\\"tooltip\\\"\" + (jade.attr(\"title\", 'Order patients by'+item.title, true, false)) + \" class=\\\"fa fa-sort\\\"></i>\");\n}\n}\nbuf.push(\"</th>\");\n};\nbuf.push(\"<h4>\" + (null == (jade_interp = header + '(n=' + n + ')') ? \"\" : jade_interp) + \"</h4><table class=\\\"table patient-list table-body-hidden\\\"><thead><tr>\");\n// iterate locals['header-items']\n;(function(){\n  var $$obj = locals['header-items'];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\njade_mixins[\"header\"](item);\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\njade_mixins[\"header\"](item);\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tr></thead><tbody><tr data-toggle=\\\"tooltip\\\" data-placement=\\\"left\\\" title=\\\"Click for more information about this patient\\\" class=\\\"list-item\\\"><td style=\\\"min-width:130px\\\"><button type=\\\"button\\\" data-content=\\\"Copied\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"right\\\" class=\\\"btn btn-xs btn-default btn-copy\\\"><span class=\\\"fa fa-clipboard\\\"></span></button>        1234567890</td><td>2014-06-10</td></tr></tbody></table><div class=\\\"table-scroll\\\"><table class=\\\"table patient-list table-head-hidden\\\"><thead><tr>\");\n// iterate locals['header-items']\n;(function(){\n  var $$obj = locals['header-items'];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\njade_mixins[\"header\"](item);\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\njade_mixins[\"header\"](item);\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tr></thead><tbody>\");\n// iterate patients\n;(function(){\n  var $$obj = patients;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var patient = $$obj[$index];\n\nbuf.push(\"<tr data-toggle=\\\"tooltip\\\" data-placement=\\\"left\\\" title=\\\"Click for more information about this patient\\\" class=\\\"list-item patient-row-tooltip\\\"><td style=\\\"min-width:130px\\\">\");\nvar nhs = patient.nhsNumber.toString().replace(/ /g,\"\")\nbuf.push(\"<button type=\\\"button\\\"\" + (jade.attr(\"data-patient-id\", patient.patientId, true, false)) + (jade.attr(\"data-clipboard-text\", nhs, true, false)) + \" data-content=\\\"Copied\\\" data-toggle=\\\"lone-tooltip\\\" data-placement=\\\"right\\\"\" + (jade.attr(\"title\", 'Copy ' + nhs + ' to clipboard.', true, false)) + \" class=\\\"btn btn-xs btn-default btn-copy\\\"><span class=\\\"fa fa-clipboard\\\"></span></button>\" + (jade.escape(null == (jade_interp = ' ' + patient.nhsNumber) ? \"\" : jade_interp)) + \"</td>\");\n// iterate patient.items\n;(function(){\n  var $$obj = patient.items;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nbuf.push(\"<td>\" + (null == (jade_interp = item) ? \"\" : jade_interp) + \"</td>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nbuf.push(\"<td>\" + (null == (jade_interp = item) ? \"\" : jade_interp) + \"</td>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var patient = $$obj[$index];\n\nbuf.push(\"<tr data-toggle=\\\"tooltip\\\" data-placement=\\\"left\\\" title=\\\"Click for more information about this patient\\\" class=\\\"list-item patient-row-tooltip\\\"><td style=\\\"min-width:130px\\\">\");\nvar nhs = patient.nhsNumber.toString().replace(/ /g,\"\")\nbuf.push(\"<button type=\\\"button\\\"\" + (jade.attr(\"data-patient-id\", patient.patientId, true, false)) + (jade.attr(\"data-clipboard-text\", nhs, true, false)) + \" data-content=\\\"Copied\\\" data-toggle=\\\"lone-tooltip\\\" data-placement=\\\"right\\\"\" + (jade.attr(\"title\", 'Copy ' + nhs + ' to clipboard.', true, false)) + \" class=\\\"btn btn-xs btn-default btn-copy\\\"><span class=\\\"fa fa-clipboard\\\"></span></button>\" + (jade.escape(null == (jade_interp = ' ' + patient.nhsNumber) ? \"\" : jade_interp)) + \"</td>\");\n// iterate patient.items\n;(function(){\n  var $$obj = patient.items;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nbuf.push(\"<td>\" + (null == (jade_interp = item) ? \"\" : jade_interp) + \"</td>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nbuf.push(\"<td>\" + (null == (jade_interp = item) ? \"\" : jade_interp) + \"</td>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table></div>\");}.call(this,\"header\" in locals_for_with?locals_for_with.header:typeof header!==\"undefined\"?header:undefined,\"n\" in locals_for_with?locals_for_with.n:typeof n!==\"undefined\"?n:undefined,\"patients\" in locals_for_with?locals_for_with.patients:typeof patients!==\"undefined\"?patients:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<form id=\\\"search-box\\\" role=\\\"search\\\" class=\\\"app-search hidden-xs ng-pristine ng-valid\\\"><input type=\\\"text\\\" placeholder=\\\"Search by patients NHS number...\\\" class=\\\"typeahead form-control form-control-circle\\\"/></form>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (age, nhs, patid, sex) {\nbuf.push((jade.escape(null == (jade_interp = 'Patient ' + patid + ' ') ? \"\" : jade_interp)) + \"<button type=\\\"button\\\"\" + (jade.attr(\"data-clipboard-text\", nhs, true, false)) + \" data-content=\\\"Copied\\\" data-toggle=\\\"lone-tooltip\\\" data-placement=\\\"right\\\"\" + (jade.attr(\"title\", 'Copy ' + nhs + ' to clipboard.', true, false)) + \" class=\\\"btn btn-xs btn-default btn-copy\\\"><span class=\\\"fa fa-clipboard\\\"></span></button>\" + (jade.escape(null == (jade_interp = ' - ' + age + ' year old ' + sex) ? \"\" : jade_interp)));}.call(this,\"age\" in locals_for_with?locals_for_with.age:typeof age!==\"undefined\"?age:undefined,\"nhs\" in locals_for_with?locals_for_with.nhs:typeof nhs!==\"undefined\"?nhs:undefined,\"patid\" in locals_for_with?locals_for_with.patid:typeof patid!==\"undefined\"?patid:undefined,\"sex\" in locals_for_with?locals_for_with.sex:typeof sex!==\"undefined\"?sex:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (standards, undefined) {\nbuf.push(\"<div class=\\\"panel panel-default\\\"><table class=\\\"table table-condensed\\\"><thead><tr><th>Quality indicator</th><th>Target met?</th></tr></thead><tbody>\");\n// iterate standards\n;(function(){\n  var $$obj = standards;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var standard = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.cls([standard.targetMet ? 'success' : 'danger'], [true])) + \"><td>\" + (jade.escape(null == (jade_interp = standard.display) ? \"\" : jade_interp)) + \"</td><td>\");\nif ( standard.targetMet)\n{\nbuf.push(\"<i class=\\\"fa fa-check text-success\\\"></i>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"fa fa-times text-danger\\\"></i>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var standard = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.cls([standard.targetMet ? 'success' : 'danger'], [true])) + \"><td>\" + (jade.escape(null == (jade_interp = standard.display) ? \"\" : jade_interp)) + \"</td><td>\");\nif ( standard.targetMet)\n{\nbuf.push(\"<i class=\\\"fa fa-check text-success\\\"></i>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"fa fa-times text-danger\\\"></i>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table></div>\");}.call(this,\"standards\" in locals_for_with?locals_for_with.standards:typeof standards!==\"undefined\"?standards:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (suggestions, undefined) {\njade_mixins[\"thumbs\"] = jade_interp = function(suggestion){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<div data-toggle=\\\"buttons\\\" class=\\\"btn-group\\\"><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to agree with this action and save it in your agreed actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-yes','btn-toggle','btn-success',suggestion.agree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"yes\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.agree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-up\\\"></span></label><label data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\" title=\\\"Click to disagree with this action and remove it from your suggested actions list \\\"\" + (jade.cls(['btn','btn-xs','btn-no','btn-toggle','btn-danger',suggestion.disagree ? 'active' : ''], [null,null,null,null,null,true])) + \"><input type=\\\"checkbox\\\" value=\\\"no\\\" autocomplete=\\\"off\\\"\" + (jade.attr(\"checked\", suggestion.disagree ? 'checked' : undefined, true, false)) + \"/><span class=\\\"fa fa-2x fa-thumbs-down\\\"></span></label></div>\");\n};\nbuf.push(\"<table class=\\\"table\\\"><thead><tr><th>Recommended actions</th><th style=\\\"width: 105px\\\">Add to action plan?</th></tr></thead><tbody>\");\n// iterate suggestions\n;(function(){\n  var $$obj = suggestions;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var suggestion = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", suggestion.tpid ? suggestion.tpId : undefined, true, false)) + \" class=\\\"suggestion\\\"><td><span>\" + (null == (jade_interp = suggestion.text) ? \"\" : jade_interp) + \"</span></td><td>\");\njade_mixins[\"thumbs\"](suggestion);\nbuf.push(\"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var suggestion = $$obj[$index];\n\nbuf.push(\"<tr\" + (jade.attr(\"data-id\", suggestion.id, true, false)) + (jade.attr(\"data-team-or-patient-id\", suggestion.tpid ? suggestion.tpId : undefined, true, false)) + \" class=\\\"suggestion\\\"><td><span>\" + (null == (jade_interp = suggestion.text) ? \"\" : jade_interp) + \"</span></td><td>\");\njade_mixins[\"thumbs\"](suggestion);\nbuf.push(\"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table><form onsubmit=\\\"return false;\\\"><div class=\\\"form-group\\\"><textarea rows=\\\"3\\\" style=\\\"resize:none\\\" placeholder=\\\"Enter your own improvement action then click 'add' below...\\\" class=\\\"form-control\\\"></textarea></div><button class=\\\"btn btn-info add-plan\\\">Add</button></form>\");}.call(this,\"suggestions\" in locals_for_with?locals_for_with.suggestions:typeof suggestions!==\"undefined\"?suggestions:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div class=\\\"affix panel panel-default\\\"><div id=\\\"tab-plan-team\\\" class=\\\"panel-body fit-to-screen-height\\\"><div id=\\\"suggestedPlanTeam\\\"></div><div id=\\\"personalPlanTeam\\\"></div></div></div><div id=\\\"editPlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"exampleModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"exampleModalLabel\\\" class=\\\"modal-title\\\">Edit Plan</h4></div><div class=\\\"modal-body\\\"><div class=\\\"form-group\\\"><input id=\\\"editActionPlanItem\\\" type=\\\"text\\\" class=\\\"form-control\\\"/></div></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary save-plan\\\">Save</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div><div id=\\\"deletePlan\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"deleteModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal fade\\\"><div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\"></span></button><h4 id=\\\"deleteModalLabel\\\" class=\\\"modal-title\\\">Delete a suggested action you added</h4></div><div class=\\\"modal-body\\\"><p><strong>You indicated that you want to delete:</strong></p><span id=\\\"modal-delete-item\\\" style=\\\"font-style:italic\\\"></span><br/><p><strong>Are you sure?</strong></p></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-danger delete-plan\\\">Delete</button><button type=\\\"button\\\" data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Cancel</button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var base = require('../base'),\r\n  layout = require('../layout'),\r\n  lookup = require('../lookup'),\r\n  welcome = require('../panels/welcome');\r\n\r\nvar ID = \"ACTION_PLAN_VIEW\";\r\n\r\nvar ap = {\r\n\r\n  create: function() {\r\n    lookup.suggestionModalText = \"Screen: Action plan\\n===========\\n\";\r\n\r\n    base.selectTab(\"actions\");\r\n\r\n    if (layout.view !== ID) {\r\n      //Not already in this view so we need to rejig a few things\r\n      base.clearBox();\r\n      layout.showPage('welcome');\r\n      layout.showHeaderBarItems();\r\n\r\n      $('#welcome-tabs li').removeClass('active');\r\n      $('#outstandingTasks').closest('li').addClass('active');\r\n\r\n      layout.view = ID;\r\n    }\r\n\r\n    welcome.populate();\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = ap;\r\n","var base = require('../base'),\r\n  data = require('../data'),\r\n  patientList = require('../panels/patientList'),\r\n  indicatorBreakdown = require('../panels/indicatorBreakdown'),\r\n  indicatorBenchmark = require('../panels/indicatorBenchmark'),\r\n  indicatorTrend = require('../panels/indicatorTrend'),\r\n  indicatorHeadlines = require('../panels/indicatorHeadlines'),\r\n  teamActionPlan = require('../panels/teamActionPlan'),\r\n  wrapper = require('../panels/wrapper'),\r\n  layout = require('../layout'),\r\n  lookup = require('../lookup');\r\n\r\nvar ID = \"INDICATOR\";\r\n/*\r\n * The indicator page consists of the panels:\r\n *   Tabbed panel\r\n *     - performance trend\r\n *     - performance benchmark\r\n *   Patient groups\r\n *   Patient list\r\n *   Team action plan\r\n */\r\n\r\nvar ind = {\r\n\r\n  create: function(pathwayId, pathwayStage, standard, tab, loadContentFn) {\r\n\r\n    base.selectTab(\"indicator\");\r\n    base.showLoading();\r\n\r\n    //use a setTimeout to force the UI to change e.g. show the loading-container\r\n    //before further execution\r\n    setTimeout(function() {\r\n      if (layout.view !== ID) {\r\n        //Not already in this view so we need to rejig a few things\r\n        base.clearBox();\r\n        //base.switchTo21Layout();\r\n        layout.showMainView();\r\n\r\n        base.removeFullPage(farRightPanel);\r\n        base.hidePanels(farRightPanel);\r\n\r\n        layout.view = ID;\r\n      }\r\n\r\n      if (!pathwayId) {\r\n        if (layout.pathwayId) pathwayId = layout.pathwayId;\r\n        else pathwayId = Object.keys(data.pathwayNames)[0];\r\n      }\r\n\r\n      if (!pathwayStage) {\r\n        if (layout.pathwayStage) pathwayStage = layout.pathwayStage;\r\n        else pathwayStage = Object.keys(data.text.pathways[pathwayId])[0];\r\n      }\r\n\r\n      if (!standard) {\r\n        if (layout.standard) standard = layout.standard;\r\n        else standard = Object.keys(data.text.pathways[pathwayId][pathwayStage].standards)[0];\r\n      }\r\n\r\n      //if (layout.pathwayId !== pathwayId || layout.pathwayStage !== pathwayStage) {\r\n      //different pathway or stage so title needs updating\r\n      base.updateTitle(data.text.pathways[pathwayId][pathwayStage].standards[standard].name);\r\n      lookup.suggestionModalText=\"Screen: Indicator\\nIndicator: \" + data.text.pathways[pathwayId][pathwayStage].standards[standard].name + \"\\n===========\\n\";\r\n      /*base.updateTitle([{\r\n        title: \"Overview\",\r\n        url: \"#overview\"\r\n      }, {\r\n        title: data.text.pathways[pathwayId][pathwayStage].text.page.text,\r\n        tooltip: data.text.pathways[pathwayId][pathwayStage].text.page.tooltip\r\n      }]);\r\n      $('#mainTitle').show();*/\r\n      //}\r\n\r\n      layout.pathwayId = pathwayId;\r\n      layout.pathwayStage = pathwayStage;\r\n      layout.standard = standard;\r\n\r\n      //TODO not sure if this needs moving..?\r\n      data.pathwayId = pathwayId;\r\n\r\n      //The three panels we need to show\r\n      //Panels decide whether they need to redraw themselves\r\n      teamActionPlan.show(farLeftPanel);\r\n\r\n      base.updateTab(\"indicators\", data.text.pathways[pathwayId][pathwayStage].standards[standard].tabText, [pathwayId, pathwayStage, standard].join(\"/\"));\r\n\r\n      wrapper.show(farRightPanel, false, [\r\n        {\r\n          show: indicatorHeadlines.show,\r\n          args: [pathwayId, pathwayStage, standard]\r\n        }, {\r\n          show: indicatorBreakdown.show,\r\n          args: [pathwayId, pathwayStage, standard, patientList.selectSubsection]\r\n        }, {\r\n          show: patientList.show,\r\n          args: [pathwayId, pathwayStage, standard, loadContentFn]\r\n        }\r\n      ], \"Performance over time\", false);\r\n      wrapper.show(farRightPanel, true, [\r\n        {\r\n          show: indicatorTrend.show,\r\n          args: [pathwayId, pathwayStage, standard]\r\n        }\r\n      ], \"Benchmarking\", \"Patients at risk\");\r\n      wrapper.show(farRightPanel, true, [\r\n        {\r\n          show: indicatorBenchmark.show,\r\n          args: [pathwayId, pathwayStage, standard]\r\n        }\r\n      ], false, \"Performance over time\");\r\n\r\n      if ($('#addedCSS').length === 0) {\r\n        $('head').append('<style id=\"addedCSS\" type=\"text/css\">.table-scroll {max-height:170px;}');\r\n      }\r\n\r\n      base.addFullPage(farRightPanel);\r\n      /*console.log(\"WINDOW HEIGHT: \" + $(window).height());\r\n      console.log(\"TABLE TOP: \" + $('.table-scroll').position().top);\r\n      console.log(\"CSS: \" + Math.floor($(window).height()-$('.table-scroll').position().top-200)+\"px\");*/\r\n      $('#addedCSS').text('.table-scroll {max-height:' + Math.floor($(window).height() - $('.table-scroll').position().top - 200) + 'px;}');\r\n\r\n      $(window).off('resize').on('resize', function() {\r\n        var win = $(this); //this = window\r\n        $('#addedCSS').text('.table-scroll {max-height:' + Math.floor(win.height() - $('.table-scroll').position().top - 200) + 'px;}');\r\n      });\r\n\r\n      $('#indicator-pane').show();\r\n\r\n      base.wireUpTooltips();\r\n\r\n      /*setTimeout($('.fp-controlArrow').each(function(idx, el) {\r\n        if(el.is(\":visible\"))\r\n      }), 2000);*/\r\n\r\n      base.hideLoading();\r\n    }, 0);\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = ind;\r\n","var base = require('../base'),\r\n  data = require('../data'),\r\n  layout = require('../layout'),\r\n  lookup = require('../lookup'),\r\n  indicatorList = require('../panels/indicatorList'),\r\n  teamActionPlan = require('../panels/teamActionPlan');\r\n\r\nvar ID = \"OVERVIEW\";\r\n/*\r\n * The overview page consists of the panels:\r\n *   Indicator list\r\n *   Team action plan\r\n */\r\nvar overview = {\r\n\r\n  create: function(loadContentFn) {\r\n\r\n    lookup.suggestionModalText=\"Screen: Overview\\n===========\\n\";\r\n\r\n    base.selectTab(\"overview\");\r\n    base.showLoading();\r\n\r\n    //use a setTimeout to force the UI to change e.g. show the loading-container\r\n    //before further execution\r\n    setTimeout(function() {\r\n\r\n      if (layout.view !== ID) {\r\n        //Not already in this view so we need to rejig a few things\r\n        base.clearBox();\r\n        //base.switchTo101Layout();\r\n        layout.showMainView();\r\n\r\n        $('#mainTitle').show();\r\n        base.updateTitle(\"Overview of your practice performance\");\r\n\r\n        base.removeFullPage(farRightPanel);\r\n        base.hidePanels(farRightPanel);\r\n\r\n        layout.view = ID;\r\n      }\r\n\r\n      data.pathwayId = \"htn\"; //TODO fudge\r\n\r\n      //The two panels we need to show\r\n      //Panels decide whether they need to redraw themselves\r\n      teamActionPlan.show(farLeftPanel);\r\n      indicatorList.show(farRightPanel, false, loadContentFn);\r\n\r\n      $('#overview-pane').show();\r\n\r\n      base.wireUpTooltips();\r\n      base.hideLoading();\r\n    }, 0);\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = overview;\r\n","var lifeline = require('../panels/lifeline'),\r\n  data = require('../data'),\r\n  base = require('../base'),\r\n  layout = require('../layout'),\r\n  lookup = require('../lookup'),\r\n  individualActionPlan = require('../panels/individualActionPlan'),\r\n  qualityStandards = require('../panels/qualityStandards'),\r\n  patientCharacteristics = require('../panels/patientCharacteristics'),\r\n  patientSearch = require('../panels/patientSearch');\r\n\r\nvar ID = \"PATIENT_VIEW\";\r\n/*\r\n * The patient page consists of the panels:\r\n *   Lifeline chart\r\n *   Individual action plan\r\n */\r\n\r\nvar pv = {\r\n\r\n  wireUp: function() {\r\n\r\n  },\r\n\r\n  create: function(pathwayId, pathwayStage, standard, patientId, loadContentFn) {\r\n\r\n    base.selectTab(\"patient\");\r\n    base.showLoading();\r\n\r\n    //use a setTimeout to force the UI to change e.g. show the loading-container\r\n    //before further execution\r\n    setTimeout(function() {\r\n\r\n      if (layout.view !== ID) {\r\n        //Not already in this view so we need to rejig a few things\r\n        base.clearBox();\r\n        //base.switchTo21Layout();\r\n        layout.showMainView();\r\n\r\n        base.removeFullPage(farRightPanel);\r\n        base.hidePanels(farRightPanel);\r\n\r\n        layout.view = ID;\r\n      }\r\n\r\n      base.hidePanels(farLeftPanel);\r\n\r\n      if (patientId) {\r\n        lookup.suggestionModalText = \"Screen: Patient\\nPatient ID: \" + patientId + \"  - NB this helps us identify the patient but is NOT their NHS number.\\n===========\\n\";\r\n\r\n        data.getPatientData(patientId, function(patientData) {\r\n\r\n          if (layout.pathwayId !== pathwayId || layout.pathwayStage !== pathwayStage ||\r\n            layout.standard !== standard || layout.patientId !== patientId) {\r\n            //different pathway or stage or patientId so title needs updating\r\n            $('#mainTitle').show();\r\n\r\n            var patid = (data.patLookup && data.patLookup[patientId] ? data.patLookup[patientId] : patientId);\r\n            var sex = patientData.characteristics.sex.toLowerCase() === \"m\" ?\r\n              \"male\" : (patientData.characteristics.sex.toLowerCase() === \"f\" ? \"female\" : patientData.characteristics.sex.toLowerCase());\r\n            var titleTmpl = require(\"templates/patient-title\");\r\n            base.updateTitle(titleTmpl({\r\n              patid: patid,\r\n              nhs: patid.toString().replace(/ /g, \"\"),\r\n              age: patientData.characteristics.age,\r\n              sex: sex\r\n            }));\r\n          }\r\n\r\n          base.updateTab(\"patients\", data.patLookup[patientId] || patientId, patientId);\r\n\r\n          layout.patientId = patientId;\r\n          data.patientId = patientId;\r\n          data.pathwayId = pathwayId;\r\n\r\n          patientSearch.show($('#title-right'), true, loadContentFn);\r\n          qualityStandards.show(farRightPanel, false, patientId);\r\n\r\n          lifeline.show(farRightPanel, true, patientId, patientData);\r\n          individualActionPlan.show(farLeftPanel, pathwayId, pathwayStage, standard, patientId);\r\n\r\n          patientSearch.wireUp();\r\n          $('#patient-pane').show();\r\n\r\n          base.wireUpTooltips();\r\n          base.hideLoading();\r\n\r\n        });\r\n      } else {\r\n        base.updateTitle(\"No patient currently selected\");\r\n        patientSearch.show(farRightPanel, true, loadContentFn);\r\n\r\n        lookup.suggestionModalText = \"Screen: Patient\\nPatient ID: None selected\\n===========\\n\";\r\n\r\n        base.wireUpTooltips();\r\n        base.hideLoading();\r\n      }\r\n\r\n    }, 0);\r\n\r\n  },\r\n\r\n  populate: function() {\r\n\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = pv;\r\n"]}